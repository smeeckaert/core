var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";var t=jQuery,n="wijdatepager",r=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype._setOption=function(e,n){t.wijmo.widget.prototype._setOption.apply(this,arguments);switch(e){case"culture":this.options.culture=n,this._initBackground();break;case"selectedDate":this.options.selectedDate=n,this._initBackground();break;case"disabled":n?this._disable():this._enable();break;case"viewType":this.options.viewType=n,this._initBackground();break;case"nextTooltip":this.element.find(".wijmo-wijdatepager-increment").attr("title",n);break;case"prevTooltip":this.element.find(".wijmo-wijdatepager-decrement").attr("title",n)}return this},n.prototype._disable=function(){this.element.addClass(this.options.wijCSS.stateDisabled),this.element.find(".wijmo-wijdatepager-decrement").button("option","disabled",!0),this.element.find(".wijmo-wijdatepager-increment").button("option","disabled",!0)},n.prototype._enable=function(){this.element.removeClass(this.options.wijCSS.stateDisabled),this.element.find(".wijmo-wijdatepager-decrement").button("option","disabled",!1),this.element.find(".wijmo-wijdatepager-increment").button("option","disabled",!1)},n.prototype._create=function(){var e=this.options,n,r,i;window.wijmoApplyWijTouchUtilEvents&&(t=window.wijmoApplyWijTouchUtilEvents(t)),e.selectedDate||(e.selectedDate=new Date),this._dtpagernamespacekey="dtpager"+(new Date).getTime(),this.element.addClass("wijmo-wijdatepager "+e.wijCSS.widget+" ui-helper-clearfix"),n=t.proxy(this.invalidate,this),t(window).bind("resize."+this._dtpagernamespacekey,n),this.element.disableSelection&&this.element.disableSelection(),this.element.append(t('<a class="wijmo-wijdatepager-decrement"><span>'+e.prevTooltip+"</span></a>")).append('<div class="wijmo-wijdatepager-container '+e.wijCSS.content+'">'+'<div class="wijmo-wijdatepager-pages"></div>'+"</div>"+'<a class="wijmo-wijdatepager-increment"><span>'+e.nextTooltip+"</span></a>"),t.wijmo.widget.prototype._create.apply(this,arguments),r=this.element.find(".wijmo-wijdatepager-decrement"),i=this.element.find(".wijmo-wijdatepager-increment"),t.mobile==null?(r.button({icons:{primary:"ui-icon-triangle-1-w"},text:!1}),i.button({icons:{primary:"ui-icon-triangle-1-e"},text:!1})):(r.html(""),r.attr("data-icon","arrow-l"),r.button({text:!1}),i.html(""),i.attr("data-icon","arrow-r"),i.button({text:!1})),r.click(t.proxy(this.goLeft,this)),i.click(t.proxy(this.goRight,this)),this._initBackground(),e.disabled&&this._disable()},n.prototype.destroy=function(){this.element.removeClass("wijmo-wijdatepager"),t(window).unbind("."+this._dtpagernamespacekey)},n.prototype.refresh=function(){this.invalidate()},n.prototype.invalidate=function(){var e,n=this.options.selectedDate,r,i=this.element.find(".wijmo-wijdatepager-container"),s=this.element.find(".wijmo-wijdatepager-decrement"),o=this.element.find(".wijmo-wijdatepager-increment"),u=this.element.innerWidth(),a=s.is(":visible")?s.outerWidth(!0):0,f=o.is(":visible")?o.outerWidth(!0):0,l,c,h;e=this.element.find(".wijmo-wijdatepager-pagelabel."+this._getDateClass(n)),e.length!==1?e=t(this.element.find(".wijmo-wijdatepager-pagelabel")[this._index]):(r=this.element.find(".wijmo-wijdatepager-pagelabel").index(e),this._index=r),this.element.find(".wijmo-wijdatepager-pagelabel."+this.options.wijCSS.stateActive).removeClass(this.options.wijCSS.stateActive),e.addClass(this.options.wijCSS.stateActive),i.css("left",a),this.element.removeClass("wijmo-wijdatepager-width-smallest wijmo-wijdatepager-width-small wijmo-wijdatepager-width-medium wijmo-wijdatepager-width-normal"),u<300?this.element.addClass("wijmo-wijdatepager-width-smallest"):u<475?this.element.addClass("wijmo-wijdatepager-width-small"):u<600?this.element.addClass("wijmo-wijdatepager-width-medium"):this.element.addClass("wijmo-wijdatepager-width-normal"),i.outerWidth(u-a-f),t.browser.msie&&parseInt(t.browser.version,10)<=7&&(l=this.element.find(".wijmo-wijdatepager-pages"),c=l.find(".wijmo-wijdatepager-pagelabel"),h=Math.round(l.width()/this._datesDef.length)-(c.outerWidth(!0)-c.width()),c.width(h))},n.prototype.goLeft=function(e){var t=this.options;if(t.disabled)return;this._setSelectedIndex(this._index-1,!0);if(e)return e.preventDefault(),!1},n.prototype.goRight=function(){var e=this.options;if(e.disabled)return;this._setSelectedIndex(this._index+1)},n.prototype._getCulture=function(e){return typeof e=="undefined"&&(e=null),Globalize.findClosestCulture(e||this.options.culture)},n.prototype._isRTL=function(){return!!this._getCulture().isRTL},n.prototype._initBackground=function(e,n){typeof e=="undefined"&&(e=!1),typeof n=="undefined"&&(n=!1);var r,i,s,o,u,a,f=this,l;if(this._isInAnimate)return;this._index=0,this._datesDef=this._getDatesDefinition(),this._min=0,this._max=this._datesDef.length-1,r="";for(i=0;i<this._datesDef.length;i+=1)r+='<div class="wijmo-wijdatepager-pagelabel'+(i===0?" wijmo-wijdatepager-pagelabel-first":"")+(this._datesDef[i].range?" wijmo-wijdatepager-pagerange":"")+(this._datesDef[i].header?" wijmo-wijdatepager-pageheader ui-state-highlight":"")+(i===this._datesDef.length-1?" wijmo-wijdatepager-pagelabel-last":"")+" "+this._getDateClass(this._datesDef[i].d)+'">'+this._datesDef[i].l+"</div>";o=this.element.find(".wijmo-wijdatepager-pages"),e?(this._isInAnimate=!0,s=o.clone(!0),o.html(r),u=o.find(".wijmo-wijdatepager-pagelabel"),n?(s.insertAfter(o),a=t(u[this._index]).offset().left,o.css("opacity",0).css("left",-s.outerWidth(!0)).stop().animate({left:"0px",opacity:100}),s.css("left",0).stop().animate({left:s.outerWidth(!0)+"px",opacity:0},function(){s.remove(),f._isInAnimate=!1,f.invalidate()})):(s.insertBefore(o),a=t(u[this._index]).offset().left,o.css("opacity",0).css("left",s.outerWidth(!0)).stop().animate({left:"0px",opacity:100}),s.stop().animate({left:"-"+s.outerWidth(!0)+"px",opacity:0},function(){s.remove(),f._isInAnimate=!1,f.invalidate()}))):(o.html(r),this.invalidate()),u=o.find(".wijmo-wijdatepager-pagelabel"),u.hover(t.proxy(this._pagelabelHover,this),t.proxy(this._pagelabelHout,this)),u.bind("mousedown",t.proxy(this._pagelabelMouseDown,this)),u.click(t.proxy(function(e){var n=t(e.target),r;r=this.element.find(".wijmo-wijdatepager-pagelabel").index(n),this._setSelectedIndex(r)},this))},n.prototype._getDateClass=function(e){return"c1dt"+e.getFullYear()+"_"+e.getMonth()+"_"+e.getDate()},n.prototype._addDays=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+t)},n.prototype._getDatesDefinition=function(){var e=this.options,t=e.viewType.toLowerCase(),n,r,i,s,o,u=[],a=e.selectedDate;switch(t){case"week":i=new Date(a.getFullYear(),a.getMonth(),-6),n=e.firstDayOfWeek-i.getDay(),Math.abs(n)>6&&(n=i.getDay()-e.firstDayOfWeek),i=this._addDays(i,n),o=new Date(a.getFullYear(),a.getMonth()+1,7),n=0;while(i<o||i.getMonth()===a.getMonth())s=this._addDays(i,7),u.push({l:this._formatString(this.localizeString("weekViewLabelFormat","{0:MMM dd}-{1:dd}"),i,this._addDays(i,6)),d:i,d2:this._addDays(i,6)}),a>=i&&a<=s&&(this._index=n),i=s,n+=1;break;case"month":r=new Date(a.getFullYear()-1,0,1),u.push({l:r.getFullYear(),d:r,range:!0}),r=new Date(a.getFullYear(),0,1),u.push({l:r.getFullYear(),d:r,header:!0});for(n=0;n<12;n+=1)r=new Date(a.getFullYear(),n,1),u.push({l:this._formatString(this.localizeString("monthViewLabelFormat","{0:MMM}"),r),d:r}),s=new Date(a.getFullYear(),n+1,1),a>=r&&a<=s&&(this._index=n+2);r=new Date(a.getFullYear()+1,0,1),u.push({l:r.getFullYear(),d:r,range:!0});break;default:r=new Date(a.getFullYear(),a.getMonth(),0),u.push({l:Globalize.format(r,"MMM",this._getCulture()),d:r,range:!0}),r=new Date(a.getFullYear(),a.getMonth(),1),u.push({l:Globalize.format(r,"MMM",this._getCulture()),d:r,header:!0}),i=r,n=2;while(i.getMonth()===a.getMonth())s=new Date(i.getFullYear(),i.getMonth(),i.getDate()+1),u.push({l:this._formatString(this.localizeString("dayViewLabelFormat","{0:d }"),i),d:i}),a>=i&&a<=s&&(this._index=n),i=s,n+=1;r=new Date(a.getFullYear(),a.getMonth()+1,1),u.push({l:Globalize.format(r,"MMM",this._getCulture()),d:r,range:!0})}return u},n.prototype._setSelectedIndex=function(e,t){typeof t=="undefined"&&(t=!1);var n=this.options,r;if(n.disabled)return;if(e>=this._min&&e<=this._max){this._dragActivated&&this._showTooltip(e);if(this._index!==e){if(this._datesDef[e].header){if(!t)return;e-=1}this._index=e,r=this._datesDef[e].d,n.selectedDate=r,this._max>2&&this._index===0?this._initBackground(!0,!0):this._index===this._max?(n.viewType==="week"&&(n.selectedDate=new Date(n.selectedDate.getFullYear(),n.selectedDate.getMonth(),n.selectedDate.getDate()+7)),this._initBackground(!0,!1),n.selectedDate=r):this.invalidate(),this._trigger("selectedDateChanged",null,{selectedDate:n.selectedDate})}}},n.prototype._pagelabelHover=function(e){var n=t(e.target),r=this.options;if(n.hasClass("wijmo-wijdatepager-pageheader"))return;n.addClass(r.wijCSS.stateHover)},n.prototype._showTooltip=function(e){var n=this.options,r=this._datesDef[e],i=n.viewType,s,o=this.element.find(".wijmo-wijdatepager-pagelabel")[e];this._tooltip||(this._tooltip=t('<div class="wijmo-wijdatepager-tooltip"><div class="wijmo-wijdatepager-tooltip-inner"></div><div class="wijmo-wijdatepager-triangle"></div></div>'),this.element.append(this._tooltip),this._tooltip.wijpopup()),s="";switch(i){case"week":r.d.getMonth()!==r.d2.getMonth()?s=this._formatString(this.localizeString("weekViewTooltip2MonthesFormat","{0:MMMM d} - {1:MMMM d, yyyy}"),r.d,r.d2):s=this._formatString(this.localizeString("weekViewTooltipFormat","{0:MMMM d} - {1:d, yyyy}"),r.d,r.d2);break;case"month":s=this._formatString(this.localizeString("monthViewTooltipFormat","{0:MMMM yyyy}"),r.d);break;default:s=this._formatString(this.localizeString("dayViewTooltipFormat","{0:dddd, MMMM d, yyyy}"),r.d)}t.ui&&(this._tooltip.wijpopup("show",{of:o,my:"center bottom",at:"center top",offset:"-10 -10"}),this._tooltip.find(".wijmo-wijdatepager-tooltip-inner").html(s))},n.prototype._hideTooltip=function(){this._tooltip.wijpopup("hide")},n.prototype._pagelabelHout=function(e){t(e.target).removeClass(this.options.wijCSS.stateHover)},n.prototype._pagelabelMouseDown=function(e){this._dragActivated=!1;if(this.options.disabled)return;e.preventDefault();var n=t(e.target),r;if(n.hasClass("wijmo-wijdatepager-pageheader"))return;r=this.element.find(".wijmo-wijdatepager-pagelabel").index(n),this._dragActivated=!0,this._setSelectedIndex(r),this._mouseDownTimeFix20555=(new Date).getTime(),this._startClientX=e.pageX,this._startInd=r,t(document).bind("mousemove."+this._dtpagernamespacekey,t.proxy(this._pageindicatorMouseMove,this)),t(document).bind("mouseup."+this._dtpagernamespacekey,t.proxy(this._pageindicatorMouseUp,this))},n.prototype._detectLeftButton=function(e){return e.originalEvent&&(e=e.originalEvent),"buttons"in e?e.buttons===1:"which"in e?e.which===1:e.button===1},n.prototype._pageindicatorMouseMove=function(e){if(!this._detectLeftButton(e)){this._pageindicatorMouseUp();return}e.preventDefault();if(this._isInAnimate)return;var t=this.element.find(".wijmo-wijdatepager-pagelabel")[this._startInd],n,r;if(!t)return;n=t.offsetLeft+Math.round(t.offsetWidth/2)+(e.pageX-this._startClientX),r=this._findClosesPageIndexByPos(n);if(this._prevMoveInd===r)return;this._prevMoveInd=r;if(this._mouseDownTimeFix20555+150>(new Date).getTime())return;r!==-1&&r!==this._index&&this._setSelectedIndex(r)},n.prototype._pageindicatorMouseUp=function(){this._dragActivated=!1,t(document).unbind("."+this._dtpagernamespacekey),this._hideTooltip()},n.prototype._findClosesPageIndexByPos=function(e){var t=this.element.find(".wijmo-wijdatepager-pages").find(".wijmo-wijdatepager-pagelabel"),n;for(n=0;n<t.length;n+=1)if(t[n].offsetLeft<e&&t[n].offsetLeft+t[n].offsetWidth>e)return n;return-1},n.prototype.localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},n.prototype._formatString=function(e,t,n,r){var i,s=arguments,o,u,a=this;if(s.length<=1)return Globalize.format(s);typeof e=="string"&&typeof window[e]=="function"&&(e=window[e]);if(typeof e=="function"){u=[];for(o=1;o<s.length;o+=1)u[o-1]=s[o];return e.apply(this,u)}return i=new RegExp("\\{(\\d+)(?:,([-+]?\\d+))?(?:\\:([^(^}]+)(?:\\(((?:\\\\\\)|[^)])+)\\)){0,1}){0,1}\\}","g"),e.replace(i,function(e,t,n,r,i){return e=s[Number(t)+1],r?Globalize.format(e,r,a._getCulture()):e})},n}(e.wijmoWidget);e.wijdatepager=r,r.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,{wijMobileCSS:{header:"ui-header ui-bar-a",content:"ui-body ui-body-c",stateDefault:"ui-btn-up-c"},initSelector:":jqmData(role='wijdatepager')",culture:"",localization:null,firstDayOfWeek:0,selectedDate:null,viewType:"day",nextTooltip:"right",prevTooltip:"left"}),t.wijmo.registerWidget(n,r.prototype)})(wijmo||(wijmo={}));