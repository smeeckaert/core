var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){(function(t){"use strict";var n=jQuery;(function(e){e._map=[],e.editOptional=1,e.editRequired=2,e.separator=4,e.literal=8})(t.wijchartype||(t.wijchartype={}));var r=t.wijchartype,i=function(e){function r(){e.apply(this,arguments),this._imMask=null,this._advanceMode=!1}return __extends(r,e),r._imMaskAssociatedoptions=["disabled","disableUserInput","blurOnLastChar","imeMode","blurOnLeftRightKey","tabAction","nullText","placeholder","readonly","promptChar","autoConvert","showNullText","hideEnter","hidePromptOnLeave"],r.prototype._createTextProvider=function(){this._textProvider=new o(this,this.options.mask,!1)},r.prototype._checkMaskAndPassword=function(){var e=!this.options.mask||this.options.mask.length<0;if(e&&this._isPassword())throw'Option "passwordChar" requires a mask'},r.prototype._updateIsPassword=function(){var e=this.options.passwordChar.length>0&&this.element.attr("type")!=="password";this.element.data("isPassword",e),this._checkMaskAndPassword()},r.prototype._beginUpdate=function(){this.element.addClass(this.options.wijCSS.wijinputmask),this._updateIsPassword(),this.element.data("defaultText",this.options.text)},r.prototype._setOption=function(t,n){switch(t){case"maskFormat":this._super(t,n),t="mask"}e.prototype._setOption.call(this,t,n);if(this._advanceMode)if(r._imMaskAssociatedoptions.indexOf)r._imMaskAssociatedoptions.indexOf(t)!==-1&&this._syncProperties();else for(var i=0;i<r._imMaskAssociatedoptions.length;i++)if(r._imMaskAssociatedoptions[i]===t){this._syncProperties();break}switch(t){case"text":this.setText(n);break;case"mask":case"culture":if(typeof n=="undefined"||n.length<=0)n="";this._checkMaskAndPassword();var s=this.getText();t==="mask"&&(this._textProvider.mask=n),this._checkFormatPattern(n),this._advanceMode?this._imMask.SetText(s):(this._textProvider.initialize(),this._textProvider.setText(s),this._updateText());break;case"promptChar":case"nullText":this._textProvider&&(this._textProvider.updatePromptChar(),this._updateText());break;case"hidePromptOnLeave":case"resetOnPrompt":this._updateText();break;case"passwordChar":this._updateIsPassword(),this._updateText()}},r.prototype._checkFormatPattern=function(n){if(n instanceof RegExp||this.options.formatMode==="advanced"){this._advanceMode||(this._detachInputEvent(),this._imMask||(this._imMask=new t.MaskControl,this._addimMaskCustomEvent()),this._imMask.AttachInput(this.element.get(0)),this._attachKeyEventForDropDownList(),this._advanceMode=!0);if(n instanceof RegExp){var r=n;this._imMask.SetFormatPattern(r.source)}else this._imMask.SetFormatPattern(n);this._syncProperties()}else this._advanceMode&&(this._imMask.DetachInput(),this._detachEventForDropDownList(),e.prototype._attachInputEvent.call(this)),this._advanceMode=!1},r.prototype._attachKeyEventForDropDownList=function(){this.element.bind({"keydown.wijinput":n.proxy(this._onKeyDownForDropDownList,this)})},r.prototype._detachEventForDropDownList=function(){this.element.unbind(".wijinput")},r.prototype._onKeyDownForDropDownList=function(t){e.prototype._processKeyForDropDownList.call(this,t)},r.prototype._syncProperties=function(){this._imMask.SetEnabled(!this.options.disabled),this._imMask.SetReadOnly(!!this.options.disableUserInput),this._imMask.SetExitOnLastChar(!!this.options.blurOnLastChar),this._imMask.SetImeMode(this.options.imeMode),this._imMask.SetExitOnLeftRightKey(this._convertExistOnLeftRightKey(this.options.blurOnLeftRightKey)),this._imMask.SetTabAction(this._convertTabAction(this.options.tabAction)),this._imMask.SetDisplayNull(this.options.nullText),this._imMask.SetHideEnter(!!this.options.hideEnter),this._imMask.SetPromptChar(this.options.promptChar),this._imMask.SetAutoConvert(!!this.options.autoConvert),this._imMask.SetHidePromptOnLeave(!!this.options.hidePromptOnLeave)},r.prototype._convertExistOnLeftRightKey=function(e){e||(e="none"),e=e.toLowerCase();if(e==="none")return t.ExitOnLeftRightKey.None;if(e==="left")return t.ExitOnLeftRightKey.Left;if(e==="right")return t.ExitOnLeftRightKey.Right;if(e==="both")return t.ExitOnLeftRightKey.Both},r.prototype._convertTabAction=function(e){return e||(e="control"),e=e.toLowerCase(),e==="control"?t.TabAction.Control:t.TabAction.Field},r.prototype._addimMaskCustomEvent=function(){var e=this;this._imMask.OnInvalidInput(function(t){e._fireIvalidInputEvent("")}),this._imMask.OnTextChanged(function(t){e._raiseTextChanged()}),this._imMask.OnEditingTextChanged(function(t){e._updateText(!0)})},r.prototype._processClearButton=function(){this._textProvider.clear(new t.wijInputResult),this._updateText();var e=this._textProvider.findEditPositionFrom(0,!0);this.selectText(e,e)},r.prototype._resetData=function(){var e=this.element.data("defaultText");if(e===undefined||e===null)e=this.element.data("elementValue");if(e===undefined||e===null)e="";this.setText(e)},r.prototype._isPassword=function(){return!!this.element.data("isPassword")},r.prototype._getTextWithPrompts=function(){return this._isInitialized()?this._textProvider.toString(!0,!0,!1):this.element.val()},r.prototype._getTextWithLiterals=function(){return this._isInitialized()?this._textProvider.toString(!0,!1,!0):this.element.val()},r.prototype._getTextWithPromptAndLiterals=function(){return this._isInitialized()?this._textProvider.toString(!0,!0,!0):this.element.val()},r.prototype._getTextWithPromptAndLiteralsAndPassword=function(){return this._isInitialized()?this._textProvider.toString(!1,!0,!0):this.element.val()},r.prototype._onChange=function(){if(!this.element)return;var e=this.element.val();this.getText()!==e&&this._getTextWithPrompts()!==e&&this._getTextWithPromptAndLiterals()!==e&&(this._textProvider.getPasswordChar()!==""?this._getTextWithPromptAndLiteralsAndPassword()!==e&&this.setText(e):this.setText(e))},r.prototype._afterFocused=function(){(this._isNullText()||!!this.options.hidePromptOnLeave)&&this._doFocus()},r.prototype._processTabKey=function(e){var t=this.options.tabAction;return t=t?t.toLowerCase():"control",t==="control"?!1:this._moveField(!e.shiftKey)},r.prototype._moveField=function(e){var t=this._textProvider._getFieldList(),n=this.element.wijtextselection(),r=n.start,i=-1;t.length>0&&r>t[t.length-1].end&&(i=t.length);if(i===-1)for(var s=0;s<t.length;s++){if(r>=t[s].start&&r<=t[s].end){i=s;break}if(r<t[s].start){s!=0?i=s:i=-1;break}}if(e){if(i===t.length-1)return!1;this.element.wijtextselection(t[i+1].start,t[i+1].start)}else{if(i<=0)return!1;this.element.wijtextselection(t[i-1].start,t[i-1].start)}return!0},r.prototype._processLeftRightKey=function(e){var t=this.element.wijtextselection(),n=this.options.blurOnLeftRightKey?this.options.blurOnLeftRightKey.toLowerCase():"none";if(e&&t.start===0){if(n==="both"||n==="left")return this._moveControl(this.element.get(0),!1,!0),!0}else{var r=n==="both"||n==="right",i=!1;this._textProvider.noMask&&t.start===this.options.text.length?i=!0:!this._textProvider.noMask&&t.start===this._textProvider.testString.length&&(i=!0);if(!e&&r&&i)return this._moveControl(this.element.get(0),!0,!0),!0}return!1},r.prototype._onKeyPress=function(t){if(!this._textProvider.noMask&&this.options.blurOnLastChar)var n=this._textProvider._isLastCharAssigned();e.prototype._onKeyPress.call(this,t);if(!this._textProvider.noMask&&this.options.blurOnLastChar){var r=this._textProvider._isLastCharAssigned();!n&&r&&this._moveControl(this.element.get(0),!0,!0)}},r.prototype.setText=function(t){if(t===undefined)return;this._advanceMode?this._imMask.SetValue(t):e.prototype.setText.call(this,t)},r.prototype.getText=function(){return this._advanceMode?this._imMask.GetTextOnSimpleMode():e.prototype.getText.call(this)},r.prototype.selectText=function(t,n){typeof t=="undefined"&&(t=0),typeof n=="undefined"&&(n=this.getText().length),isNaN(t)&&(t=0),isNaN(n)&&(n=0),this._advanceMode?(this._imMask.SetSelectionStart(t),this._imMask.SetSelectionLength(Math.abs(n-t)),this._imMask.SetFocus()):e.prototype.selectText.call(this,t,n)},r.prototype._attachInputEvent=function(){this._advanceMode?this._imMask.AttachInput(this.element.get(0)):e.prototype._attachInputEvent.call(this)},r.prototype._detachInputEvent=function(){this._advanceMode?this._imMask.DetachInput():e.prototype._detachInputEvent.call(this)},r.prototype.getPostValue=function(){return this._advanceMode?this._imMask.GetPostValueOnSimpleMode():e.prototype.getPostValue.call(this)},r.prototype._initialize=function(){this.options.maskFormat&&(this.options.mask=this.options.maskFormat),e.prototype._initialize.call(this)},r.prototype._init=function(){e.prototype._init.call(this);var t=this.options.text||this.element.val();this.options.mask&&this._setOption("mask",this.options.mask),t&&this._setOption("text",t)},r.prototype._updateText=function(t){typeof t=="undefined"&&(t=!1);if(!this.element.data("initialized"))if(this.options.mask instanceof RegExp||this.options.formatMode==="advanced")return;if(this._advanceMode){if(!this._isInitialized())return;if(this.element.is(":disabled"))return;var n=this._imMask.GetTextOnSimpleMode();n!==this.options.text&&(this.options.text=n,this._raiseTextChanged())}else e.prototype._updateText.call(this,t)},r.prototype.isFocused=function(){return this._advanceMode?this._imMask.IsFocused():e.prototype.isFocused.call(this)},r}(t.wijinputcore);t.wijinputmask=i;var s=function(){function e(){this.wijCSS={wijinputmask:t.wijinputcore.prototype.options.wijCSS.wijinput+"-mask"},this.autoConvert=!0,this.text=null,this.mask="",this.maskFormat="",this.promptChar="_",this.hidePromptOnLeave=!1,this.resetOnPrompt=!0,this.allowPromptAsInput=!1,this.passwordChar="",this.resetOnSpace=!0,this.skipLiterals=!0,this.blurOnLastChar=!1,this.tabAction="control",this.imeMode="auto"}return e}();i.prototype.options=n.extend(!0,{},t.wijinputcore.prototype.options,new s),n.wijmo.registerWidget("wijinputmask",i.prototype);var o=function(i){function s(e,t,n){i.call(this),this.inputWidget=e,this.mask=t,this.asciiOnly=n,this.testString="",this.assignedCharCount=0,this.requiredCharCount=0,this.noMask=!1,this._autoConvertPosition=0,this._needCheckNextChar=!1,this.descriptors=[],this.initialize()}return __extends(s,i),s.FK_K="K",s.FK_H="H",s.FK_DB_9=t.CharProcess.CharEx.ToFullWidth("9").text,s.FK_DB_K=t.CharProcess.CharEx.ToFullWidth("K").text,s.FK_DB_J=t.CharProcess.CharEx.ToFullWidth("J").text,s.FK_DB_Z=t.CharProcess.CharEx.ToFullWidth("Z").text,s.DBCS_0=t.CharProcess.CharEx.ToFullWidth("0").text,s.DBCS_9=t.CharProcess.CharEx.ToFullWidth("9").text,s.DBCS_A=t.CharProcess.CharEx.ToFullWidth("A").text,s.DBCS_a=t.CharProcess.CharEx.ToFullWidth("a").text,s.DBCS_Z=t.CharProcess.CharEx.ToFullWidth("Z").text,s.DBCS_z=t.CharProcess.CharEx.ToFullWidth("z").text,s.prototype.initialize=function(){this.noMask=!this.mask||this.mask.length<=0;if(this.noMask)return;this.testString="",this.assignedCharCount=0,this.requiredCharCount=0,this.descriptors=[];var e="none",t=!1,n=r.literal,i="",o=this.inputWidget._getCulture();for(var a=0;a<this.mask.length;a++){var f=!1,l=this.mask.charAt(a);t&&(t=!1,f=!0);if(!f){var c=l;if(c<="C"){switch(c){case"#":case"9":case"?":case"C":l=this.getPromtChar(),n=r.editOptional,f=!0;break;case"$":i=o.numberFormat.currency.symbol,n=r.separator,f=!0;break;case"%":case"-":case";":case"=":case"@":n=r.literal,f=!0;break;case"&":case"0":case"A":l=this.getPromtChar(),n=r.editRequired,f=!0;break;case",":i=o.numberFormat[","],n=r.separator,f=!0;break;case".":i=o.numberFormat["."],n=r.separator,f=!0;break;case"/":i=o.calendars.standard["/"],n=r.separator,f=!0;break;case":":i=o.calendars.standard[":"],n=r.separator,f=!0;break;case"<":e="lower";continue;case">":e="upper";continue}f||(n=r.literal,f=!0)}if(!f){if(c<="\\"){switch(c){case s.FK_K:case s.FK_H:case"L":l=this.getPromtChar(),n=r.editRequired,f=!0;break;case"\\":t=!0,n=r.literal;continue}f||(n=r.literal,f=!0)}if(!f){c==="a"&&(l=this.getPromtChar(),n=r.editOptional,f=!0);switch(c){case s.FK_DB_K:case s.FK_DB_J:case s.FK_DB_9:case s.FK_DB_Z:l=this.getPromtChar(),n=r.editRequired,f=!0}if(!f){c!=="|"&&(n=r.literal,f=!0);if(!f){e="none";continue}}}}}if(f){var h=new u(a,n);this.isEditDesc(h)&&(h.caseConversion=e),n!==r.separator&&(i=l);for(var p=0;p<i.length;p++)this.testString=this.testString+i.charAt(p),this.descriptors[this.descriptors.length]=h}}},s.prototype.getAllowPromptAsInput=function(){return this.inputWidget?this.inputWidget.options.allowPromptAsInput:!1},s.prototype.getPasswordChar=function(){var e=this.inputWidget?this.inputWidget.options.passwordChar:"*";return e===""&&(e="*"),e.length>1?e.charAt(0):e},s.prototype.isPassword=function(){return this.inputWidget?this.inputWidget._isPassword():!1},s.prototype.getResetOnPrompt=function(){return this.inputWidget?this.inputWidget.options.resetOnPrompt:!0},s.prototype.getResetOnSpace=function(){return this.inputWidget?this.inputWidget.options.resetOnSpace:!0},s.prototype.getSkipLiterals=function(){return this.inputWidget?this.inputWidget.options.skipLiterals:!0},s.prototype.getHidePromptOnLeave=function(){return this.inputWidget?this.inputWidget.options.hidePromptOnLeave:!1},s.prototype._trueOR=function(e,t){return(e>>>1|t>>>1)*2+(e&1|t&1)},s.prototype.setValue=function(e){return!1},s.prototype.getValue=function(){return null},s.prototype.getPromtChar=function(){var e=this.inputWidget?this.inputWidget.options.promptChar:"_";return e===""&&(e="_"),e.length>1?e.charAt(0):e},s.prototype.getAutoConvert=function(){return this.inputWidget?this.inputWidget.options.autoConvert:!0},s.prototype.updatePromptChar=function(){if(this.noMask)return;for(var e=0;e<this.descriptors.length;e++){var t=this.descriptors[e];if(t.charType===r.editOptional||t.charType===r.editRequired)t.isAssigned||(this.testString=n.wij.charValidator.setChar(this.testString,this.getPromtChar(),e))}},s.prototype.resetChar=function(e){var t=this.descriptors[e];this.isEditPos(e)&&t.isAssigned&&(t.isAssigned=!1,this.testString=n.wij.charValidator.setChar(this.testString,this.getPromtChar(),e),this.assignedCharCount--,t.charType===r.editRequired&&this.requiredCharCount--)},s.prototype.getAdjustedPos=function(e){return this.noMask?e=Math.min(e,this.testString.length-1):e>=this.descriptors.length&&e--,Math.max(0,e)},s.prototype.findNonEditPositionInRange=function(e,t,n){var i=this._trueOR(r.literal,r.separator);return this.findPositionInRange(e,t,n,i)},s.prototype.findPositionInRange=function(e,t,n,r){e=Math.max(0,e),t=Math.min(t,this.testString.length-1);if(e<=t)while(e<=t){var i=n?e++:t--,s=this.descriptors[i];if((s.charType&4294967295&(r&4294967295))===s.charType)return i}return-1},s.prototype.findAssignedEditPositionInRange=function(e,t,n){return this.assignedCharCount===0?-1:this.findEditPositionInRange(e,t,n,r.editRequired)},s.prototype.findEditPositionInRange=function(e,t,n,i){do{var s=this._trueOR(r.editRequired,r.editOptional),o=this.findPositionInRange(e,t,n,s);if(o===-1)break;var u=this.descriptors[o];switch(i){case r.editOptional:if(!u.isAssigned)return o;break;case r.editRequired:if(u.isAssigned)return o;break;default:return o}n?e++:t--}while(e<=t);return-1},s.prototype.findAssignedEditPositionFrom=function(e,t){if(!this.assignedCharCount)return-1;var n,r;return t?(n=e,r=this.testString.length-1):(n=0,r=e),this.findAssignedEditPositionInRange(n,r,t)},s.prototype.findEditPositionFrom=function(e,t){var n,r;return t?(n=e,r=this.testString.length-1):(n=0,r=e),this.findEditPositionInRange(n,r,t,0)},s.prototype.setChar=function(t,i,s){if(this.getAutoConvert()){var o=new e.input.wijInputResult,u=this.testInternal(t,i,o);if(!u){var a=this._convert(t,0);if(t.length===0)debugger;t=a.strValue.charAt(0),a.strValue.length>1&&this.inputWidget.element.data("appendChar",a.strValue.charAt(1)),a.index===2&&this.inputWidget.element.data("skipNextChar",!0)}}i=Math.max(0,i),s||(s=this.descriptors[i]),this.testEscapeChar(t,i,s)?this.resetChar(i):(n.wij.charValidator.isLetter(t)&&(n.wij.charValidator.isUpper(t)?s.caseConversion==="lower"&&(t=t.toLowerCase()):s.caseConversion==="upper"&&(t=t.toUpperCase())),this.testString=n.wij.charValidator.setChar(this.testString,t,i),s.isAssigned||(s.isAssigned=!0,this.assignedCharCount++,s.charType===r.editRequired&&this.requiredCharCount++))},s.prototype.internalInsertAt=function(e,n,r,i){if(e.length===0)return r.testPosition=n,r.hint=r.noEffect,!0;if(!this._testString(e,n,r))return!1;var s=this.findEditPositionFrom(n,!0),o=this.findAssignedEditPositionInRange(s,r.testPosition,!0)!==-1;if(o&&r.testPosition===this.testString.length-1)return r.hint=r.unavailableEditPosition,r.testPosition=this.testString.length,!1;var u=this.findEditPositionFrom(r.testPosition+1,!0);if(o){var a=new t.wijInputResult;a.hint=a.unknown;var f=!0,l=this.findAssignedEditPositionFrom(this.testString.length-1,!1);while(f){f=!1;if(u===-1)return r.hint=r.unavailableEditPosition,r.testPosition=this.testString.length,!1;var c=this.testChar(this.testString.charAt(s),u,a);if(this.descriptors[s].isAssigned&&!c)return r.hint=a.hint,r.testPosition=u,!1;if(s!==l){s=this.findEditPositionFrom(s+1,!0),u=this.findEditPositionFrom(u+1,!0),f=!0;continue}}r.hint=Math.max(r.hint,a.hint)}if(!i){if(o)while(s>=n)this.descriptors[s].isAssigned?this.setChar(this.testString.charAt(s),u):this.resetChar(u),u=this.findEditPositionFrom(u-1,!1),s=this.findEditPositionFrom(s-1,!1);this.setString(e,n)}return!0},s.prototype.insertAt=function(e,n,r){typeof r=="undefined"&&(r=new t.wijInputResult);if(e===undefined)throw"InsertAt: input";return this.noMask?(this.testString=this.testString.substring(0,n)+e+this.testString.substring(n,this.testString.length),r.testPosition=n+e.length-1,!0):n>=0&&n<this.testString.length?this.internalInsertAt(e,n,r,!1):(r.testPosition=n,r.hint=r.positionOutOfRange,!1)},s.prototype.clear=function(e){if(this.noMask){this.testString="",e.hint=e.success;return}if(!this.assignedCharCount)e.hint=e.noEffect;else{e.hint=e.success;for(var t=0;t<this.testString.length;t++)this.resetChar(t)}},s.prototype.isLiteral=function(e){return e?e.charType===r.literal||e.charType===r.separator:!1},s.prototype.testEscapeChar=function(e,t,n){t=Math.max(0,t),n||(n=this.descriptors[t]);if(this.isLiteral(n))return this.getSkipLiterals()?e===this.testString.charAt(t):!1;var r=this.getResetOnPrompt()&&e===this.getPromtChar(),i=this.getResetOnSpace()&&e===" ";return r||i},s.prototype.testChar=function(e,t,n){var r=this.testInternal(e,t,n);if(!r&&this.getAutoConvert()){this._autoConvertPosition=t;var i=this._convert(e,0);r=i.strValue.length>0,i.strValue.length>1&&this.inputWidget.element.data("appendChar",i.strValue.charAt(1)),i.index===2&&this.inputWidget.element.data("skipNextChar",!0)}return r},s.prototype.testInternal=function(e,r,i){if(!n.wij.charValidator.isPrintableChar(e))return i.hint=i.invalidInput,!1;var o=this.descriptors[r];if(!o)return!1;if(this.isLiteral(o))return this.getSkipLiterals()&&e===this.testString.charAt(r)?(i.hint=i.characterEscaped,!0):(i.hint=i.nonEditPosition,!1);if(e===this.getPromtChar()){if(this.getResetOnPrompt())return this.isEditDesc(o)&&o.isAssigned?i.hint=i.sideEffect:i.hint=i.characterEscaped,!0;if(!this.getAllowPromptAsInput())return i.hint=i.promptCharNotAllowed,!1}if(e===" "&&this.getResetOnSpace())return this.isEditDesc(o)&&o.isAssigned?i.hint=i.sideEffect:i.hint=i.characterEscaped,!0;switch(this.mask.charAt(o.maskPosition)){case"L":if(!n.wij.charValidator.isLetter(e))return i.hint=i.letterExpected,!1;if(!n.wij.charValidator.isAsciiLetter(e)&&this.asciiOnly)return i.hint=i.asciiCharacterExpected,!1;break;case"?":if(!n.wij.charValidator.isLetter(e)&&e!==" ")return i.hint=i.letterExpected,!1;if(!n.wij.charValidator.isAsciiLetter(e)&&this.asciiOnly)return i.hint=i.asciiCharacterExpected,!1;break;case"A":if(!n.wij.charValidator.isAlphanumeric(e))return i.hint=i.alphanumericCharacterExpected,!1;if(!n.wij.charValidator.isAciiAlphanumeric(e)&&this.asciiOnly)return i.hint=i.asciiCharacterExpected,!1;break;case"a":if(!n.wij.charValidator.isAlphanumeric(e)&&e!==" ")return i.hint=i.alphanumericCharacterExpected,!1;if(!n.wij.charValidator.isAciiAlphanumeric(e)&&this.asciiOnly)return i.hint=i.asciiCharacterExpected,!1;break;case"&":if(!n.wij.charValidator.isAscii(e)&&this.asciiOnly)return i.hint=i.asciiCharacterExpected,!1;break;case"C":if(!n.wij.charValidator.isAscii(e)&&this.asciiOnly&&e!==" ")return i.hint=i.asciiCharacterExpected,!1;break;case"0":if(!n.wij.charValidator.isDigit(e))return i.hint=i.digitExpected,!1;break;case"9":if(!n.wij.charValidator.isDigit(e)&&e!==" ")return i.hint=i.digitExpected,!1;break;case s.FK_DB_9:if(!(e>=s.DBCS_0&&e<=s.DBCS_9)&&e!==" ")return!1;break;case"#":if(!n.wij.charValidator.isDigit(e)&&e!=="-"&&e!=="+"&&e!==" ")return i.hint=i.digitExpected,!1;break;case s.FK_K:if(!!t.CharProcess.CharEx.IsFullWidth(e)||!t.CharProcess.CharEx.IsKatakana(e))return!1;break;case s.FK_H:if(t.CharProcess.CharEx.IsFullWidth(e))return!1;break;case s.FK_DB_K:if(!t.CharProcess.CharEx.IsFullWidth(e)||!t.CharProcess.CharEx.IsKatakana(e))return!1;break;case s.FK_DB_J:if(!t.CharProcess.CharEx.IsHiragana(e))return!1;break;case s.FK_DB_Z:if(!t.CharProcess.CharEx.IsFullWidth(e))return!1}return e===this.testString.charAt(r)&&o.isAssigned?i.hint=i.noEffect:i.hint=i.success,!0},s.prototype._convert=function(e,n){var r={};r.success=!0,r.strValue="",r.index=n;var i=e.Substring(n,n+1),s,o=t.CharProcess.CharEx,u=!0;if(o.IsAlphabet(i)){var a=o.IsLower(i)?i.toUpperCase():i.toLowerCase();return s=this._isValid(a),s&&u||!s&&!u?(n++,r.index=n,r.strValue=a,r):(i=o.IsFullWidth(i)?o.ToHalfWidth(i):o.ToFullWidth(i).text,s=this._isValid(i),s&&u||!s&&!u?(n++,r.index=n,r.strValue=i,r):(a=o.IsFullWidth(a)?o.ToHalfWidth(a):o.ToFullWidth(a).text,s=this._isValid(a),s&&u||!s&&!u?(n++,r.index=n,r.strValue=a,r):(r.success=!1,r)))}if(o.IsHiragana(i)){if(o.IsLowerKana(i)){var f=o.ToUpperKana(i);s=this._isValid(f);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=f,r}else if(o.HasLowerKana(i)){var l=o.ToLowerKana(i);s=this._isValid(l);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=l,r}i=o.ToKatakana(i),s=this._isValid(i);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=i,r;if(o.IsLowerKana(i)){var f=o.ToUpperKana(i);s=this._isValid(f);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=f,r}else if(o.HasLowerKana(i)){var l=o.ToLowerKana(i);s=this._isValid(l);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=l,r}var c=o.ToHalfWidthEx(i);s=this._isValid(c);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=c,r;if(o.IsLowerKana(c)){c=o.ToUpperKana(c),s=this._isValid(c);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=c,r}else if(o.HasLowerKana(c)){c=o.ToLowerKana(c),s=this._isValid(c);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=c,r}return r.success=!1,r}if(o.IsKatakana(i)){if(o.IsLowerKana(i)){var f=o.ToUpperKana(i);s=this._isValid(f);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=f,r}else if(o.HasLowerKana(i)){var l=o.ToLowerKana(i);s=this._isValid(l);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=l,r}var a=i,h=!1;if(o.IsFullWidth(i)){var p=o.ToHalfWidthEx(i);if(p.GetLength()>0){s=this._isValid(p);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=p,r}if(o.IsLowerKana(p)){p=o.ToUpperKana(p),s=this._isValid(p);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=p,r}else if(o.HasLowerKana(p)){p=o.ToLowerKana(p),s=this._isValid(p);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=p,r}}else{if(n==null){a=o.ToFullWidth(i).text;if(!o.IsKatakana(a))return r;s=this._isValid(a);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=a,r}else{var d=this.inputWidget.element.data("nextChar");if(this._needCheckNextChar&&d&&d.length>0){var v=o.ToFullWidth(e+d);a=v.text,h=v.processedAll}else a=o.ToFullWidth(i).text;if(!o.IsKatakana(a))return r;s=this._isValid(a);if(s&&u||!s&&!u)return n++,h&&n++,r.index=n,r.strValue=a,r}if(o.IsLowerKana(a)){var f=o.ToUpperKana(a);s=this._isValid(f);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=f,r}else if(o.HasLowerKana(a)){var l=o.ToLowerKana(a);s=this._isValid(l);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=l,r}}a=o.ToHiragana(a),s=this._isValid(a);if(s&&u||!s&&!u)return n++,h&&n++,r.index=n,r.strValue=a,a=="\u3094"&&(h?r.strValue="\u3046\u309b":(n--,r.index=n,r.strValue="",r.success=!1)),r;if(o.IsLowerKana(a)){var f=o.ToUpperKana(a);s=this._isValid(f);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=f,r}else if(o.HasLowerKana(a)){var l=o.ToLowerKana(a);s=this._isValid(l);if(s&&u||!s&&!u)return n++,r.index=n,r.strValue=l,r}}return i=o.IsFullWidth(i)?o.ToHalfWidth(i):o.ToFullWidth(i).text,s=this._isValid(i),s&&u||!s&&!u?(n++,r.index=n,r.strValue=i,r):(r.success=!1,r)},s.prototype._isValid=function(t){var n=new e.input.wijInputResult;return this.testInternal(t,this._autoConvertPosition,n)},s.prototype._testString=function(e,n,r){r.hint=r.unknown,r.testPosition=n;if(e.length){var i=new t.wijInputResult;i.testPosition=r.testPosition,i.hint=r.hint;for(var s=0;s<e.length;s++){if(r.testPosition>this.testString.length)return r.hint=r.unavailableEditPosition,!1;var o=e.charAt(s);if(!this.testEscapeChar(o,r.testPosition)){r.testPosition=this.findEditPositionFrom(r.testPosition,!0);if(r.testPosition===-1)return r.testPosition=this.testString.length,r.hint=r.unavailableEditPosition,!1}this._needCheckNextChar=!0,this.inputWidget.element.data("batchKeyPress")||this.inputWidget.element.data("nextChar",s===e.length-1?"":e.charAt(s+1));if(!this.testChar(o,r.testPosition,i))return r.hint=i.hint,this._needCheckNextChar=!1,this.inputWidget.element.data("batchKeyPress")||this.inputWidget.element.data("nextChar",""),!1;this._needCheckNextChar=!1;if(!this.inputWidget.element.data("batchKeyPress")){this.inputWidget.element.data("nextChar","");var u=this.inputWidget.element.data("appendChar");if(u&&u.length>0){this.inputWidget.element.data("appendChar",""),r.testPosition++;if(!this.testChar(u,r.testPosition,i))return r.hint=i.hint,this._needCheckNextChar=!1,!1}this.inputWidget.element.data("skipNextChar")&&(s++,this.inputWidget.element.data("skipNextChar",!1))}r.hint=Math.max(i.hint,r.hint),r.testPosition++;if(r.testPosition===this.testString.length)break}r.testPosition--}return!0},s.prototype.setText=function(e,n){typeof n=="undefined"&&(n=new t.wijInputResult);if(e===undefined)throw"SetFromPos: input parameter is null or undefined.";n.hint=n.unknown,n.testPosition=0;if(!e.length)return this.clear(n),!0;if(this.noMask)return this.testString=e,!0;if(!this.testSetString(e,n.testPosition,n))return!1;var r=this.findAssignedEditPositionFrom(n.testPosition+1,!0);return r!==-1&&this.resetString(r,this.testString.length-1),!0},s.prototype.resetString=function(e,t){if(this.noMask){this.testString="";return}e=this.findAssignedEditPositionFrom(e,!0);if(e!==-1){t=this.findAssignedEditPositionFrom(t,!1);while(e<=t)e=this.findAssignedEditPositionFrom(e,!0),this.resetChar(e),e++}},s.prototype.setString=function(e,t){for(var n=0;n<e.length;n++){var r=e.charAt(n);this.testEscapeChar(r,t)||(t=this.findEditPositionFrom(t,!0));if(t<0||t>=this.testString.length)return;this.inputWidget.element.data("batchKeyPress")||this.inputWidget.element.data("nextChar",n===e.length-1?"":e.charAt(n+1)),this._needCheckNextChar=!0,this.setChar(r,t),t++,this._needCheckNextChar=!1;if(!this.inputWidget.element.data("batchKeyPress")){this.inputWidget.element.data("nextChar","");var i=this.inputWidget.element.data("appendChar");i&&i.length>0&&(this.inputWidget.element.data("appendChar",""),this.inputWidget.element.data("nextChar",""),this.testEscapeChar(i,t)||(t=this.findEditPositionFrom(t,!0)),this.setChar(i,t),t++),this.inputWidget.element.data("skipNextChar")&&(n++,this.inputWidget.element.data("skipNextChar",!1))}}},s.prototype.testSetString=function(e,t,n){return e.length>this.testString.length&&(e=e.substring(0,this.testString.length)),this._testString(e,t,n)?(this.setString(e,t),!0):!1},s.prototype.isAllDecriptorUnAssigned=function(){for(var e=0;e<this.testString.length;e++){var t=this.descriptors[e];if(t&&(t.charType===r.editOptional||t.charType===r.editRequired)&&t.isAssigned)return!1}return!0},s.prototype.toString=function(e,t,n,i,s){var o=this.inputWidget._showNullText(),u=!this.inputWidget.isFocused(),a=this.isAllDecriptorUnAssigned();if(o&&u&&a)return this.inputWidget.options.nullText;e=e===undefined?!this.isPassword():e;var f=this.getHidePromptOnLeave()?this.inputWidget.isFocused():!0;t=t===undefined?f:t,n=n===undefined?!0:n;if(this.noMask){if(!e){var l="";for(var c=0;c<this.testString.length;c++)l+=this.getPasswordChar();return l}return this.testString}i=i===undefined?0:i,s=s===undefined?this.testString.length:s;if(s<=0)return"";i=Math.max(0,i);if(i>=this.testString.length)return"";var h=this.testString.length-i;s=Math.min(s,h),o=!this.isPassword()||e,u=t&&n;if(o&&u)return this.testString.substring(i,s-i);var p="",d=i+s-1;for(var v=i;v<=d;v++){var m=this.testString.charAt(v),g=this.descriptors[v];switch(g.charType){case r.editOptional:case r.editRequired:if(!g.isAssigned)break;if(!this.isPassword()||e){p+=m;continue}p+=this.getPasswordChar();continue;case r.editRequired|r.editOptional:p+=m;continue;case r.separator:case r.literal:if(!n)continue;p+=m;continue;default:p+=m;continue}if(t){p+=m;continue}p+=" ";continue}return p},s.prototype.isEditDesc=function(e){return this.noMask?!0:e.charType===r.editRequired||e.charType===r.editOptional},s.prototype.isEditPos=function(e){if(this.noMask)return!0;if(e<0||e>=this.testString.length)return!1;var t=this.descriptors[e];return this.isEditDesc(t)},s.prototype.internalRemoveAt=function(e,n,r,i){typeof i=="undefined"&&(i=!1);if(this.noMask){try{this.testString=this.testString.substring(0,e)+this.testString.substring(n+1,this.testString.length),r.testPosition=e}catch(s){}return!0}var o=this.findAssignedEditPositionFrom(this.testString.length-1,!1),u=this.findEditPositionInRange(e,n,!0,0);r.hint=r.noEffect;if(u===-1||u>o)return r.testPosition=e,!0;r.testPosition=e,this.findAssignedEditPositionInRange(e,n,!0)!==-1&&(r.hint=r.success);if(n<o){var a=this.findEditPositionFrom(n+1,!0),f=a;e=u;var l=!0,c=new t.wijInputResult;while(l){l=!1;var h=this.testString.charAt(a),p=this.descriptors[a],d=h!==this.getPromtChar()||p.isAssigned,v=!this.testChar(h,u,c);if(d&&v)return r.hint=c.hint,r.testPosition=u,!1;if(a!==o){a=this.findEditPositionFrom(a+1,!0),u=this.findEditPositionFrom(u+1,!0),l=!0;continue}}r.sideEffect>r.hint&&(r.hint=r.sideEffect);if(i)return!0;a=f,u=e,l=!0;while(l){l=!1;var m=this.testString.charAt(a),g=this.descriptors[a];m===this.getPromtChar()&&!g.isAssigned?this.resetChar(u):(this.setChar(m,u),this.resetChar(a));if(a!==o){a=this.findEditPositionFrom(a+1,!0),u=this.findEditPositionFrom(u+1,!0),l=!0;continue}}e=u+1}return e<=n&&this.resetString(e,n),!0},s.prototype.removeAt=function(e,n,r){return typeof n=="undefined"&&(n=e),typeof r=="undefined"&&(r=new t.wijInputResult),n>=this.testString.length?(r.testPosition=n,r.hint=r.positionOutOfRange,!1):e>=0&&e<=n?this.internalRemoveAt(e,n,r,!1):(r.testPosition=e,r.hint=r.positionOutOfRange,!1)},s.prototype._isLastCharAssigned=function(){var e=this.findEditPositionFrom(this.testString.length,!1);return e>=0&&e<this.testString.length?this.descriptors[e].isAssigned:!1},s.prototype._getFieldList=function(){var e=[],t=this.findEditPositionFrom(0,!0);while(t>=0&&t<this.testString.length)e.push(t),t=this.findEditPositionFrom(t+1,!0);var n=[];if(e.length>0){var r=e[0],i=1,s=r;while(i<e.length)e[i]-r!=1&&(n.push({start:s,end:r}),s=e[i]),r=e[i],i++;n.push({start:s,end:r})}return n},s}(t.wijTextProvider);t.wijMaskedTextProvider=o;var u=function(){function e(e,t){this.maskPos=e,this.charType=t,this.caseConversion="none",this.isAssigned=!1,this.maskPosition=0,this.maskPosition=e,this.charType=t}return e}();t.wijCharDescriptor=u})(e.input||(e.input={}));var t=e.input})(wijmo||(wijmo={}));