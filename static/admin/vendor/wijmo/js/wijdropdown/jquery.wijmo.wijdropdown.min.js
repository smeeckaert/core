var __extends=this.__extends||function(e,a){function c(){this.constructor=e}c.prototype=a.prototype;e.prototype=new c()};var wijmo;(function(b){var d=jQuery,c="wijdropdown";var a=(function(f){__extends(e,f);function e(){f.apply(this,arguments)}e.prototype._setOption=function(h,i){var g=this,j=g.options.wijCSS;f.prototype._setOption.call(this,h,i);if(h==="disabled"){g._labelWrap.toggleClass(j.stateDisabled,i);g._label.toggleClass(j.stateDisabled,i);g.element.attr("disabled",i?"disabled":"")}};e.prototype._create=function(){var g=this,h=g.element;if(window.wijmoApplyWijTouchUtilEvents){d=window.wijmoApplyWijTouchUtilEvents(d)}if(h.get(0).tagName.toLowerCase()!=="select"){return}if(h.is(":visible")){g._activeItem=null;g._createSelect();g._bindEvents();g.needInit=false}else{g.needInit=true}if(g.element.is(":hidden")&&g.element.wijAddVisibilityObserver){g.element.wijAddVisibilityObserver(function(){g.refresh();if(g.element.wijRemoveVisibilityObserver){g.element.wijRemoveVisibilityObserver()}},"wijdropdown")}};e.prototype._createSelect=function(){var s=this,i=s.options,r=s.options.wijCSS,t=s.element,h=t.outerWidth(),k=h,j=t.wrap("<div></div>").parent().addClass(r.helperHidden),g=j.wrap("<div></div>").parent().attr("role","select").addClass(r.wijdropdown).addClass(r.widget).addClass(r.stateDefault).addClass(r.cornerAll).addClass(r.helperClearFix),q=d("<label></label>").addClass(r.wijdropdownLabel).addClass(r.cornerAll).attr("id",t.get(0).id+"_select").attr("name",t.attr("name")||""),p=d("<div></div>").addClass(r.wijdropdownTrigger).addClass(r.stateDefault).addClass(r.cornerRight),l=d('<a href="#"></a>'),n=d("<div>").addClass(r.wijmodropdown),m=d("<ul></ul>").addClass(r.wijdropdownList).addClass(r.content).addClass(r.widget).addClass(r.cornerAll).addClass(r.helperReset).appendTo(n);d("<span></span>").addClass(r.icon).addClass(r.iconArrowDown).appendTo(p);h=Math.max(h,g.width());if(t.get(0).tabIndex!==""){l.attr("tabindex",t.attr("tabindex"))}if(t.get(0).disabled!==false){s.options.disabled=true}if(s.options.disabled){l.addClass(r.stateDisabled);q.addClass(r.stateDisabled)}l.append(q);g.append(j).append(l).append(p);if(i.ensureDropDownOnBody){n.wrap(d("<div></div>").addClass(r.wijdropdown)).parent().appendTo("body").css("position","absolute")}else{g.append(n)}k+=parseInt(q.css("padding-left").replace(/px/,""),10);k+=parseInt(q.css("padding-right").replace(/px/,""),10);k-=16;g.width(k);s._buildList(m,n,k);s._rightTrigger=p;s._label=q;s._listContainer=n;s._list=m;s._value=t.val();s._selectedIndex=d("option",t).index(t.find("option:selected"));s._selectWrap=j;s._labelWrap=l;s._container=g;g.attr("title",t.attr("title"));t.removeAttr("title")};e.prototype._buildList=function(k,m,i){var h=this,l=h.options.wijCSS,j=h.element,g;m.show();j.children().each(function(o,t){var q=d(t),s,p,r;if(q.is("option")){k.append(h._buildItem(q))}else{s=d("<li></li>").addClass(l.wijdropdownOptgroup);p=d("<span>"+q.attr("label")+"</span>").addClass(l.wijdropdownOptgroupHeader).addClass(l.priorityPrimary);r=d("<ul></ul>").addClass(l.helperReset).addClass(l.wijdropdownItems);q.children("option").each(function(){r.append(h._buildItem(d(this)));return this});s.append(p).append(r);k.append(s)}return this});m.height("");g=m.height();g=k.outerHeight()<g?k.outerHeight():g;m.css({height:g,width:i});if(d.browser.msie&&/^[8]\.[0-9]+/.test(d.browser.version)){k.setOutWidth(i-19)}else{k.setOutWidth(i-18)}if(m.data("wijmoWijsuperpanel")){m.wijsuperpanel("paintPanel");h.superpanel=m.data("wijmoWijsuperpanel")}else{h.superpanel=m.wijsuperpanel().data("wijmoWijsuperpanel")}if(d.fn.bgiframe){h.superpanel.element.bgiframe()}if(!h.superpanel.vNeedScrollBar){if(d.browser.msie&&/^[8]\.[0-9]+/.test(d.browser.version)){k.setOutWidth(i-1)}else{k.setOutWidth(i)}h.superpanel.refresh()}m.hide()};e.prototype._handelEvents=function(j){var g=this,k=g.options.wijCSS,i="."+g.widgetName,h=g.element;j.bind("click"+i,function(l){if(g.options.disabled){return}if(g._listContainer.is(":hidden")){g._show()}else{g._hide()}h.click();if(j.get(0)===g._label.get(0)){l.preventDefault()}else{g._labelWrap.focus();l.preventDefault()}}).bind("mouseover"+i,function(){if(g.options.disabled){return}g._label.addClass(k.stateHover);g._rightTrigger.addClass(k.stateHover);h.trigger("mouseover")}).bind("mouseout"+i,function(){if(g.options.disabled){return}g._label.removeClass(k.stateHover);g._rightTrigger.removeClass(k.stateHover);h.trigger("mouseout")}).bind("mousedown"+i,function(){if(g.options.disabled){return}g._label.addClass(k.stateActive);g._rightTrigger.addClass(k.stateActive);h.trigger("mousedown")}).bind("mouseup"+i,function(){if(g.options.disabled){return}g._label.removeClass(k.stateActive);g._rightTrigger.removeClass(k.stateActive);h.trigger("mouseup")})};e.prototype._bindEvents=function(){var o=this,l=o.options.wijCSS,h="."+o.widgetName,n=o._label,m=o._rightTrigger,j=o._labelWrap,k=o._listContainer,p=o.element,g=false,i;o._handelEvents(o._label);o._handelEvents(o._rightTrigger);d(window).bind("resize",function(q){o._setListContainerPosition()}),d(document).bind("mouseup"+h,function(q){if(k.is(":hidden")){n.removeClass(l.stateFocus);m.removeClass(l.stateFocus);return}i=k.offset();if(q.target===n.get(0)||q.target===m.get(0)||q.target===m.children().get(0)){return}if(q.pageX<i.left||q.pageX>i.left+k.width()||q.pageY<i.top||q.pageY>i.top+k.height()){n.removeClass(l.stateFocus);m.removeClass(l.stateFocus);o._hide()}});k.bind("click"+h,function(r){var q=d(r.target);if(q.closest("li."+l.wijdropdownItem,d(this).get(0)).length>0){o._setValue();k.css("z-index","");if(d.browser.msie&&/^[6,7].[0-9]+/.test(d.browser.version)){k.parent().css("z-index","")}k.hide();o._setValueToEle()}p.click()});j.bind("keydown"+h,function(r){if(o.options.disabled){return}var q=d.ui.keyCode;switch(r.which){case q.UP:case q.LEFT:o._previous();o._setValue();o._setValueToEle();break;case q.DOWN:case q.RIGHT:o._next();o._setValue();o._setValueToEle();break;case q.PAGE_DOWN:o._nextPage();o._setValue();o._setValueToEle();break;case q.PAGE_UP:o._previousPage();o._setValue();o._setValueToEle();break;case q.ENTER:case q.NUMPAD_ENTER:o._setValue();o._listContainer.hide();o._setValueToEle();break}if(r.which!==q.TAB){r.preventDefault()}p.trigger("keydown")}).bind("focus"+h,function(){if(o.options.disabled){return}n.addClass(l.stateFocus);m.addClass(l.stateFocus);p.focus()}).bind("blur"+h,function(){if(o.options.disabled){return}n.removeClass(l.stateFocus);m.removeClass(l.stateFocus);p.trigger("blur")}).bind("keypress"+h,function(){if(o.options.disabled){return}p.trigger("keypress")}).bind("keyup"+h,function(){if(o.options.disabled){return}p.trigger("keyup")});g=/chrome/.test(navigator.userAgent.toLowerCase());if(g||d.browser.safari){j.bind("click"+h,function(){j.focus()});m.bind("mouseout"+h,function(){if(o.options.disabled){return}n.removeClass(l.stateFocus);m.removeClass(l.stateFocus)})}};e.prototype._setListContainerPosition=function(){var h=this,i=h.options,g;if(!i.ensureDropDownOnBody){return}g=h._container.offset();h._listContainer.parent().offset({left:g.left,top:g.top+h._container.outerHeight()})};e.prototype._init=function(){var g=this;g._initActiveItem();if(g._activeItem){g._label.text(g._activeItem.text())}};e.prototype._buildItem=function(h){var k=h.val(),j=h.text(),g=this,i=g.options.wijCSS,l;if(j===""){j="&nbsp;"}l=d("<li></li>").addClass(i.wijdropdownItem).addClass(i.cornerAll).append(d("<span>"+j+"</span>")).mousemove(function(m){var n=d(m.target).closest("."+i.wijdropdownItem);if(n!==this.last){g._activate(d(this))}this.last=d(m.target).closest("."+i.wijdropdownItem)}).attr("role","option");l.data("value",k);return l};e.prototype._show=function(){var g=this,i=g._listContainer,h=g.options.showingAnimation;g._setListContainerPosition();i.css("z-index","100000");if(d.browser.msie&&/^[6,7]\.[0-9]+/.test(d.browser.version)){i.parent().css("z-index","99999")}if(h){i.show(h.effect,h.options,h.speed,function(){g._initActiveItem()})}else{i.show()}};e.prototype._hide=function(){var g=this,i=g._listContainer,h=g.options.hidingAnimation;if(i.is(":hidden")){return}if(h){i.hide(h.effect,h.options,h.speed,function(){if(d.isFunction(h.callback)){h.callback.apply(g,arguments)}if(d.browser.msie&&/^[6,7]\.[0-9]+/.test(d.browser.version)){i.parent().css("z-index","")}i.css("z-index","")})}else{if(d.browser.msie&&d.browser.version==="6.0"){i.parent().css("z-index","")}i.css("z-index","");i.hide()}};e.prototype._setValue=function(){var h=this,j=h.options.wijCSS,k=h._listContainer,i,g;if(h._activeItem){h._label.text(h._activeItem.text());h._value=h._activeItem.data("value");h._selectedIndex=d("li."+j.wijdropdownItem,k).index(h._activeItem);if(h.superpanel.vNeedScrollBar){i=h._activeItem.offset().top;g=h._activeItem.outerHeight();if(k.offset().top>i){k.wijsuperpanel("scrollTo",0,i-h._list.offset().top)}else{if(k.offset().top<i+g-k.innerHeight()){k.wijsuperpanel("scrollTo",0,i+g-k.height()-h._list.offset().top)}}}}};e.prototype._setValueToEle=function(){var h=this,i=h.element,k=i.find(":selected"),j=d("option",i).index(k),g=h._selectedIndex;if(j!==g){if(d.browser.mozilla){i.val(h._value)}k.removeAttr("selected");i.find("option:eq("+g+")").attr("selected",true);i.trigger("change")}};e.prototype._initActiveItem=function(){var g=this,h=g.options.wijCSS;if(g._value!==undefined){if(g._selectedIndex===-1){g._activate(g._list.find("li."+h.wijdropdownItem).eq(0));return}g._list.find("li."+h.wijdropdownItem).each(function(i){if(i===g._selectedIndex){g._activate(d(this));return false}})}};e.prototype._activate=function(h){var g=this,i=g.options.wijCSS;g._deactivate();g._activeItem=h;g._activeItem.addClass(i.stateHover).attr("aria-selected",true)};e.prototype._deactivate=function(){var g=this,h=g.options.wijCSS;if(g._activeItem){g._activeItem.removeClass(h.stateHover).attr("aria-selected",false)}};e.prototype._next=function(){this._move("next","first")};e.prototype._previous=function(){this._move("prev","last")};e.prototype._nextPage=function(){this._movePage("first")};e.prototype._previousPage=function(){this._movePage("last")};e.prototype.refresh=function(){var g=this,j=g.options.wijCSS,i=g.element,h;if(g.needInit){if(g.element.is(":visible")){g._activeItem=null;g._createSelect();g._bindEvents();g._init();g.needInit=false}}else{if(!g._list){return}g._listContainer.show();g._selectWrap.removeClass(j.helperHidden);h=g.element.outerWidth();h+=parseInt(g._label.css("padding-left").replace(/px/,""),10);h+=parseInt(g._label.css("padding-right").replace(/px/,""),10);h-=16;g._container.width(h);g._selectWrap.addClass(j.helperHidden);g._list.empty();g._buildList(g._list,g._listContainer,h);g._value=g.element.val();g._selectedIndex=d("option",i).index(i.find("option:selected"));g._initActiveItem();if(g._activeItem){g._label.text(g._activeItem.text())}}};e.prototype._move=function(j,i){var g=this,l=g.options.wijCSS,k,h;if(!g._activeItem){g._activate(g._list.find("."+l.wijdropdownItem+":"+i));return}k=g._activeItem[j]().eq(0);if(k.length){h=g._getNextItem(k,j,i)}else{if(g._activeItem.closest("."+l.wijdropdownOptgroup).length){h=g._getNextItem(g._activeItem.closest("."+l.wijdropdownOptgroup)[j](),j,i)}}if(h&&h.length){g._activate(h)}else{g._activate(g._list.find("."+l.wijdropdownItem+":"+i))}};e.prototype._movePage=function(l){var j=this,m=j.options.wijCSS,k,h,g,i=l==="first"?"last":"first";if(j.superpanel.vNeedScrollBar){k=j._activeItem.offset().top;h=j.options.height;g=j._list.find("."+m.wijdropdownItem).filter(function(){var o=d(this).offset().top-k+(l==="first"?-h:h)+d(this).height(),n=d(this).height();return o<n&&o>-n});if(!g.length){g=j._list.find("."+m.wijdropdownItem+":"+i)}j._activate(g)}else{j._activate(j._list.find("."+m.wijdropdownItem+":"+(!j._activeItem?l:i)))}};e.prototype._getNextItem=function(g,i,h){var j=this.options.wijCSS;if(g.length){if(g.is("."+j.wijdropdownOptgroup)){if(!!g.find(">ul>li."+j.wijdropdownItem).length){return g.find(">ul>li."+j.wijdropdownItem+":"+h).eq(0)}else{this._getNextItem(g[i]().eq(0))}}else{return g}}};e.prototype.destroy=function(){var g=this,h=g.options.wijCSS;this.element.attr("title",this._container.attr("title"));this.element.closest("."+h.wijdropdown).find(">div."+h.wijdropdownTrigger+",>div."+h.wijmodropdown+",>a").remove();this._listContainer.remove();this.element.unwrap().unwrap().removeData("maxZIndex");f.prototype.destroy.call(this)};return e})(b.wijmoWidget);b.wijdropdown=a;a.prototype.options=d.extend(true,{},b.wijmoWidget.prototype.options,{initSelector:":jqmData(role='wijdropdown')",wijCSS:{wijmodropdown:"wijmo-dropdown",wijdropdown:"wijmo-wijdropdown",wijdropdownLabel:"wijmo-dropdown-label",wijdropdownTrigger:"wijmo-dropdown-trigger",wijdropdownList:"wijmo-dropdown-list",wijdropdownOptgroup:"wijmo-dropdown-optgroup",wijdropdownOptgroupHeader:"wijmo-optgroup-header",wijdropdownItems:"wijmo-dropdown-items",wijdropdownItem:"wijmo-dropdown-item"},zIndex:1000,showingAnimation:{effect:"blind"},hidingAnimation:{effect:"blind"},ensureDropDownOnBody:false});d.wijmo.registerWidget(c,a.prototype)})(wijmo||(wijmo={}));