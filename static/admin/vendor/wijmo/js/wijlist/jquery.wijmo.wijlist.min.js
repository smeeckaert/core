var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";var t=jQuery,n="wijlist",r="wijmo-wijlist-item",i=r+"-alternate",s=r+"-selected",o=r+"-first",u=r+"-last",a="wijmo-wijlistitem-active",f="item.wijlist",l=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype.removeAll=function(){var e=this;e.items=[],e._refresh()},n.prototype.addItem=function(e,t){var n=this;n._checkData(),t===null||t===undefined?n.items.push(e):n.items&&n.items.splice(t,0,e),n._refresh()},n.prototype.removeItem=function(e){var t=this,n;t._checkData(),n=t.indexOf(e),n>=0&&t.removeItemAt(n)},n.prototype.indexOf=function(e){var t=this,n=-1,r=0,i;t._checkData();for(r=0;r<t.items.length;r++){i=t.items[r];if(i.label===e.label&&i.value===e.value){n=r;break}}return n},n.prototype.findIndexByLabel=function(e){var t=this,n=-1,r=0,i;if(e===null||e===undefined)return n;t._checkData();for(r=0;r<t.items.length;r++){i=t.items[r];if(i.label===e){n=r;break}}return n},n.prototype.removeItemAt=function(e){var t=this;t._checkData(),t.items.splice(e,1),t._refresh()},n.prototype._checkData=function(){var e=this;e.items||(e.items=[])},n.prototype._refresh=function(){var e=this;e.renderList(),e.refreshSuperPanel()},n.prototype._setOption=function(n,r){var i=this,o,u=s+" "+i.options.wijCSS.stateActive,a,f,l;e.prototype._setOption.call(this,n,r);if(n==="disabled")i._handleDisabledOption(r,i.element);else if(n==="selectionMode")o=i.selectedItem,o&&(o.selected=!1,o.element&&o.element.removeClass(u),i.selectedItem=undefined),i.selectedItems&&t.each(i.selectedItems,function(e,t){t.selected=!1,t.element.removeClass(u)}),i.selectedItem=[];else if(n==="listItems")f=i._isBind(),f?(l=i._getRenderItems(),i.setItems(l)):i.setItems(r),i.renderList(),i.refreshSuperPanel();else if(n==="dataSource")f=i._isBind(),f&&(l=i._getRenderItems(),i.setItems(l),i.renderList(),i.refreshSuperPanel());else if(n==="autoSize"||n==="maxItemsCount")!i.options.autoSize&&i.element.is(":visible")&&(i._oriHeight!==0?i.element.height(i._oriHeight):(a=i.ul.outerHeight(),i.element.height(a),t(".wijmo-wijsuperpanel-statecontainer",i.element).height(a),t(".wijmo-wijsuperpanel-contentwrapper",i.element).height(a))),i.refreshSuperPanel()},n.prototype._create=function(){var e=this,n=this.element,r=this.options,i=r.wijCSS,s=i.widget+" "+i.content+" "+i.cornerAll+" wijmo-wijlist",o;window.wijmoApplyWijTouchUtilEvents&&(t=window.wijmoApplyWijTouchUtilEvents(t)),e._oriHeight=parseInt(n.css("height"),10),n.addClass(s).attr({role:"listbox","aria-activedescendant":a,"aria-multiselectable":r.selectionMode==="multiple"}).bind("click."+e.widgetName,e,e._onListClick),n.is("div")&&n.children().is("ul")&&(e._isInnerData=!0,e._templates=[],t.each(t("ul > li",n),function(t,n){e._templates.push({templateHtml:n.innerHTML})}),e._oriChildren=n.children().hide()),e.ul=t("<ul class='wijmo-wijlist-ul'></ul>").appendTo(n),r.listItems!==null&&(o=e._getRenderItems(),o&&(e.setItems(o),e.renderList(),e.refreshSuperPanel())),e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.refreshSuperPanel(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijlist"),r.disabled&&(e.disable(),e._handleDisabledOption(!0,e.element))},n.prototype._isBind=function(){var e=this.options,t=e.listItems;return t!==null&&t.label&&t.label.bind?!0:!1},n.prototype._getRenderItems=function(){var e=this.options,n=e.listItems;return n!==null?t.isArray(n)&&n.length>0&&typeof n[0].label=="string"?n:n.label&&n.label.bind?this._getMappingItems():null:null},n.prototype._getMappingItems=function(){var e=this.options,n=e.dataSource,r=e.listItems,i,s,o;return!n||!r?null:!r.label||!r.label.bind||!r.value||!r.value.bind?null:(s=r.label.bind,o=r.value.bind,n&&n.length!==0?(i=[],t.each(n,function(e,t){i.push({label:t[s],value:t[o]})}),i):null)},n.prototype._handleDisabledOption=function(e,t){var n=this;e?(n.disabledDiv||(n.disabledDiv=n._createDisabledDiv(t)),n.disabledDiv.appendTo("body")):n.disabledDiv&&(n.disabledDiv.remove(),n.disabledDiv=null)},n.prototype._createDisabledDiv=function(e){var n=this,r=e||n.element,i=r.offset(),s=r.outerWidth(),o=r.outerHeight();return t("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:s,height:o,left:i.left,top:i.top,"pointer-events":"auto"})},n.prototype.setTemplateItems=function(e){this._setItemsByExtend(e,!0)},n.prototype.setItems=function(e){this._setItemsByExtend(e,!1)},n.prototype._setItemsByExtend=function(e,n){var r=this,i;if(n){if(r._templates&&e&&e.length!==r._templates.length)return;r.items=e,r.items||(r.items=[]),t.each(r._templates,function(t){r.items[t]?r.items[t].templateHtml=r._templates[t].templateHtml:r.items.push({templateHtml:r._templates[t].templateHtml,label:e[t].label,value:e[t].value})})}else r.items=e;if(!e)return null;i=t.grep(e,function(e){return e.selected},undefined),r.options.selectionMode==="single"?(r.selectedItems=[],r.selectedItem=i.length>0?i[0]:undefined):r.selectedItems=i},n.prototype.filterItems=function(e,n,r,i){var o=this,u=o._escapeRegex(e),a,f=s+" "+o.options.wijCSS.stateActive,l=o.options.wijCSS.priorityPrimary,c,h="",p=!1,d=null;if(!this.items)return null;t("li[wijhidden].wijmo-wijlist-item",o.element)&&t("li[wijhidden].wijmo-wijlist-item",o.element).length>0&&(p=!0),t("span."+l,o.element)&&t("span."+l,o.element).length>0&&(p=!0);if(!p&&(!e||e.length===0)){t.each(this.items,function(e,t){t.selected?(o.activate(null,t,!1),t.element&&t.element.addClass(f),o.selectedItem=t):t.element&&t.element.hasClass(f)&&t.element.removeClass(f)});return}return a=new RegExp(u,"i"),t.each(this.items,function(e,i){c=i.label,i.templateHtml?c=i.templateHtml:i.text!==undefined&&(c=i.text),t("span."+l,i.element).length>0&&i.element.empty().append(c);var s=a.exec(i.label);s===null&&n?i.element&&(i.element.hide(),i.element.attr("wijhidden","wijhidden")):(i.selected?(o.activate(null,i,!1),i.element&&i.element.addClass(f),o.selectedItem=i):i.element&&i.element.hasClass(f)&&i.element.removeClass(f),r&&(h=c.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+u+")(?![^<>]*>)(?![^&;]+;)","gi"),"<span class='"+l+"'>$1</span>"),i.element&&i.element.html(h)),i.element&&!i.element.is(":visible")&&(i.element.show(),i.element.removeAttr("wijhidden")),u!==undefined&&u.length!==0&&d===null&&s&&s.index===0&&(d=i))}),d},n.prototype.popItem=function(){var e=this;e._checkData(),e.items.pop(),e._refresh()},n.prototype.getList=function(){return this.ul},n.prototype._onListClick=function(e){var n=e.data;if(n.options.disabled)return;if(!t(e.target).closest(".wijmo-wijlist-item").length)return;n.select(e)},n.prototype.destroy=function(){var t=this,n=this.element,r=this.options,i=r.wijCSS,s=i.widget+" "+i.content+" "+i.cornerAll+" wijmo-wijlist";t.superPanel!==undefined&&t.superPanel.destroy(),n.removeClass("wijmo-wijobserver-visibility").removeClass(s).removeAttr("role").removeAttr("aria-activedescendant").unbind("."+t.widgetName),t.ul.remove(),t.disabledDiv&&(t.disabledDiv.remove(),t.disabledDiv=null),t._isInnerData&&t._oriChildren.show(),e.prototype.destroy.call(this)},n.prototype.activate=function(e,t,n){var r=this,i,s;r.deactivate();if(t===null||t===undefined)return;if(r._trigger("focusing",e,t)===!1)return;i=r.active=t,s=t.element,s&&(r.options.addHoverItemClass&&s.addClass(r.options.wijCSS.stateHover),s.attr("id",a)),n&&r.superPanel!==undefined&&r.superPanel.scrollChildIntoView(s),r.element.is(":visible")&&r._trigger("focus",e,t)},n.prototype.deactivate=function(){var e=this,t=e.active,n;if(!t)return;n=t.element,e._trigger("blur",null,t),n&&n.removeClass(e.options.wijCSS.stateHover).removeAttr("id"),e.active=undefined},n.prototype.next=function(e){this.move("next","."+r+":first",e)},n.prototype.nextPage=function(){this.superPanel.doScrolling("bottom",!0)},n.prototype.previous=function(e){this.move("prev","."+r+":last",e)},n.prototype.previousPage=function(){this.superPanel.doScrolling("top",!0)},n.prototype.first=function(){return this.active&&!this.active.element.prev().length},n.prototype.last=function(){return this.active&&!this.active.element.next().length},n.prototype.move=function(e,t,n){var i=this,s,o;if(!i.active){s=i.ul.children(":visible"+t).data(f),i.activate(n,s,!0);return}o=i.active.element[e+"All"](":visible."+r).eq(0),o.length?i.activate(n,o.data(f),!0):i.activate(n,i.element.children(t).data(f),!0)},n.prototype.select=function(e,n){var r=this,i,o,u=s+" "+r.options.wijCSS.stateActive,a,l,c;if(r.active===undefined){r.active=t(t(e.target).closest(".wijmo-wijlist-item")).data(f);if(r.active===undefined)return}i=r.active.element;if(i===undefined||i.attr("wijhidden"))return;a=i.data(f);if(!a)return;l=r.options.selectionMode==="single",l?(c=r.selectedItem,i.addClass(u).attr("aria-selected","true"),a.selected=!0,c!==undefined&&a!==c&&(c.selected=!1,c.element&&c.element.removeClass(u).removeAttr("aria-selected")),r.selectedItem=a,o=t.inArray(a,r.items),r._trigger("selected",e,{item:a,previousItem:c,selectedIndex:o,data:n})):(a.selected=!a.selected,a.selected?i.addClass(u).attr("aria-selected","true"):i.removeClass(u).removeAttr("aria-selected","true"),o=[],r.selectedItems=t.grep(r.items,function(e,t){return e.selected&&o.push(t),e.selected},undefined),r._trigger("selected",e,{selectedIndex:o,item:a,selectedItems:r.selectedItems}))},n.prototype._findItemsByValues=function(e){var n,r=[];return r=t.grep(this.items,function(t,r){n=!1;for(var i=0;i<e.length;i++)t.value===e[i]&&(n=!0);return n},undefined),r},n.prototype._findItemsByIndices=function(e){var n=this,r=this.items.length,i=[];return t.each(e,function(e,t){t>=0&&t<r&&i.push(n.items[t])}),i},n.prototype.getItems=function(e,n){var r=this,i,s,o,u;s=t.isArray(e),i=!s&&typeof e=="number"||s&&typeof e[0]=="number",o=s?e:[e];if(!n)u=r._findItemsByValues(o);else{if(!i)return null;u=r._findItemsByIndices(o)}return u},n.prototype.selectItems=function(e,n,r){var i=this,o=this.options.selectionMode==="single",u=s+" "+i.options.wijCSS.stateActive,a,f,l;l=i.getItems(e,r),o?(l.length>0&&(a=l[0],a.selected=!0,a.element.addClass(u)),f=i.selectedItem,f&&(f.selected=!1,f.element.removeClass(u)),i.selectedItem=a,n&&i._trigger("selected",null,{item:a,previousItem:f})):(t.each(l,function(e,t){t.selected=!0,t.element.addClass(u)}),i.selectedItems=t.grep(i.items,function(e){return e.selected},undefined),n&&i._trigger("selected",null,{selectedItems:i.selectedItems}))},n.prototype.unselectItems=function(e){var n=this,r=this.options.selectionMode,i=s+" "+n.options.wijCSS.stateActive,o,u;if(r==="single")o=n.selectedItem,o&&(o.selected=!1,o.element.removeClass(i),n.selectedItem=undefined);else{u=n.getItems(e,!0);if(!u||u.length===0)return;t.each(u,function(e,t){t.selected=!1,t.element.removeClass(i)}),n.selectedItems=t.grep(n.items,function(e){return e.selected},undefined)}},n.prototype.renderList=function(){var e=this,t=this.ul,n=this.options,r,i,s,a,f;t.empty(),r=e.items;if(r===undefined||r===null)return;i=r.length;if(i===0)return;s=n.selectionMode==="single";for(a=0;a<i;a++)f=r[a],e._renderItem(t,f,a,s);i>0&&(r[0].element&&r[0].element.addClass(o),r[i-1].element&&r[i-1].element.addClass(u)),e._trigger("listRendered",null,e)},n.prototype._renderItem=function(e,n,r,o){var u=this,a=t("<li role='option' class='wijmo-wijlist-item "+u.options.wijCSS.cornerAll+"'></li>"),l=s+" "+u.options.wijCSS.stateActive,c,h;n.element=a,n.list=u;if(u._trigger("itemRendering",null,n)===!1)return;return c=n.label,n.title&&a.attr("title",n.title),n.templateHtml?c=n.templateHtml:n.text!==undefined&&(c=n.text),a.bind("mouseover",function(e){if(u.options.disabled)return;u.activate(e,n,!1)}).bind("mouseout",function(){if(u.options.disabled)return;u.options.keepHightlightOnMouseLeave||u.deactivate()}).data(f,n).append(c).appendTo(e),u._isInnerData||(h=n.imageUrl,h!==undefined&&h.length>0&&a.prepend("<img src='"+n.imageUrl+"'>")),n.selected&&(u.activate(null,n,!1),a.addClass(l)),r%2===1&&a.addClass(i),u._trigger("itemRendered",null,n),a},n.prototype._escapeRegex=function(e){return e===undefined?e:e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},n.prototype.adjustOptions=function(){var e=this.options,t;if(e.data!==null)for(t=0;t<e.listItems.length;t++)delete e.listItems[t].element,delete e.listItems[t].list;return e},n.prototype.refreshSuperPanel=function(){var e=this,n=this.element,r=this.options,i=this.ul,s=i.children(".wijmo-wijlist-item:first"),o,u,a,f=null,l,c,h,p,d,v,m;if(!n.is(":visible"))return!1;u=i.outerHeight(),a=n.innerWidth(),r.autoSize&&(f=s.outerHeight(!0)*r.maxItemsCount),f!==null&&n.height(Math.min(f,u)),l=n.innerHeight(),c=l/(u-l),d=101*c/(1+c),h=s.outerHeight()/(u-l)*(101-d),e.superPanel===undefined?(v={allowResize:!1,keyboardSupport:!1,bubbleScrollingEvent:!0,hScroller:{scrollBarVisibility:"hidden"},vScroller:{scrollSmallChange:h,scrollLargeChange:d}},t.extend(v,r.superPanelOptions),e.superPanel=n.wijsuperpanel(v).data("wijmoWijsuperpanel"),e.superPanel&&e.superPanel.vNeedScrollBar&&(i.setOutWidth(a-18),e.superPanel.refresh())):(p=e.superPanel.options.vScroller,p.scrollLargeChange=d,p.scrollSmallChange=h,e.superPanel.paintPanel(),e.superPanel.vNeedScrollBar?(i.setOutWidth(a-18),e.superPanel.refresh()):(i.setOutWidth(n.outerWidth()),o=n.children(".wijmo-wijsuperpanel-header").outerHeight(),o!==null&&o!==undefined&&n.height(u+o),e.superPanel.refresh())),m=i.css("padding-top"),m.length>0?(p=e.superPanel.options.vScroller,p.firstStepChangeFix=e.superPanel.scrollPxToValue(parseFloat(m),"v")):p.firstStepChangeFix=0,i.setOutWidth(i.parent().parent().innerWidth()),r.disabled&&e.disabledDiv&&e.disabledDiv.css("left",n.offset().left).css("top",n.offset().top).css("width",n.outerWidth()).css("height",n.outerHeight())},n}(e.wijmoWidget);e.wijlist=l,l.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,{wijMobileCSS:{header:"ui-header ui-bar-a",content:"ui-body-c",stateDefault:"ui-btn-up-c",stateHover:"ui-btn-up-b",stateActive:"ui-btn-down-b"},initSelector:":jqmData(role='wijlist')",dataSource:null,listItems:[],selected:null,selectionMode:"single",autoSize:!1,maxItemsCount:5,addHoverItemClass:!0,superPanelOptions:null,disabled:!1,focusing:null,focus:null,blur:null,itemRendering:null,itemRendered:null,listRendered:null,keepHightlightOnMouseLeave:!1}),t.wijmo.registerWidget("wijlist",l.prototype)})(wijmo||(wijmo={}));