var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";var t=jQuery,n="wijribbon",r="wijmo-wijribbon",i=r+"-disabled",s=r+"-bigbutton",o=r+"-panel",u=r+"-groups",a=r+"-group",f=a+"-content",l=a+"-label",c=r+"-dropdown",h=r+"-dropdowngroup",p=r+"-abbrev",d=p+"group",v=r+"-text",m=r+"-icon",g=r+"-abbrevicon",y=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype._create=function(){var e=this;window.wijmoApplyWijTouchUtilEvents&&(t=window.wijmoApplyWijTouchUtilEvents(t)),e._ribbonify(),e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.updateRibbonSize(),e.options.disabled&&e._setDisabled(!0),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijribbon"),e.options.disabled&&e._setDisabled(!0)},n.prototype._setOption=function(e,n){t.wijmo.widget.prototype._setOption.apply(this,arguments),e==="disabled"&&this._setDisabled(n)},n.prototype._setDisabled=function(e){var n=this,r=n.element,s=r.offset(),o=s.top,u=s.left,a=t("body"),f=this.options.wijCSS,l=n.disabledModal;r.data("wijmoWijtabs")&&r.wijtabs("option","disabled",e),r.closest(".wijmo-wijeditor").length!==0&&(o=0,u=0,a=r.parent()),e?(l||(l=t("<div></div>").addClass(f.stateDisabled+" "+i).css({top:o,left:u,"background-color":"lightgray",position:"absolute"}).appendTo(a).bind("click mousedown mouseup mouseover mouseout focus keydown keypress",function(e){return e.stopPropagation(),e.preventDefault(),!1}),n.disabledModal=l),n.disabledModal.width(r.width()).height(r.outerHeight()).show()):n.disabledModal&&n.disabledModal.hide()},n.prototype._ribbonify=function(){var e=this,n=this.options.wijCSS;e.buttons={},e.listUis={},e._getButtonSets(),e._createButtons(),e._createGroup(),e._createSplit(),e._createDropdwon(),e._hideShowedList(),e._createTab(),t("."+n.helperReset+":not(."+u+", ."+n.tabsNav+")",e.element).hover(function(){t(this).addClass(n.stateHover)},function(){t(this).removeClass(n.stateHover)}),t(".ui-button",e.element).bind("mouseenter",function(){t("."+n.buttonText,this).addClass(n.stateHover)}).bind("mouseleave",function(){t("."+n.buttonText,this).removeClass(n.stateHover)}),t("button.ui-button").bind("mousedown",function(){e._addActiveClassToButtonText(this)}).bind("mouseup",function(){e._addActiveClassToButtonText(this)}),t("label.ui-button").bind("click",function(){e._addActiveClassToLabelButtonText(this)})},n.prototype._addActiveClassToButtonText=function(e){var n=this.options.wijCSS;e&&(t(e).hasClass(n.stateActive)?t("."+n.buttonText,e).addClass(n.stateActive):t("."+n.buttonText,e).removeClass(n.stateActive))},n.prototype._addActiveClassToLabelButtonText=function(e){var n=this,r,i,s;e&&(i=t(e).attr("for"),r=t("#"+i,n.element),r.is(":checkbox")?n._addActiveClassToButtonText(e):r.is(":radio")&&(s=n.element.find("[name='"+r.attr("name")+"']"),t.each(s,function(){n._updateGroupElementTextState(this)})))},n.prototype._updateGroupElementTextState=function(e){var n,r=this.options.wijCSS;if(!e)return;n=t("[for='"+t(e).attr("id")+"']",t(e).parent()),n&&(n.hasClass(r.stateActive)?n.children("."+r.buttonText).addClass(r.stateActive):n.children("."+r.buttonText).removeClass(r.stateActive))},n.prototype._getButtonSets=function(){var e=this,n;e.groups=[],e.splits=[],e.dropdowns=[],t("span>button, span>:checkbox, span>:radio, div>button, div>:checkbox, div>:radio",e.element).each(function(r,i){return n=t(i).parent(),t(">ul",n).length===0?e.groups.push(n):t(">button",n).length===2?e.splits.push(n):t(">button",n).length===1&&e.dropdowns.push(n),this}),e.groups=e._unique(e.groups),e.splits=e._unique(e.splits)},n.prototype._unique=function(e){var n=t.makeArray(t.map(e,function(e){return e.get(0)}));return t.map(t.unique(n),function(e){return t(e)})},n.prototype._createButtons=function(){var e=this,n=e.element;t(":checkbox",n).each(function(){return e._createButton(t(this),"checkbox"),this}),t(":radio",n).each(function(){return e._createButton(t(this),"radio"),this}),t("button",n).each(function(){return e._createButton(t(this),"button"),this})},n.prototype._createButton=function(e,n){var r=this,i=this.options.wijCSS,s=r._buildButtonOption(e,n),o=e.data("commandName"),u;e.button(s),s.text||(n==="button"?e.children("."+i.buttonText).text(o):(u=t("[for='"+e.attr("id")+"']",e.parent()),u&&u.children("."+i.buttonText).text(o))),r._triggerEvent(e)},n.prototype._createGroup=function(){t.each(this.groups,function(e,t){t.buttonset()})},n.prototype._createSplit=function(){var e=this,n=this.options.wijCSS;t.each(e.splits,function(i,s){var o=s.children("ul"),u=s.children("button:eq(0)"),a=u.data("commandName"),f=s.children("button:eq(1)"),l;o.children("li").addClass(n.cornerAll),s.addClass(r+"-"+a),f.button({icons:{primary:n.iconArrowDown},text:!1}).data("list",o).unbind("click").bind("click",function(e){e.stopPropagation(),e.preventDefault()}).bind("mouseup",function(n){o=t(this).data("list"),o.is(":visible")?(e.showList.hide().css("z-index",""),e.showList=null):(o.show().position({my:"left top",at:"left bottom",of:s}).css("z-index",9999),e.showList=o),n.stopPropagation(),n.preventDefault()}),f.children("."+n.buttonText).text("foo"),s.after(o),o.css("position","absolute").addClass(n.helperReset+" "+n.helperClearFix+" "+n.cornerAll+" "+c).hide(),s.buttonset(),l={ui:u,defaultValue:u.button("option","label"),buttons:[],type:"split",trigger:f,list:o},t("button, :checkbox, :radio",o).bind("click",function(t){o.hide().css("z-index",""),e.showList=null,t.preventDefault()}),o.find(">li>button,>li>:radio,>li>:checkbox").each(function(n,r){var i=t(r).data("commandName");i!==""&&e.buttons[i]&&(e.buttons[i].parent=u,e.buttons[i].type="split"),l.buttons.push(t(r))}),a!==""&&(e.listUis[a]=l)})},n.prototype._createDropdwon=function(){var e=this,n=this.options.wijCSS;e.dropdownLabels={},t.each(e.dropdowns,function(i,s){var o=s.children("ul"),u=s.children("button:eq(0)"),a=u.data("commandName"),f;o.children("li").addClass(n.cornerAll),s.addClass(r+"-"+a),u.button({icons:{secondary:n.iconArrowDown}}).unbind("click").bind("click",function(e){e.stopPropagation(),e.preventDefault()}).bind("mouseup",function(t){o.is(":visible")?(e.showList.hide().css("z-index",""),e.showList=null):(e.showList&&(e.showList.hide(),e.showList=null),o.show().position({my:"left top",at:"left bottom",of:u}).css("z-index",9999),e.showList=o,e.isShow=!0),t.stopPropagation(),t.preventDefault()}),f={ui:u,defaultValue:u.button("option","label"),buttons:[],type:"dropdown",list:o},t("button, :checkbox, :radio",o).bind("click",function(r){var i=t(this).data("commandName"),s,a=u.children("."+n.buttonText).width();e.dropdownLabels[i]||(e.dropdownLabels[i]=e._getDropdownLabelSubstr(t(this).button("option","label"),u.children("."+n.buttonText),a)),s=e.dropdownLabels[i],u.button("option","label",s),u.attr("title",t(this).button("option","label")),o.hide().css("z-index",""),e.showList=null,r.preventDefault()}),o.css("position","absolute").addClass(n.helperReset+" "+n.helperClearFix+" "+n.cornerAll+" "+c).hide(),s.buttonset(),o.find(">li>button,>li>:radio,>li>:checkbox").each(function(n,r){var i=t(r).data("commandName");i!==""&&e.buttons[i]&&(e.buttons[i].parent=u,e.buttons[i].type="dropdown"),f.buttons.push(t(r))}),a!==""&&(e.listUis[a]=f)})},n.prototype._createTab=function(){var e=this,n=this.options.wijCSS,i=e.element;return i.addClass(r),e.tabEle=i,t(">ul",i).length>0?(i.wijtabs(),e._createRibbonGroups(),!0):(i.addClass(r+"-simple").addClass(n.stateDefault).addClass(n.helperClearFix),!1)},n.prototype.updateRibbonSize=function(){var e=this,n,i=this.options.wijCSS,s;e.tabEle.children("div").each(function(o,u){var a=t(u),f=a.is(":visible"),l=a.find(">ul>li"),c=[],p;return p=a.width(),f||(a.removeClass(i.wijtabsHide),p=a.width()),l.each(function(e,i){var o=t(i),u=o.find(">div:last"),a=u.attr("displayname")?u.attr("displayname"):t.trim(u.text());return n=o.children("."+h),s=o.children("."+d),n&&(o.addClass(r+"-"+a.toLowerCase()).prepend(n.children()),n.remove(),s&&s.remove()),c.push({width:o.outerWidth(!0),text:a}),this}),e._adjustRibbonGroupIfNeeded(l,c,p),f||a.addClass(i.wijtabsHide),this}),e.options.disabled&&e._setDisabled(!0)},n.prototype._createRibbonGroups=function(){var e=this,n=this.options.wijCSS;e.tabEle.children("div").each(function(i,s){var c=t(s),h=c.is(":visible"),p=c.find(">ul>li"),d=[],v;if(c.data("destroy.tabs")){c.remove();return}return h||c.removeClass(n.wijtabsHide),v=c.width(),c.addClass(o),c.find(">ul").addClass(n.helperReset+" "+n.helperClearFix+" "+n.content+" "+n.cornerAll+" "+u),p.each(function(e,i){var s=t(i),o=s.find(">div:last"),u=n.stateDefault+" "+a,c=o.attr("displayname")?o.attr("displayname"):t.trim(o.text());return o&&(u+=" "+r+"-"+c.toLowerCase()),s.addClass(u),o.addClass(l).bind("click",function(){return!1}),s.wrapInner("<div class = '"+f+"'></div>"),s.children().bind("mouseover",function(){t(this).addClass(n.stateHover)}).bind("mouseout",function(){t(this).removeClass(n.stateHover)}),o.appendTo(s),d.push({width:s.outerWidth(!0),text:c}),this}),e._originalGroupInfo=d,e._adjustRibbonGroupIfNeeded(p,d,v),h||c.addClass(n.wijtabsHide),this})},n.prototype._adjustRibbonGroupIfNeeded=function(e,n,i){var s=this,o=e.length-1,u=0,a=0,f=0,l,c,p;for(;o>=0;o--){f=0;for(u=0;u<o;u++)f+=n[u].width;f+a+n[o].width<=i?(l=t(e[o]).children("."+h),c=t(e[o]).children("."+d),l&&(t(e[o]).addClass(r+"-"+n[o].text.toLowerCase()).prepend(l.children()),l.remove(),c&&c.remove())):(p=n[o],a+=s._createDropDownRibbonGroup(p.text,e[o]))}},n.prototype._createDropDownRibbonGroup=function(e,n){var i=this,s=r+"-"+e.toLowerCase(),o=this.options.wijCSS,u=t(n).removeClass(s),f=u.find(">div:last").text()||e,l;return u.wrapInner("<div class='"+h+" "+a+"'></div>").children().hide().addClass(s).bind("mouseup."+i.widget,function(e){i.showDrpDwnGroup!==null&&(i.showDrpDwnGroup.hide().css("z-index",""),i.showDrpDwnGroup=null)}),l=t("<div class='"+d+"'>"+"<span class='"+p+e.toLowerCase()+" "+m+" "+g+"'></span>"+"<span class='"+v+"'>"+f+"</span>"+"<span class='"+o.icon+" "+o.iconArrowDown+" "+m+"'></span></div>").appendTo(u).unbind(i.widget).bind("mouseover."+i.widget,function(e){t(this).addClass(o.stateHover)}).bind("mouseout."+i.widget,function(e){t(this).removeClass(o.stateHover)}).bind("click."+i.widget,function(e){var n=t(this).siblings("."+h);n.is(":visible")?(n.hide().css("z-index",""),i.showDrpDwnGroup=null):(i.showDrpDwnGroup&&i.showDrpDwnGroup.hide().css("z-index",""),n.show().position({my:"left top",at:"left bottom",of:this}).css("z-index","10000"),i.showDrpDwnGroup=n,e.stopPropagation())}),u.outerWidth(!0)},n.prototype._hideShowedList=function(){var e=this;t(document).bind("mouseup",function(n){var r=n.target;e.showList&&(t(r).is(document)||!t.contains(e.showList.get(0),r))&&(e.showList.hide().css("z-index",""),e.showList=null),e.showDrpDwnGroup&&(t(r).is(document)||!t.contains(e.showDrpDwnGroup.get(0),r))&&(e.showDrpDwnGroup.hide().css("z-index",""),e.showDrpDwnGroup=null)})},n.prototype._buildButtonOption=function(e,n){var r=!0,i=this,o=e.attr("class"),u,a,f,l,c,h,p;if(o&&o!==""&&o!==s)a=o.split(" ")[0],e.removeClass(a),c=t.trim(e.text()),c===""&&(r=!1);else{if(n==="checkbox"||n==="radio"){if(t.trim(e.attr("id"))==="")return;h=t("[for='"+e.attr("id")+"']",e.parent());if(!h.is("label"))return;o=h.attr("class"),o&&o!==""&&o!==s?(a=o.split(" ")[0],h.removeClass(a),c=t.trim(h.text()),c===""&&(r=!1)):u=h.children("span,div")}else n==="button"&&(u=e.children("span,div"));u&&(u.length===1?u.eq(0).attr("class")!==""&&(f=u.eq(0),a=f.attr("class"),r=!1):u.length===2?u.eq(0).attr("class")&&(f=u.eq(0),a=f.attr("class"),f.is("span")?l="left":f.is("div")&&(l="top"),c=u.eq(1).text()):n==="button"&&t.trim(e.text())!==""&&(c=t.trim(e.text())))}return n==="button"?(e.empty(),p=t.trim(e.attr("name")),p!==""&&e.removeAttr("name")):(p=t.trim(h.attr("name")),p!==""&&h.removeAttr("name")),p!==""&&(e.data("commandName",p),i.buttons[p]={button:e}),{label:c,icons:{primary:a},position:l,text:r}},n.prototype._triggerEvent=function(e){var t=this;e.bind("click",function(n){if(t.options.disabled){n.preventDefault(),n.stopPropagation();return}var r=e.data("commandName"),i=t.buttons[r],s={name:undefined,commandName:undefined};i&&i.parent&&(s.name=i.parent.data("commandName")),s.commandName=r,t._trigger("click",n,s),e.is("button")&&(n.preventDefault(),n.stopPropagation())})},n.prototype._getDropdownLabelSubstr=function(e,n,r){var i=this,s=e.length,o=0,u=s,a=Math.floor((o+u)/2),f=t("<span></span>"),l=e.substr(0,a),c;f.appendTo(n.parent()),c=i._calculateWidth(l,f);while(c!==r&&u>o)l=e.substr(0,a+1),c=i._calculateWidth(l,f),c>r?u=a-1:c<r&&(o=a+1),a=Math.floor((o+u)/2);return f.remove(),l},n.prototype._calculateWidth=function(e,t){return t.text(e),t.width()},n.prototype.hideDropdown=function(e){var t=this,n=t.listUis[e];n&&n.list&&n.list.hide()},n.prototype.destroy=function(){this.disabledModal&&this.disabledModal.remove(),t.Widget.prototype.destroy.call(this)},n.prototype.getDropdownList=function(e){var n=this,r=n.listUis[e],i={};return r&&t.each(r.buttons,function(e,t){i[t.data("commandName")]=t.button("option","label")}),i},n.prototype.setButtonDisabled=function(e,n){var r=this.buttons[e],i=this.options.wijCSS,s=!1,o,u;r&&r.button&&(o=r.button,s=o.is("button"),o.button("option","disabled",n),s?e!=="save"&&o.children("."+i.buttonText).text(e):t("[for='"+o.attr("id")+"']",o.parent()).children("."+i.buttonText).text(e),u=this.listUis[e],u&&u.type==="split"&&(u.trigger.button("option","disabled",n),u.trigger.children("."+i.buttonText).text(e)))},n.prototype.setButtonsDisabled=function(e){var n=this;t.each(e,function(e,t){n.setButtonDisabled(e,t)})},n.prototype.setButtonsChecked=function(e){var n=this;t.each(e,function(e,r){t.isPlainObject(r)?n.setButtonChecked(e,r.checked,r.name):n.setButtonChecked(e,r,null)})},n.prototype.setButtonChecked=function(e,n,r){var i=this,s,o=i.buttons[e],u=this.options.wijCSS,a,f,l;o&&o.button?(a=o.button,a.is("button")?n?a.addClass(u.stateActive):a.removeClass(u.stateActive):(a.attr("checked",n),a.button("refresh")),o.parent?o.type==="dropdown"&&n&&(i.dropdownLabels[e]||(i.dropdownLabels[e]=i._getDropdownLabelSubstr(a.button("option","label"),o.parent.children("."+u.buttonText),o.parent.children("."+u.buttonText).width())),l=i.dropdownLabels[e],o.parent.button("option","label",l),o.parent.attr("title",a.button("option","label")),s=t(":radio",o.button.closest("ul")),s&&t.each(s,function(){i._updateGroupElementTextState(this)})):i._addActiveClassToButtonText(a.button("widget"))):r&&(f=i.listUis[r],f&&(f.ui.button("option","label",f.defaultValue),f.buttons&&t.each(f.buttons,function(e,t){t.attr("checked",!1),t.button("refresh"),i._addActiveClassToButtonText(t.button("widget"))})))},n}(e.wijmoWidget);e.wijribbon=y,y.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,{initSelector:":jqmData(role='wijribbon')",wijCSS:{wijtabsHide:"wijmo-wijtabs-hide"},click:null}),t.wijmo.registerWidget("wijribbon",y.prototype)})(wijmo||(wijmo={}));