var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){var t=this;"use strict";var n=jQuery,r=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._setOption=function(t,r){var i=this.options,s=n("."+i.wijCSS.wijratingResetButton,this.ratingElement[0]),o=n("."+i.wijCSS.wijratingStarContainer,this.ratingElement[0]),u=n("."+i.wijCSS.wijratingNormalStar,this.ratingElement[0]);if(n.isPlainObject(i[t])){switch(t){case"resetButton":typeof r.disabled!="undefined"&&r.disabled!==i[t].disabled&&(r.disabled?(s.hide(),s.attr("aria-hidden",!0)):i.disabled||(s.show(),s.attr("aria-hidden",!1))),typeof r.hint!="undefined"&&r.hint!==i[t].hint&&(r.hint===null?s.attr("title",""):s.attr("title",r.hint)),r.position&&r.position.length&&r.position!==i[t].position&&(r.position==="rightOrBottom"?s.parent().append(s):s.parent().prepend(s)),typeof r.customizedClass!="undefined"&&r.customizedClass!==i[t].customizedClass&&(i[t].customizedClass.length&&s.removeClass(i[t].customizedClass),r.customizedClass.length&&s.addClass(r.customizedClass));break;case"hint":typeof r.disabled!="undefined"&&r.disabled!==i[t].disabled&&(r.disabled?u.removeAttr("title"):this._resetHint(i.hint.content)),typeof r.content!="undefined"&&r.content!==i[t].content&&(i[t].disabled||this._resetHint(r.content));break;case"icons":typeof r.iconsClass!="undefined"&&(i[t].iconsClass&&i[t].iconsClass.length&&this._removeCustomizedIconsClass(i[t].iconsClass),this._addCustomizedIconsClass(r.iconsClass,i.split)),typeof r.hoverIconsClass!="undefined"&&i[t].hoverIconsClass&&i[t].hoverIconsClass.length&&this._removeCustomizedIconsClass(i[t].hoverIconsClass),typeof r.ratedIconsClass!="undefined"&&(i[t].ratedIconsClass&&i[t].ratedIconsClass.length&&this._removeCustomizedIconsClass(i[t].ratedIconsClass),this._resetValue(i.value,i.ratingMode,r.ratedIconsClass));break;default:}n.extend(!0,i[t],r)}else{if(r===i[t])return;switch(t){case"disabled":r?(this._unbindLiveEvents(),s.hide(),s.attr("aria-hidden",!0)):(this._bindLiveEvents(),i.resetButton.disabled||(s.show(),s.attr("aria-hidden",!1)));break;case"count":this._createStars(i.split,r,o);break;case"split":this._createStars(r,i.count,o);break;case"totalValue":this._resetTotalValue(r);break;case"orientation":r==="vertical"?this.ratingElement.addClass(i.wijCSS.wijvRating):this.ratingElement.removeClass(i.wijCSS.wijvRating),i.split>1&&(i[t]=r,this._createStars(i.split,i.count,o));break;case"direction":i[t]=r,this._createStars(i.split,i.count,o);break;case"ratingMode":this._resetValue(i.value,r,i.icons.ratedIconsClass);break;case"value":if(i.min&&r<i.min)return;if(i.max&&r>i.max)return;this._resetValue(r,i.ratingMode,i.icons.ratedIconsClass);break;case"iconWidth":i[t]=r,this._createStars(i.split,i.count,o);break;case"iconHeight":i[t]=r,this._createStars(i.split,i.count,o);break;default:}e.prototype._setOption.call(this,t,r)}},t.prototype._create=function(){var t=this.options,r;if(this.element.is("select"))this._parseSelect(),this.element.hide(),r=n("<div></div>"),this.element.after(r);else{if(!this.element.is("div"))return;this.element.children("input[type='radio']").length>0?(this._parseRadio(),this.element.hide(),r=n("<div></div>"),this.element.after(r)):r=this.element}this.ratingElement=r,this._createRating(),t.disabled||this._bindLiveEvents(),e.prototype._create.call(this)},t.prototype.destroy=function(){var t=this.options;this._unbindLiveEvents(),this.element!==this.ratingElement?(this.ratingElement.remove(),this.element.show()):this.element.removeClass(t.wijCSS.widget).removeClass(t.wijCSS.wijrating).removeClass(t.wijCSS.wijvRating).empty(),e.prototype.destroy.call(this)},t.prototype._unbindLiveEvents=function(){var e=this.options;this.ratingElement.off(".wijrating","."+e.wijCSS.wijratingNormalStar).off(".wijrating","."+e.wijCSS.wijratingResetButton)},t.prototype._bindLiveEvents=function(){var e=this,t=e.options,r="."+t.wijCSS.wijratingNormalStar,i="."+t.wijCSS.wijratingResetButton,s,o={element:e.ratingElement,mouseover:function(i){var o=n(i.target),u=n(r,e.ratingElement[0]);o.is(r)&&(u.removeClass(t.wijCSS.wijratingHoverStar),o.addClass(t.wijCSS.wijratingHoverStar),t.ratingMode==="continuous"&&(t.direction==="reversed"?o.parent().nextAll().children().addClass(t.wijCSS.wijratingHoverStar):o.parent().prevAll().children().addClass(t.wijCSS.wijratingHoverStar)),e._addCustomizedHoverIconsClass(t.icons.hoverIconsClass,t.split,o),s={value:parseFloat(o.html()),target:o},e._trigger("hover",i,s))},mouseout:function(i){var s=n(i.target),o=n(r,e.ratingElement[0]);s.is(r)&&(o.removeClass(t.wijCSS.wijratingHoverStar),e._removeCustomizedIconsClass(t.icons.hoverIconsClass))},click:function(i){var o=n(i.target),u=parseFloat(o.html()),a=n(r,e.ratingElement[0]),f={duration:500,easing:null,delay:250,animated:null},l=n.wijmo.wijrating.animations,c;n.extend(!0,f,t.animation),c=f.animated;if(!o.is(r))return;if(t.max&&u>t.max)return;if(t.min&&u<t.min)return;s={oldValue:t.value,newValue:u,target:o};if(e._trigger("rating",i,s)===!1)return!1;t.value=u,e._resetValue(u,t.ratingMode,t.icons.ratedIconsClass),a.removeClass(t.wijCSS.wijratingHoverStar),e._removeCustomizedIconsClass(t.icons.hoverIconsClass),s={value:u,target:o},c?l&&l[c]?l[c](t,a,function(){e._trigger("rated",i,s)}):n.effects&&(n.effects[c]||n.effects.effect&&n.effects.effect[c])?e._playJqueryAnimation(f,a,function(){n.browser.msie&&parseInt(n.browser.version)<9&&a.css("filter",""),e._trigger("rated",i,s)}):e._trigger("rated",i,s):e._trigger("rated",i,s)}},u={element:e.ratingElement,mouseover:function(e){var r=n(e.target);r=r.closest("."+t.wijCSS.wijratingResetButton),r.addClass(t.wijCSS.wijratingHoverResetButton).addClass(t.wijCSS.stateHover),t.resetButton.customizedHoverClass&&t.resetButton.customizedHoverClass.length&&r.addClass(t.resetButton.customizedHoverClass)},mouseout:function(e){var r=n(e.target);r=r.closest("."+t.wijCSS.wijratingResetButton),r.removeClass(t.wijCSS.wijratingHoverResetButton).removeClass(t.wijCSS.stateHover),t.resetButton.customizedHoverClass&&t.resetButton.customizedHoverClass.length&&r.removeClass(t.resetButton.customizedHoverClass)},click:function(t){var r=n(t.target);e._setOption("value",0),s={target:r},e._trigger("reset",t,s)}};this.ratingElement.on("mouseover.wijrating",r,n.proxy(o.mouseover,o)).on("mouseout.wijrating",r,n.proxy(o.mouseout,o)).on("click.wijrating",r,n.proxy(o.click,o)).on("mouseover.wijrating",i,n.proxy(u.mouseover,u)).on("mouseout.wijrating",i,n.proxy(u.mouseout,u)).on("click.wijrating",i,n.proxy(u.click,u))},t.prototype._createRating=function(){var e=this.ratingElement,t=this.options,r,i,s;e.addClass(t.wijCSS.wijrating).addClass(t.wijCSS.widget),t.orientation==="vertical"&&e.addClass(t.wijCSS.wijvRating),r=n("<div></div>").addClass(t.wijCSS.wijratingResetButton).addClass(t.wijCSS.cornerAll).addClass(t.wijCSS.stateDefault),t.resetButton.customizedClass&&t.resetButton.customizedClass.length&&r.addClass(t.resetButton.customizedClass),r.appendTo(e),r.attr("role","button").attr("aria-label","reset").attr("aria-hidden",!1),t.resetButton.hint&&t.resetButton.hint.length&&r.attr("title",t.resetButton.hint);if(t.resetButton.disabled||t.disabled)r.hide(),r.attr("aria-hidden",!0);i=n("<span></span>"),i.addClass(t.wijCSS.icon).addClass(t.wijCSS.iconClose),r.append(i),s=n("<div></div>"),s.attr("role","radiogroup").addClass(t.wijCSS.wijratingStarContainer),t.resetButton.position==="leftOrTop"?s.appendTo(e):s.prependTo(e),this._createStars(t.split,t.count,s)},t.prototype._createStars=function(e,t,r){var i=this.options,s=i.hint,o,u,a,f=0,l=0,c=Math.ceil(i.iconWidth/e),h=Math.ceil(i.iconHeight/e),p=i.icons.ratedIconsClass,d,v,m=p&&p.length;r.empty();for(f;f<t*e;f++,l++)a=Math.round((f+1)*i.totalValue*100/t/e)/100,l===e&&(l=0),u=n("<div></div>"),u.attr("role","radio").attr("aria-checked",!1),i.orientation==="vertical"?u.width(i.iconWidth).height(h):u.width(c).height(i.iconHeight),u.addClass(i.wijCSS.wijratingStar),o=n("<div>"+a+"</div>"),o.addClass(i.wijCSS.wijratingNormalStar).width(i.iconWidth).height(i.iconHeight),u.attr("aria-label",a),l>0&&i.direction==="normal"?i.orientation==="vertical"?o.css({"margin-top":"-"+l*h+"px"}):o.css({"margin-left":"-"+l*c+"px"}):l<e-1&&i.direction==="reversed"&&(i.orientation==="vertical"?o.css({"margin-top":"-"+(e-1-l)*h+"px"}):o.css({"margin-left":"-"+(e-1-l)*c+"px"})),s.disabled||(s.content&&s.content.length?f<=s.content.length&&(o.attr("title",s.content[f]),u.attr("aria-label",s.content[f])):o.attr("title",a)),m&&(typeof p=="string"?v=p:n.isArray(p)&&(d=Math.floor(f/e),p.length>d&&(v=p[d]))),a===i.value?(o.addClass(i.wijCSS.wijratingRatedStar),m&&o.addClass(v),u.attr("aria-checked",!0)):a<i.value&&i.ratingMode==="continuous"&&(o.addClass(i.wijCSS.wijratingRatedStar),m&&o.addClass(v)),o.appendTo(u),i.direction==="reversed"?u.prependTo(r):u.appendTo(r);this._addCustomizedIconsClass(i.icons.iconsClass,e)},t.prototype._resetValue=function(e,t,r){var i=this.options,s=n("."+i.wijCSS.wijratingNormalStar,this.ratingElement[0]),o=t||i.ratingMode,u=r&&r.length,a=0,f;n.each(s,function(t,l){var c=n(l),h=parseFloat(c.html());c.removeClass(i.wijCSS.wijratingRatedStar),c.parent().attr("aria-checked",!1),u&&(typeof r=="string"?(c.removeClass(r),f=r):n.isArray(r)&&(n.each(r,function(e,t){c.removeClass(t)}),i.direction==="reversed"?a=Math.floor((s.length-1-t)/i.split):a=Math.floor(t/i.split),r.length>a&&(f=r[a]))),h===e?(c.addClass(i.wijCSS.wijratingRatedStar),u&&c.addClass(f),c.parent().attr("aria-checked",!0)):o==="continuous"&&h<e&&(c.addClass(i.wijCSS.wijratingRatedStar),u&&c.addClass(f))})},t.prototype._resetTotalValue=function(e){var t=this.options,r=t.hint,i=n("."+t.wijCSS.wijratingNormalStar,this.ratingElement[0]),s=i.length;n.each(i,function(i,u){var a=n(u),f=Math.round((i+1)*e*100/s)/100,l=parseFloat(a.html());l===t.value&&(t.value=f),a.html(f.toString()),r&&r.length&&r.length>=i&&r[i]&&r[i].length?a.attr("title",r[i]):a.attr("title",f)})},t.prototype._resetHint=function(e){var t=this.options,r=n("."+t.wijCSS.wijratingNormalStar,this.ratingElement[0]);n.each(r,function(t,r){var i=n(r),s=parseFloat(i.html());e&&e.length&&e.length>=t&&e[t]&&e[t].length?i.attr("title",e[t]):i.attr("title",s)})},t.prototype._clearIntentTimer=function(){this.intentTimers&&this.intentTimers.length&&n.each(this.intentTimers,function(e,t){t&&(window.clearTimeout(t),t=null)}),this.intentTimers=[]},t.prototype._playJqueryAnimation=function(e,t,r){var i=this,s=this,o=s.options,u={easing:e.easing},a=e.animated;s._clearIntentTimer(),n.each(t,function(f,l){var c=Math.floor(f/o.split)*e.delay,h;h=window.setTimeout(function(){n(l).hide(a,u,e.duration,function(){if(f!==t.length-1)return;n.each(t,function(f,l){var c=Math.floor(f/o.split)*e.delay,h;h=window.setTimeout(function(){n(l).show(a,u,e.duration,function(){f===t.length-1&&r&&n.isFunction(r)&&r.call(i)})},c),s.intentTimers.push(h)})})},c),s.intentTimers.push(h)})},t.prototype._addCustomizedIconsClass=function(e,t){var r=this,i=r.options,s,o=0,u=0;e&&e.length&&(s=n("."+i.wijCSS.wijratingNormalStar,r.ratingElement[0]),n.each(s,function(i,s){o===t&&(o=0,u++);if(typeof e=="string")n(s).addClass(e);else if(n.isArray(e)){var a=e.length;u<a&&(r.options.direction==="reversed"?n(s).addClass(e[a-u-1]):n(s).addClass(e[u]))}o++}))},t.prototype._addCustomizedHoverIconsClass=function(e,t,r){var i=this.options,s=i.direction,o=i.ratingMode,u=n("."+i.wijCSS.wijratingNormalStar,this.ratingElement[0]),a=u.index(r),f=0,l;if(e&&e.length)if(typeof e=="string")r.addClass(e),o!=="single"&&(s==="reversed"?r.parent().nextAll().children().addClass(e):r.parent().prevAll().children().addClass(e));else if(n.isArray(e))if(o==="single")s==="reversed"?l=u.length-1-a:l=a,f=Math.floor(l/t),e.length>f&&r.addClass(e[f]);else if(s==="reversed")for(l=u.length-1;l>=a;l--)f=Math.floor((u.length-1-l)/t),e.length>f&&n(u[l]).addClass(e[f]);else for(l=0;l<=a;l++)f=Math.floor(l/t),e.length>f&&n(u[l]).addClass(e[f])},t.prototype._removeCustomizedIconsClass=function(e){var t=this.options,r=n("."+t.wijCSS.wijratingNormalStar,this.ratingElement[0]);e&&e.length&&(typeof e=="string"?r.removeClass(e):n.isArray(e)&&n.each(e,function(e,t){r.removeClass(t)}))},t.prototype._parseSelect=function(){var e=this.options,t=[],r=n("option",this.element);r.length&&(e.count=r.length,e.totalValue=r.length,n.each(r,function(r,i){var s=n(i);t.push(s.html()),s.is(":selected")&&(e.value=r+1)}),e.hint.content=t)},t.prototype._parseRadio=function(){var e=this,t=e.options,r=[],i=n("input[type='radio']",e.element);i.length&&(t.count=i.length,t.totalValue=i.length,n.each(i,function(i,s){var u=n(s),a=u.attr("id"),f;a&&a.length>0?(f=n("label[for='"+a+"']",e.element),f.length?r.push(f.html()):r.push("")):r.push(""),u.is(":checked")&&(t.value=i+1)}),t.hint.content=r)},t}(e.wijmoWidget);e.wijrating=r,r.prototype.options=n.extend(!0,{},e.wijmoWidget.prototype.options,{wijCSS:{wijrating:"wijmo-wijrating",wijratingStarContainer:"wijmo-wijrating-starcontainer",wijratingResetButton:"wijmo-wijrating-reset",wijratingHoverResetButton:"wijmo-wijrating-resethover",wijratingStar:"wijmo-wijrating-star",wijratingNormalStar:"wijmo-wijrating-normal",wijratingHoverStar:"wijmo-wijrating-hover",wijratingRatedStar:"wijmo-wijrating-rated",wijvRating:"wijmo-wijrating-vertical"},wijMobileCSS:{iconClose:"ui-icon-delete"},disabled:!1,count:5,split:1,totalValue:5,value:0,min:null,max:null,resetButton:{disabled:!1,hint:"cancel this rating!",position:"leftOrTop",customizedClass:"",customizedHoverClass:""},hint:{disabled:!1,content:null},orientation:"horizontal",direction:"normal",ratingMode:"continuous",icons:{iconsClass:null,hoverIconsClass:null,ratedIconsClass:null},iconWidth:16,iconHeight:16,animation:null,rating:null,rated:null,reset:null,hover:null}),n.wijmo.registerWidget("wijrating",r.prototype),n.mobile&&(n.mobile.selectmenu.prototype.options.initSelector=n.mobile.selectmenu.prototype.options.initSelector+":not( :jqmData(role='wijrating') )"),n.extend(n.wijmo.wijrating,{animations:{scroll:function(e,r,i){var s=e,o=i,u=250,a=500,f="linear",l=250,c=jQuery.makeArray(r);c.reverse(),n.each(c,function(e,t){var i=Math.floor(e/s.split)*l,c={width:0},h,p;h=window.setTimeout(function(){n(t).animate(c,u,f,function(){window.clearTimeout(h);if(e!==r.length-1)return;p=window.setTimeout(function(){n.each(r,function(e,t){var i=Math.floor(e/s.split)*l,a={width:s.iconWidth},c;c=window.setTimeout(function(){var i=this;n(t).animate(a,u,f,function(){window.clearTimeout(c),e===r.length-1&&o&&n.isFunction(o)&&o.call(i)})},i)}),window.clearTimeout(p)},a)})},i)}),i&&n.isFunction(i)&&i.call(t)}}})})(wijmo||(wijmo={}));