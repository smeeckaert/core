var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";var t=jQuery,n="wijvideo",r=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype._create=function(){var e=this,n,r,i,s=e.options.wijCSS,o=e.options,u;window.wijmoApplyWijTouchUtilEvents&&(t=window.wijmoApplyWijTouchUtilEvents(t)),t(this.element).is("video")?this.$video=t(this.element):this.$video=t(this.element).find("video");if(!this.$video||this.$video.length===0||t.browser.msie&&parseInt(t.browser.version,10)<9)return;i=this.$video[0].canPlayType;if(!i)return;this.$video.wrap('<div class="wijmo-wijvideo '+s.content+" "+s.widget+'" />').after('<div class="wijmo-wijvideo-wrapper"><ul class="wijmo-wijvideo-controls '+s.header+" "+s.helperClearFix+" "+s.helperReset+'">'+'<li class="wijmo-wijvideo-play '+s.stateDefault+" "+s.cornerAll+'">'+'<span class="'+s.icon+" "+s.iconPlay+'"></span>'+"</li>"+'<li class="wijmo-wijvideo-index"><div class="wijmo-wijvideo-index-slider"></div></li>'+'<li class="wijmo-wijvideo-timer">00:00</li>'+'<li class="wijmo-wijvideo-volume '+s.stateDefault+" "+s.cornerAll+'">'+'<div class="wijmo-wijvideo-volume-container">'+'<div class="wijmo-wijvideo-volumeslider '+s.stateDefault+" "+s.cornerTop+'"></div>'+"</div>"+'<span class="'+s.icon+" "+s.iconVolumeOn+'"></span>'+"</li>"+'<li class="wijmo-wijvideo-fullscreen '+s.stateDefault+" "+s.cornerAll+'">'+'<span class="'+s.icon+" "+s.iconArrow4Diag+'"></span>'+"</li>"+"</ul>"+"</div>"),this.$vidParent=this.$video.parent(".wijmo-wijvideo"),this.$vidParent.width(this.$video.outerWidth()).height(this.$video.outerHeight()),this.$seekSlider=this.$vidParent.find(".wijmo-wijvideo-index-slider"),e._volumnOn=!0,this.$volumeBtn=this.$vidParent.find(".wijmo-wijvideo-volume"),u=window.setInterval(function(){e._getVideoAttribute("readyState")&&(window.clearInterval(u),e.$vidParent.width(e.$video.outerWidth()).height(e.$video.outerHeight()),e.$video.parent().find(".wijmo-wijvideo-controls").show(),n=e.$vidParent.find(".wijmo-wijvideo-timer").position().left,e.$seekSlider.width(n-e.$seekSlider.position().left-15),e.$seekSlider.slider({value:0,step:.01,max:e._getVideoAttribute("duration"),range:"min",stop:function(t,n){e.seek=!1,e._setVideoAttribute("currentTime",n.value)},slide:function(){e.seek=!0}}),e._updateTime(),e.$volumeSlider=e.$vidParent.find(".wijmo-wijvideo-volumeslider"),e.$volumeSlider.slider({min:0,max:1,value:e._getVideoAttribute("volume"),step:.1,orientation:"vertical",range:"min",slide:function(t,n){e._setVideoAttribute("volume",n.value),n.value===0?(e._volumnOn=!1,e.$volumeBtn.find("span").removeClass(s.iconVolumeOn).addClass(s.iconVolumeOff)):(e._volumnOn=!0,e.$volumeBtn.find("span").removeClass(s.iconVolumeOff).addClass(s.iconVolumeOn))}}),e.$video.parent().find(".wijmo-wijvideo-controls").css("display","none"),e._initialToolTip(),o.showControlsOnHover||(t(".wijmo-wijvideo-controls").show(),e.$vidParent.height(e.$video.outerHeight()+t(".wijmo-wijvideo-controls").height())))},200),this.$video.bind("click."+e.widgetName,function(){e._togglePlay()}),o.showControlsOnHover&&t(".wijmo-wijvideo").hover(function(){t(".wijmo-wijvideo-controls").stop(!0,!0).fadeIn()},function(){t(".wijmo-wijvideo-controls").delay(300).fadeOut()}),r=this.$vidParent.find(".wijmo-wijvideo-play > span"),r.click(function(){e._togglePlay()}).parent().hover(function(){t(this).addClass(s.stateHover)},function(){t(this).removeClass(s.stateHover)}),this.$vidParent.find(".wijmo-wijvideo-volume").hover(function(){t(".wijmo-wijvideo-volume-container").stop(!0,!0).slideToggle()}),this.$fullScreenBtn=this.$vidParent.find(".wijmo-wijvideo-fullscreen > span"),this.$fullScreenBtn.click(function(){e._toggleFullScreen()}).parent().hover(function(){t(this).addClass(s.stateHover)},function(){t(this).removeClass(s.stateHover)}),e.options.fullScreenButtonVisible||this.$vidParent.find(".wijmo-wijvideo-fullscreen").hide(),this.$volumeBtn.hover(function(){t(this).addClass(s.stateHover)},function(){t(this).removeClass(s.stateHover)}).click(function(){if(e._getVideoAttribute("readyState")){e._volumnOn=!e._volumnOn;if(!e._volumnOn){var t=this.$volumeSlider.slider("value");this.$volumeSlider.slider("value",0),e._setVideoAttribute("volume",0),this.$volumeBtn.find("span").removeClass(s.iconVolumeOn).addClass(s.iconVolumeOff)}else this.$volumeSlider.slider("value",t),e._setVideoAttribute("volume",t),this.$volumeBtn.find("span").removeClass(s.iconVolumeOff).addClass(s.iconVolumeOn)}}),this.$video.bind("play."+e.widgetName,function(){r.removeClass(s.icon+" "+s.iconPlay).addClass(s.icon+" "+s.iconPause)}),this.$video.bind("pause."+e.widgetName,function(){r.removeClass(s.icon+" "+s.iconPause).addClass(s.icon+" "+s.iconPlay)}),this.$video.bind("ended."+e.widgetName,function(){e.pause()}),this.$video.bind("timeupdate."+e.widgetName,function(){e._updateTime()}),e._videoIsControls=!1,e._getVideoAttribute("controls")&&(e._videoIsControls=!0),this.$video.removeAttr("controls"),e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e._refresh(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijvideo"),e.options.disabled&&e._handleDisabledOption(!0,e.element)},n.prototype._setOption=function(n,r){var i=this,s=i.options;e.prototype._setOption.call(this,n,r),n==="fullScreenButtonVisible"?(s.fullScreenButtonVisible=r,r?this.$vidParent.find(".wijmo-wijvideo-fullscreen").show():this.$vidParent.find(".wijmo-wijvideo-fullscreen").hide()):n==="disabled"?i._handleDisabledOption(r,i.element):n==="showControlsOnHover"&&(r?(this.$vidParent.height(this.$video.outerHeight()),t(".wijmo-wijvideo-controls").hide(),t(".wijmo-wijvideo").hover(function(){t(".wijmo-wijvideo-controls").stop(!0,!0).fadeIn()},function(){t(".wijmo-wijvideo-controls").delay(300).fadeOut()})):(t(".wijmo-wijvideo").unbind("mouseenter mouseleave"),window.setTimeout(function(){t(".wijmo-wijvideo-controls").show(),i.$vidParent.height(i.$video.outerHeight()+t(".wijmo-wijvideo-controls").height())},200)))},n.prototype._handleDisabledOption=function(e,n){var r=this;e?(r.disabledDiv||(r.disabledDiv=r._createDisabledDiv(n)),r.disabledDiv.appendTo("body"),t.browser.msie&&(t(".wijmo-wijvideo").unbind("mouseenter mouseleave"),this.$video.unbind("click."+r.widgetName))):r.disabledDiv&&(r.disabledDiv.remove(),r.disabledDiv=null,t.browser.msie&&(t(".wijmo-wijvideo").hover(function(){t(".wijmo-wijvideo-controls").stop(!0,!0).fadeIn()},function(){t(".wijmo-wijvideo-controls").delay(300).fadeOut()}),this.$video.bind("click."+r.widgetName,function(){r._togglePlay()})))},n.prototype._createDisabledDiv=function(e){var n=this.$vidParent,r=n.offset(),i=n.outerWidth(),s=n.outerHeight();return t("<div></div>").addClass("ui-disabled").css({"z-index":"99999",position:"absolute",width:i,height:s,left:r.left,top:r.top})},n.prototype._getVideoAttribute=function(e){if(e==="")return;return this.$video.attr(e)!==undefined?this.$video.attr(e):this.$video.prop(e)},n.prototype._setVideoAttribute=function(e,t){if(e==="")return;return this.$video.attr(e)!==undefined?this.$video.attr(e,t):this.$video.prop(e,t)},n.prototype._initialToolTip=function(){var e=this;this.$seekSlider.wijtooltip({mouseTrailing:!0,showCallout:!1,position:{offset:"-60 -60"}}),this.$seekSlider.bind("mousemove",function(t,n){e._changeToolTipContent(t)}),this.$volumeBtn.wijtooltip({content:e._localizeString("volumeToolTip","Volume"),showCallout:!1}),this.$fullScreenBtn.wijtooltip({content:e._localizeString("fullScreenToolTip","Full Screen"),showCallout:!1}),this.$seekSlider.wijtooltip("widget").addClass("wijmo-wijvideo"),this.$volumeBtn.wijtooltip("widget").addClass("wijmo-wijvideo"),this.$volumeBtn.wijtooltip("widget").addClass("wijmo-wijvideo")},n.prototype._updateTime=function(){var e=this,t=e._getVideoAttribute("duration"),n=e._getVideoAttribute("currentTime"),r,i,s="",o="";r=this._truncate((t-n)/60),i=this._truncate(t-n-r*60),r<10&&(s="0"),i<10&&(o="0"),this.$vidParent.find(".wijmo-wijvideo-timer").html(s+r+":"+o+i),this.seek||this.$seekSlider.slider("value",n)},n.prototype._truncate=function(e){return Math[e>0?"floor":"ceil"](e)},n.prototype._togglePlay=function(){var e=this;if(!e._getVideoAttribute("readyState"))return;e._getVideoAttribute("paused")?this.play():this.pause()},n.prototype._toggleFullScreen=function(){var e=this,n=e._getVideoAttribute("paused"),r=0,i=t(window).width(),s=t(window).height();this.fullScreen=!this.fullScreen,this.fullScreen?(e._oriVidParentStyle=this.$vidParent.attr("style"),e._oriWidth=this.$video.outerWidth(),e._oriHeight=this.$video.outerHeight(),e._oriDocOverFlow=t(document.documentElement).css("overflow"),t(document.documentElement).css({overflow:"hidden"}),e._replacedDiv||(e._replacedDiv=t("<div />")),this.$vidParent.after(e._replacedDiv),this.$vidParent.addClass("wijmo-wijvideo-container-fullscreen").css({width:i,height:s}).appendTo(t("body")),this.$video.attr("width",i).attr("height",s),t(window).bind("resize.wijvideo",function(){e._fullscreenOnWindowResize()}),r=i-e._oriWidth):(t(document.documentElement).css({overflow:e._oriDocOverFlow}),r=e._oriWidth-this.$video.width(),e._replacedDiv.after(this.$vidParent).remove(),this.$vidParent.removeClass("wijmo-wijvideo-container-fullscreen").attr("style","").attr("style",e._oriVidParentStyle),this.$video.attr("width",e._oriWidth).attr("height",e._oriHeight),t(window).unbind("resize.wijvideo")),e._positionControls(r),e._hideToolTips(),n?e.pause():e.play()},n.prototype._fullscreenOnWindowResize=function(){var e=this,n=t(window).width(),r=t(window).height(),i=n-this.$vidParent.width();this.$vidParent.css({width:n,height:r}),this.$video.attr("width",n).attr("height",r),e._positionControls(i)},n.prototype._positionControls=function(e){var t=this.$vidParent.find(".wijmo-wijvideo-index-slider");t.width(t.width()+e)},n.prototype._showToolTip=function(e){var t=this,n=e.pageX,r=e.pageY,i=this.$seekSlider.offset().left,s=this.$seekSlider.width(),o=n-i,u=t._getVideoAttribute("duration"),a;a=u*(o/s),this.$seekSlider.wijtooltip("option","content",t._getToolTipContent(a)),this.$seekSlider.wijtooltip("showAt",{x:n,y:r-10})},n.prototype._changeToolTipContent=function(e){var t=this,n=e.pageX,r=this.$seekSlider.offset().left,i=this.$seekSlider.width(),s=n-r,o=t._getVideoAttribute("duration"),u;u=o*(s/i),this.$seekSlider.wijtooltip("option","content",t._getToolTipContent(u))},n.prototype._hideToolTips=function(){this.$seekSlider.data("wijmoWijtooltip")&&this.$seekSlider.wijtooltip("hide"),this.$volumeBtn.data("wijmoWijtooltip")&&this.$volumeBtn.wijtooltip("hide"),this.$fullScreenBtn.data("wijmoWijtooltip")&&this.$fullScreenBtn.wijtooltip("hide")},n.prototype._localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},n.prototype._getToolTipContent=function(e){var t,n,r="",i="";return t=parseInt((e/60).toString(),10),n=parseInt((e-t*60).toString(),10),t<10&&(r="0"),n<10&&(i="0"),r+t+":"+i+n},n.prototype._refresh=function(){var e;this.$video.parent().find(".wijmo-wijvideo-controls").show(),e=this.$vidParent.find(".wijmo-wijvideo-timer").position().left,this.$seekSlider.width(e-this.$seekSlider.position().left-15),this.$video.parent().find(".wijmo-wijvideo-controls").css("display","none"),this.options.showControlsOnHover||(t(".wijmo-wijvideo-controls",this.$vidParent).show(),this.$vidParent.height(this.$video.outerHeight()+t(".wijmo-wijvideo-controls").height()))},n.prototype.destroy=function(){var t=this;e.prototype.destroy.call(this),this.$vidParent.after(this.$video).remove(),this.$video.unbind("."+t.widgetName),t._videoIsControls&&t._setVideoAttribute("controls",!0)},n.prototype.play=function(){this.$video[0].play()},n.prototype.pause=function(){this.$video[0].pause()},n.prototype.getWidth=function(){return this.$video.outerWidth()},n.prototype.setWidth=function(e){e=e||600;var t=this.getWidth();this.$video.attr("width",e),this.$vidParent.width(this.$video.outerWidth()),this._positionControls(this.getWidth()-t)},n.prototype.getHeight=function(){return this.$video.outerHeight()},n.prototype.setHeight=function(e){e=e||400,this.$video.attr("height",e),this.options.showControlsOnHover?this.$vidParent.height(this.$video.outerHeight()):this.$vidParent.height(this.$video.outerHeight()+t(".wijmo-wijvideo-controls").height())},n}(e.wijmoWidget);e.wijvideo=r,r.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,{initSelector:":jqmData(role='wijvideo')",wijCSS:{iconVolumeOn:"ui-icon-volume-on",iconVolumeOff:"ui-icon-volume-off"},fullScreenButtonVisible:!0,showControlsOnHover:!0,localization:null}),t.wijmo.registerWidget("wijvideo",r.prototype)})(wijmo||(wijmo={}));