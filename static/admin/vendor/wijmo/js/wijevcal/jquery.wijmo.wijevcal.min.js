var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";function r(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}function i(){var e,t,n;e="";for(n=0;n<32;n+=1){if(n===8||n===12||n===16||n===20)e+="-";t=Math.floor(Math.random()*16).toString(16).toUpperCase(),e+=t}return e}function l(e,t,n){a?(f=amplify.store("wijevcal_tables1"),f||(f={}),f[e]||(f[e]={fields:t},amplify.store("wijevcal_tables1",f),amplify.store("wijevcal_tbl_"+e,{})),n&&n()):s&&s.transaction(function(r){r.executeSql("SELECT COUNT(*) FROM "+e,[],function(){n&&n()},function(r,i){r.executeSql("CREATE TABLE "+e+" "+t,[],n,n)})})}function c(e,t,n,r){var i={rowsAffected:0,rows:new Array},o,u,l,c,h,p,d,v,m,g,y,b,w,E;t||(t=[]),i.rows.item||(i.rows.item=function(e){return this[e]});if(a)try{l=new RegExp("(SELECT) *(.*) *FROM (\\w+)"),c=new RegExp("(INSERT OR REPLACE|INSERT) *(.*) *INTO *(\\w*) *\\(([\\w|,| ]*)\\)"),h=new RegExp("(DELETE) *(.*) *FROM (\\w+) *(\\w*)WHERE (\\w+)='*([^']+)");if(e.match(c)){p=c.exec(e);if(p&&p.length>1){d=p[3],v=f[d],m=amplify.store("wijevcal_tbl_"+d);if(m){y=p[4].split(","),o={};for(u=0;u<y.length;u+=1)y[u]&&(u===0&&(m[t[u]]=o),b=y[u].replace(" ",""),o[b]=t[u])}amplify.store("wijevcal_tbl_"+d,m)}}else if(e.match(l)){p=l.exec(e);if(p&&p.length>1){d=p[3],v=f[d],m=amplify.store("wijevcal_tbl_"+d);if(m){w=e.replace(l,"");if(w.toUpperCase().indexOf(" WHERE ")===0){w=w.substr(7),E=w.split(" OR ");for(u=0;u<E.length;u+=1)E[u]=E[u].split("="),w=E[u][1],w.indexOf("'")===0?(w=w.substring(1,w.length-1),E[u][1]=w):E[u][1]=parseFloat(w)}for(g in m)if(m.hasOwnProperty(g)){o=m[g];if(o)if(E)for(u=0;u<E.length;u+=1)o[E[u][0]]===E[u][1]&&i.rows.push(o);else i.rows.push(o)}}}}else e.match(h)&&(p=h.exec(e),p&&p.length>1&&(d=p[3],v=f[d],m=amplify.store("wijevcal_tbl_"+d),m&&m[p[6]]&&delete m[p[6]],amplify.store("wijevcal_tbl_"+d,m)));n&&n(i)}catch(S){r&&r(S)}else{if(!s){r("Local data storage not found.");return}s.transaction(function(i){i.executeSql(e,t,function(e,t){n&&n(t)},function(e,t){r&&r(t.message);return})})}}var t=jQuery,n="wijevcal",s,o="C1EventsCalendarDB",u="1.1",a=!1,f,h=function(e){function n(){e.apply(this,arguments),this._dynIdCounter=0}return __extends(n,e),n.prototype._setOption=function(e,n){var i=this.options;switch(e){case"dataSource":i.dataSource=n,this._bindDataView();break;case"eventsData":i.eventsData=n,i.appointments=n,this._onEventsDataChanged();break;case"appointments":i.eventsData=n,i.appointments=n,this._onEventsDataChanged();break;case"culture":i.culture=n,this.element.find(".wijmo-wijdatepager").wijdatepager("option","culture",i.culture),this._editEventDialog&&this._editEventDialog.find(".wijmo-wijinput-date").wijinputdate("option","culture",i.culture),this.element.find(".wijmo-wijcalendar").wijcalendar("option","culture",i.culture),this._redrawActiveView();break;case"disabled":i.disabled!==n&&(i.disabled=n,this._ensureDisabled());break;case"enableLogs":i.enableLogs=n,this._initLogPanel();break;case"selectedDate":n&&(n=r(n),i.selectedDates[0].getTime()!==n.getTime()&&(i.selectedDates[0]=n,this._onSelectedDatesChanged()));return;case"selectedDates":n&&(i.selectedDates=n,this._onSelectedDatesChanged());return;case"statusBarVisible":i.statusBarVisible=n,this._initStatusbar(),this.invalidate();return;case"headerBarVisible":i.headerBarVisible=n,this._initHeaderbar(),this.invalidate();return;case"navigationBarVisible":i.navigationBarVisible=n,this._initNavigationbar(),this.invalidate();return;case"rightPaneVisible":i.rightPaneVisible=n,this._initRightPane(),this.invalidate();return;case"timeInterval":i.timeInterval!==n&&(i.timeInterval=n,this._redrawActiveView());break;case"timeIntervalHeight":i.timeIntervalHeight!==n&&(i.timeIntervalHeight=n,this._redrawActiveView());break;case"timeRulerInterval":i.timeRulerInterval!==n&&(i.timeRulerInterval=n,this._redrawActiveView());break;case"viewType":i.viewType!==n&&(i.viewType=n,this._onViewTypeChanged());break;default:}t.wijmo.widget.prototype._setOption.apply(this,arguments)},n.prototype._ensureDisabled=function(){var e=this.options;if(e.disabled){this.element.addClass(e.wijCSS.stateDisabled);try{this.element.find(".wijmo-wijcalendar").wijcalendar("option","disabled",!0),this.element.find(".wijmo-wijsuperpanel").wijsuperpanel("option","disabled",!0),this.element.find(".wijmo-wijdatepager").wijdatepager("option","disabled",!0),t().buttonset&&this.element.find(".ui-buttonset").buttonset("option","disabled",!0),this.element.find(".wijmo-wijev-today.ui-button").button("option","disabled",!0)}catch(n){this.log(n,"error")}this._unbindEvents()}else{this.element.removeClass(e.wijCSS.stateDisabled);try{this.element.find(".wijmo-wijcalendar").wijcalendar("option","disabled",!1),this.element.find(".wijmo-wijsuperpanel").wijsuperpanel("option","disabled",!1),this.element.find(".wijmo-wijdatepager").wijdatepager("option","disabled",!1),t().buttonset&&this.element.find(".ui-buttonset").buttonset("option","disabled",!1),this.element.find(".wijmo-wijev-today.ui-button").button("option","disabled",!1)}catch(n){this.log(n,"error")}this._bindEvents(),this._updateTitleText()}},n.prototype._onViewTypeChanged=function(){this._renderActiveView(),this._updateTitleText(),this._trigger("viewTypeChanged",null,this.options.viewType),this.element.find(".wijmo-wijev-datepager").wijdatepager("option","viewType",this.options.viewType)},n.prototype._onSelectedDatesChanged=function(){var e=this.options;e.selectedDate=e.selectedDates[0],this.element.find(".wijmo-wijev-datepager").wijdatepager("option","selectedDate",e.selectedDate),this._trigger("selectedDatesChanged",null,{selectedDates:e.selectedDates}),this._renderActiveView(),this._updateTitleText()},n.prototype._updateHeaderTitleText=function(){var e=this.options,t=e.titleFormat,n=e.selectedDates[0],r=e.selectedDates[e.selectedDates.length-1];if(t[e.viewType])t=t[e.viewType];else{if(t[e.viewType]===!1){this.element.find(".wijmo-wijev-view .wijmo-wijev-header-title").hide();return}t=t.toString()}e.viewType==="list"&&(r=this._addDays(n,14)),this.element.find(".wijmo-wijev-view .wijmo-wijev-header-title").show().html(this._formatString(t,n,r))},n.prototype._updateTitleText=function(){var e=this.options,t=e.selectedDates[0],n=e.selectedDates[e.selectedDates.length-1],r=new Date,i=!1;i=this._compareDayDates(t,r)===0||t<r&&n>r,this.element.find(".wijmo-wijev-navigationbar .wijmo-wijev-today").button("option","disabled",i),this._updateHeaderTitleText()},n.prototype.localizeString=function(e,t){var n=this.options;return n.localization&&n.localization[e]?n.localization[e]:t},n.prototype._create=function(){window.wijmoApplyWijTouchUtilEvents&&(t=window.wijmoApplyWijTouchUtilEvents(t)),t.isFunction(window.wijmoASPNetParseOptions)&&window.wijmoASPNetParseOptions(this.options);var e,n,r=this.options;r.colors||(r.colors=["red","darkorchid","green","blue","cornflowerblue","yellow","bronze"]),this.wijevcalnamespacekey||(this.wijevcalnamespacekey="wijevcal"+(new Date).getTime()),this.element[0].id||(this.element[0].id="wijevcal_dynid_"+(new Date).getTime()),this._uidPref=this.element[0].id+"evcdynid",this.element.addClass("wijmo-wijevcal wijmo-wijev "+r.wijCSS.widget+" ui-helper-reset "+r.wijCSS.stateDefault),t('<div class="wijmo-wijev-headerbar ui-widget-header ui-corner-top"><fieldset class="wijmo-wijev-tools"><input id="'+this._uidPref+'_daybtn" name="viewselection"'+' type="radio" class="wijmo-wijev-day" />'+'<label for="'+this._uidPref+'_daybtn">'+this.localizeString("buttonDayView","Day")+"</label>"+'<input id="'+this._uidPref+'_weekbtn" name="viewselection"'+' type="radio" class="wijmo-wijev-week" />'+'<label for="'+this._uidPref+'_weekbtn">'+this.localizeString("buttonWeekView","Week")+"</label>"+'<input id="'+this._uidPref+'_monthbtn" name="viewselection"'+' type="radio" class="wijmo-wijev-month" />'+'<label for="'+this._uidPref+'_monthbtn">'+this.localizeString("buttonMonthView","Month")+"</label>"+'<input id="'+this._uidPref+'_listbtn" name="viewselection"'+' type="radio" class="wijmo-wijev-list" />'+'<label for="'+this._uidPref+'_listbtn">'+this.localizeString("buttonListView","List")+"</label>"+"</fieldset>"+"</div>").appendTo(this.element),t('<div class="wijmo-wijev-view-container"><div class="wijmo-wijev-leftpane wijmo-wijev-viewdetails '+r.wijCSS.content+' wijmo-wijev-day-details">'+'<div class="wijmo-wijev-leftpane-inner">'+'<div class="wijmo-wijev-daycalendar"></div>'+'<div class="wijmo-wijev-monthday-container">'+'<div class="wijmo-wijev-monthday-label">...</div>'+'<div class="wijmo-wijev-fulldate-label">'+this.localizeString("activityLoading","Loading...")+"</div>"+'<div class="wijmo-wijev-year-label">...</div>'+"</div>"+'<div class="wijmo-wijev-agenda-container '+r.wijCSS.content+" "+r.wijCSS.cornerAll+" ui-helper-clearfix"+'"></div>'+"</div>"+"</div>"+'<div class="wijmo-wijev-leftpane wijmo-wijev-viewdetails '+r.wijCSS.content+' wijmo-wijev-list-details">'+'<div class="wijmo-wijev-leftpane-inner">'+'<div class="wijmo-wijev-agenda-container '+r.wijCSS.content+" "+r.wijCSS.cornerAll+' ui-helper-clearfix">&nbsp;'+"</div>"+"</div>"+"</div>"+'<div class="wijmo-wijev-rightpane">'+"&nbsp;</div>"+"</div>").appendTo(this.element),t('<div class="wijmo-wijev-loading-modal-frame"></div><div class="wijmo-wijev-loading"><div class="wijmo-wijev-loading-text">'+this.localizeString("activityLoading","Loading...")+"</div></div>").appendTo(this.element),t('<div class="wijmo-wijev-navigationbar ui-widget-header ui-corner-bottom ui-helper-clearfix"><a class="wijmo-wijev-today">'+this.localizeString("buttonToday","today")+"</a>"+'<div class="wijmo-wijev-datepager">'+"</div>"+"</div>").appendTo(this.element),t('<div class="wijmo-wijev-statusbar ui-widget-header ui-corner-bottom"></div>').appendTo(this.element),e=this.element.find(".wijmo-wijev-navigationbar"),n=this.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools"),e.find(".wijmo-wijev-today").button({text:this.localizeString("buttonToday","today")}).click(t.proxy(this._onTodayClick,this)),this.element.find(".wijmo-wijev-datepager").wijdatepager({selectedDate:r.selectedDate,localization:r.datePagerLocalization,culture:r.culture,viewType:r.viewType,nextTooltip:this.localizeString("navigatorBarNextTooltip","right"),prevTooltip:this.localizeString("navigatorBarPrevTooltip","left"),firstDayOfWeek:r.firstDayOfWeek,selectedDateChanged:t.proxy(function(e,t){this.goToDate(t.selectedDate)},this)}),t.mobile==null?(n.find(".wijmo-wijev-day").button(),n.find(".wijmo-wijev-week").button(),n.find(".wijmo-wijev-month").button(),n.find(".wijmo-wijev-list").button(),n.buttonset()):(n.attr("data-role","controlgroup"),n.attr("data-type","horizontal"),n.trigger("create"),n.controlgroup("refresh")),n.find(".wijmo-wijev-day").click(t.proxy(this._onDayViewClick,this)),n.find(".wijmo-wijev-week").click(t.proxy(this._onWeekViewClick,this)),n.find(".wijmo-wijev-month").click(t.proxy(this._onMonthViewClick,this)),n.find(".wijmo-wijev-list").click(t.proxy(this._onListViewClick,this)),this.showLoadingLabel()},n.prototype.showLoadingLabel=function(e,t){e===!1?this.element.find(".wijmo-wijev-loading-text").hide():(this.element.find(".wijmo-wijev-loading-text").show(),e||(e=this.localizeString("activityLoading","Loading..."))),(t===undefined||t===!0)&&this.element.find(".wijmo-wijev-loading-modal-frame").show(),this.element.find(".wijmo-wijev-loading").show(),this.element.find(".wijmo-wijev-loading-text").html(e)},n.prototype.hideLoadingLabel=function(){this.element.find(".wijmo-wijev-loading-modal-frame").hide(),this.element.find(".wijmo-wijev-loading").hide()},n.prototype._init=function(){var e=this.options;e.selectedDates&&e.selectedDates.length>0?e.selectedDate=e.selectedDates[0]=r(e.selectedDates[0]):e.selectedDate?(e.selectedDate=r(e.selectedDate),e.selectedDates||(e.selectedDates=[]),e.selectedDates[0]=e.selectedDate):(e.selectedDate=r(new Date),e.selectedDates=[e.selectedDate]),e.disabled&&this.element.addClass(e.wijCSS.stateDisabled),this._initHeaderbar(),this._initNavigationbar(),this._initStatusbar(),this._initRightPane(),e.fullScreen&&this._onFullScreenModeChanged(e.fullScreen),this._initLogPanel(),this._initLocalDataStorage(),this.element.ajaxError(jQuery.proxy(this._onAjaxError,this)),t(window).bind("resize."+this.wijevcalnamespacekey,t.proxy(this._onWindowResize,this)),this._renderActiveView(),this._bindDataView()},n.prototype._onFullScreenModeChanged=function(e){},n.prototype._isDataViewLoaded=function(e){return e&&(e.isLoaded()||e.count()>0)},n.prototype._isDataview=function(e){if(e&&typeof e=="object"&&!t.isArray(e))return!0},n.prototype._getDataViewInst=function(){return this.element.data("wijdataview")},n.prototype._bindDataView=function(){var e=this.options,t=e.dataSource,t,n=this;!t&&this._getDataViewInst()&&(t=this._getDataViewInst(),t=e.dataSource=t),t&&this._isDataview(t)?this._isDataViewLoaded(t)?(this._dataView=t,this._setOption("eventsData",t.toArray())):t.element.bind("dataloaded",function(){n._dataView=t,n._setOption("eventsData",t.toArray())}):this._dataView=null},n.prototype._initLocalDataStorage=function(){try{if(window.amplify&&window.amplify.store)try{f=amplify.store("wijevcal_tables1"),a=!0,this.log("Using amplify.store for the local data storage")}catch(e){this.log("amplify.store exception:"+e),this._loadData();return}else{if(!window.openDatabase){this.log(this.localizeString("logCouldntOpenLocalStorage","Couldn't open built-in local data storage. Please, add amplify.store references.")),this._loadData();return}try{s=window.openDatabase(o,u,"Wijmo Events Calendar Offline DB",2e5)}catch(n){this.log("web sql database error: "+n),this._loadData();return}if(!s){this.log("Failed to open the database on disk. This is probably because the version was bad or there is not enough space left in this domain's quota"),this._loadData();return}this.log("Using Web SQL Database for the local data storage.")}l("calendars","(id TEXT PRIMARY KEY, name TEXT, location TEXT, description TEXT, color TEXT, tag TEXT)"),l("events","(id TEXT PRIMARY KEY, calendar TEXT, subject TEXT, location TEXT, start TIMESTAMP, end TIMESTAMP, description TEXT, color TEXT, allday INTEGER, properties TEXT, tag TEXT)",t.proxy(this._loadData,this))}catch(r){this.log("local datastorage initialization error:"+r)}},n.prototype._initStatusbar=function(){var e=this.element.find(".wijmo-wijev-statusbar");if(!this.options.statusBarVisible){e.hide();return}e.show();if(this.statusbarEventsAdded)return!0;this.statusbarEventsAdded=!0},n.prototype._initHeaderbar=function(){var e=this.element.find(".wijmo-wijev-headerbar");if(!this.options.headerBarVisible){e.hide();return}e.show()},n.prototype._initNavigationbar=function(){var e=this.element.find(".wijmo-wijev-navigationbar");if(!this.options.navigationBarVisible){e.hide();return}e.show()},n.prototype._initRightPane=function(){var e=this.element.find(".wijmo-wijev-rightpane");if(!this.options.rightPaneVisible){e.hide();return}e.show()},n.prototype._initLogPanel=function(){this.options.enableLogs?(this._createLogPanel(),this.log=this._log):(this.logDialog&&this.logDialog.wijdialog("close"),this.log=function(){})},n.prototype._handleServerError=function(e){return e&&e.toString().indexOf("error:")===0?(this.status(e.toString(),"error"),!0):!1},n.prototype._loadData=function(){var e=this.options,n=this,r,i,s,o,u,a,f,l,h,p;this.showLoadingLabel(),p=function(e){n.hideLoadingLabel()},e.calendars=[],u=this._calendarsById={},l=function(t){if(!t)return;if(typeof t=="string"){if(n._handleServerError(t)){p(t);return}try{t=n._jsonParse(t)}catch(i){n.status("Unable to parse received calendars data. "+i,"error");return}}t.calendars&&t.calendars.length&&(t=t.calendars);for(r=0;r<t.length;r+=1)s=n._cloneObj(t[r]),s.prevData=n._cloneObj(s),e.calendars.push(s),u[s.id]=s;n._onCalendarsChanged()},e.dataStorage.loadCalendars?e.dataStorage.loadCalendars(l,p):e.webServiceUrl?t.getJSON(e.webServiceUrl+"?clientId="+this.element[0].id+"&command=loadCalendars"+"&calendars="+e.calendars,l):c("SELECT * FROM calendars",[],function(t){for(r=0,i=t.rows.length;r<i;r+=1)s=n._cloneObj(t.rows.item(r)),s.prevData=n._cloneObj(s),e.calendars.push(s),u[s.id]=s;n._onCalendarsChanged()},p),this._dataView?e.eventsData=this._dataView.toArray():e.eventsData=[],this._eventsDataById?a=this._eventsDataById:a=this._eventsDataById={},h=function(e){if(!e)return;if(typeof e=="string"){if(n._handleServerError(e)){p(e);return}try{e=n._jsonParse(e)}catch(t){n.log("Unable to parse received calendars data. "+t);return}}e.events&&e.events.length&&(e=e.events);for(r=0;r<e.length;r+=1)o=n._readEventData(e[r]),n._storeEventWithSort(o);n._onEventsDataChanged(),n._onInitialized()};if(e.dataStorage.loadEvents)e.dataStorage.loadEvents(e.visibleCalendars,h,p);else if(e.webServiceUrl)t.ajax({url:e.webServiceUrl+"?clientId="+this.element[0].id+"&command=loadEvents&timestamp="+(new Date).getTime(),dataType:"text",cache:!1,contentType:"application/json; charset=utf-8",type:"POST",success:h,error:p});else{if(this._dataView){this._onInitialized();return}f="SELECT * FROM events where ";for(r=0;r<e.visibleCalendars.length;r+=1)r>0&&(f+=" OR "),f+="calendar='"+e.visibleCalendars[r]+"'";c(f,[],function(e){for(r=0,i=e.rows.length;r<i;r+=1)o=n._readEventData(e.rows.item(r)),n._storeEventWithSort(o);n._onEventsDataChanged(),n._onInitialized()},p)}},n.prototype._onInitialized=function(){this._ensureDisabled(),this.hideLoadingLabel(),this._trigger("initialized")},n.prototype._readEventData=function(e){var t=this._cloneObj(e);return t.start=new Date(t.start),t.end=new Date(t.end),typeof t.allday=="string"&&(t.allday==="false"&&(t.allday=!1),t.allday==="true"&&(t.allday=!0)),t.start.getTime()>=t.end.getTime()&&(t.end=this._addMinutes(t.start,this.options.timeInterval)),this._deSerializeProperties(t.properties,t),t.prevData=this._cloneObj(t),t},n.prototype._prepareEventsForView=function(){this._eventsView=this.getOccurrences()},n.prototype._cloneObj=function(e){var t={},n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t},n.prototype._onDayViewClick=function(){var e=this.options;e.viewType!=="day"&&(e.viewType="day",this._onViewTypeChanged()),e.selectedDates=[e.selectedDate],this._onSelectedDatesChanged()},n.prototype._onWeekViewClick=function(){var e=this.options,t,n,r;e.viewType!=="week"&&(e.viewType="week",this._onViewTypeChanged()),t=e.selectedDate,r=e.firstDayOfWeek-t.getDay(),Math.abs(r)>6&&(r=t.getDay()-e.firstDayOfWeek),t=this._addDays(t,r),e.selectedDates=[];for(r=0;r<7;r+=1)n=this._addDays(t,r),e.selectedDates.push(n);this._onSelectedDatesChanged()},n.prototype._onMonthViewClick=function(){var e=this.options;e.viewType!=="month"&&(e.viewType="month",this._onViewTypeChanged())},n.prototype._onListViewClick=function(){var e=this.options;e.viewType!=="list"&&(e.viewType="list",this._onViewTypeChanged()),e.selectedDates=[e.selectedDate],this._onSelectedDatesChanged()},n.prototype._ensureEditCalendarDialogCreated=function(){var e=this.options,n,r={};this._editCalendarDialog||(n=e.editCalendarTemplate,n||(n="<p><label>"+this.localizeString("labelCalendarName","Calendar name")+"</label>"+'<input type="text" class="wijmo-wijev-name" value=""> '+'<div class="wijmo-wijev-color-button">'+'<div class="wijmo-wijev-color ui-wijmo-wijev-event-color-default">&nbsp;</div>'+"</div>"+"</p>"+"<p><label>"+this.localizeString("labelLocation","Location")+"</label>"+'<input type="text" class="wijmo-wijev-location" value=""></p>'+"<p><label>"+this.localizeString("labelDescription","Description")+'</label><textarea class="wijmo-wijev-description" /></p>'),this._editCalendarDialog=t('<div class="wijmo-wijev-editcalendar-dialog">'+n+"</div>"),this.element.append(this._editCalendarDialog),r[this.localizeString("buttonSave","Save")]=t.proxy(function(){try{var e=this._validateAndReadCalendarDialogFields(this._editCalendarDialog);e.prevData?this.updateCalendar(e):this.addCalendar(e),this._editCalendarDialog.wijdialog("close")}catch(t){alert(t)}},this),this._editCalendarDialog.wijdialog({autoOpen:!0,height:340,width:440,modal:!0,title:this.localizeString("titleEditCalendar","Edit calendar"),buttons:r,captionButtons:{pin:{visible:!1},refresh:{visible:!1},toggle:{visible:!1},minimize:{visible:!1},maximize:{visible:!1}}}),this._editCalendarDialog.find(".wijmo-wijev-name, .wijmo-wijev-location, .wijmo-wijev-description").wijtextbox(),this._editCalendarDialog.find(".wijmo-wijev-color-button").button({icons:{primary:"ui-icon-triangle-1-s"}}).click(t.proxy(this._onColorButtonClick,{dlg:this._editCalendarDialog,self:this})))},n.prototype._ensureEditEventDialogCreated=function(){var e=this.options,n;this._editEventDialog||(n=this.options.editEventDialogTemplate,n||(n='<div class="wijmo-wijev-event-dialog '+this.options.wijCSS.content+" "+e.wijCSS.cornerAll+'">'+'<ul class="wijmo-wijev-brief-content">'+"<li><label>"+this.localizeString("labelName","name")+"</label>"+'<input type="text" name="subject" class="wijmo-wijev-subject" value="">'+'<div class="wijmo-wijev-color-button">'+'<div class="wijmo-wijev-color ui-wijmo-wijev-event-color-default">&nbsp;</div>'+"</div>"+"</li>"+'<li><label for="'+this._uidPref+'_alldaybtn">'+this.localizeString("labelAllDay","all-day")+"</label>"+'<input type="checkbox" class="wijmo-wijev-allday" id="'+this._uidPref+'_alldaybtn" />'+"</li>"+"<li><label>"+this.localizeString("labelStarts","Starts")+"</label>"+'<input type="text" class="wijmo-wijev-start" value="">'+'<input type="text" class="wijmo-wijev-start-time" value="">'+"</li>"+"<li><label>"+this.localizeString("labelEnds","Ends")+"</label>"+'<input type="text" class="wijmo-wijev-end" value="">'+'<input type="text" class="wijmo-wijev-end-time" value="">'+"</li>"+"</ul>"+'<ul class="wijmo-wijev-detailed-content '+e.wijCSS.cornerAll+'">'+"<li><label>"+this.localizeString("labelLocation","Location")+"</label>"+'<input type="text" class="wijmo-wijev-location" value=""></li>'+"<li><label>"+this.localizeString("labelRepeat","Repeat")+"</label>"+'<select class="wijmo-wijev-repeat">'+'<option value="none">'+this.localizeString("repeatNone","None")+"</option>"+'<option value="daily">'+this.localizeString("repeatDaily","Every Day")+"</option>"+'<option value="workdays">'+this.localizeString("repeatWorkDays","Work days")+"</option>"+'<option value="weekly">'+this.localizeString("repeatWeekly","Every Week")+"</option>"+'<option value="monthly">'+this.localizeString("repeatMonthly","Every Month")+"</option>"+'<option value="yearly">'+this.localizeString("repeatYearly","Every Year")+"</option>"+"</select></li>"+"<li><label>"+this.localizeString("labelCalendar","Calendar")+"</label>"+'<select class="wijmo-wijev-calendar"></select></li>'+'<li class="wijmo-wijev-description-item"><label>'+this.localizeString("labelDescription","Description")+"</label>"+'<textarea class="wijmo-wijev-description" /></li>'+"</ul>"+'<div class="footer">'+'<a href="#" class="wijmo-wijev-delete">'+this.localizeString("buttonDelete","Delete")+"</a>"+'<a href="#" class="wijmo-wijev-save">'+this.localizeString("buttonOK","OK")+"</a>"+'<a href="#" class="wijmo-wijev-cancel">'+this.localizeString("buttonCancel","Cancel")+"</a>"+"</div>"+'<div class="wijmo-wijev-angle"></div>'+"</div>"),this._editEventDialog=t(n),this.element.append(this._editEventDialog),this._editEventDialog.find(".wijmo-wijev-color-button").button({icons:{primary:"ui-icon-triangle-1-s"}}).click(t.proxy(this._onColorButtonClick,{dlg:this._editEventDialog,self:this})),this._editEventDialog.find(".wijmo-wijev-delete").button().click(t.proxy(function(){this.deleteEvent(this._editEventDialog.appt),this._editEventDialog.wijpopup("hide")},this)),this._editEventDialog.find(".wijmo-wijev-cancel").button().click(t.proxy(function(e){this._editEventDialog.wijpopup("hide"),e.preventDefault()},this)),this._editEventDialog.find(".wijmo-wijev-start").width(114).wijinputdate({culture:this.options.culture,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous"),showTrigger:!0,dateFormat:"d",dateChanged:t.proxy(function(e,t){var n=this._editEventDialog.find(".wijmo-wijev-end").wijinputdate("option","date");t.date>n&&this._editEventDialog.find(".wijmo-wijev-end").wijinputdate("option","date",t.date)},this)}),this._editEventDialog.find(".wijmo-wijev-start-time").width(80).wijinputdate({culture:this.options.culture,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous"),dateFormat:"t",dateChanged:t.proxy(function(e,t){var n=this._editEventDialog.find(".wijmo-wijev-end-time").wijinputdate("option","date"),r=this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option","date");t.date.getDate()!==r.getDate()&&(t.date.setDate(r.getDate()),this._editEventDialog.find(".wijmo-wijev-start-time").wijinputdate("option","date",t.date)),t.date>n&&this._editEventDialog.find(".wijmo-wijev-end-time").wijinputdate("option","date",t.date)},this)}),this._editEventDialog.find(".wijmo-wijev-end").width(114).wijinputdate({culture:this.options.culture,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous"),showTrigger:!0,dateFormat:"d",dateChanged:t.proxy(function(e,t){var n=this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option","date");t.date<n&&this._editEventDialog.find(".wijmo-wijev-start").wijinputdate("option","date",t.date)},this)}),this._editEventDialog.find(".wijmo-wijev-end-time").width(80).wijinputdate({culture:this.options.culture,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous"),dateFormat:"t"}),this._editEventDialog.find(".wijmo-wijev-allday").wijcheckbox().change(t.proxy(this._eventDialogEnsureTimePartState,this)),this._editEventDialog.find(".wijmo-wijev-subject,.wijmo-wijev-location,.wijmo-wijev-description").wijtextbox(),this._editEventDialog.find(".wijmo-wijev-save").button().click(t.proxy(function(e){try{var t=this._validateAndReadApptDialogFields(this._editEventDialog);t.prevData?this.updateEvent(t):this.addEvent(t),this._editEventDialog.wijpopup("hide")}catch(n){alert(n)}},this)),this._editEventDialog.wijpopup({autoHide:!0,hiding:t.proxy(function(e){this._colorMenu&&this._colorMenu.wijpopup("hide"),this.element.find(".wijmo-wijev-dayview .ui-selected").removeClass("ui-selected")},this),shown:t.proxy(function(e){var t=this;this._dropDownInitialized?(this._editEventDialog.find(".wijmo-wijev-calendar").wijdropdown("refresh"),this._editEventDialog.find(".wijmo-wijev-repeat").wijdropdown("refresh")):(this._editEventDialog.find(".wijmo-wijev-calendar").wijdropdown().bind("change",function(e){var n=t._calendarsById[this.value];n&&n.color?t._addColorClass(t._editEventDialog.find(".wijmo-wijev-color"),n.color):t._editEventDialog.appt&&t._editEventDialog.appt.color&&t._addColorClass(t._editEventDialog.find(".wijmo-wijev-color"),t._editEventDialog.appt.color)}),this._editEventDialog.find(".wijmo-wijev-repeat").wijdropdown().bind("change",function(e){var n=this.value,r=t._editEventDialog.appt;switch(n){case"none":r.recurrenceState=null,r.recurrencePattern=null;break;case"daily":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"daily"};break;case"workdays":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"workdays"};break;case"weekly":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"weekly"};break;case"monthly":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"monthly"};break;case"yearly":r.recurrenceState="master",r.recurrencePattern={parentRecurrenceId:r.id,recurrenceType:"yearly"};break;case"custom":alert("show custom recurrence pattern.")}}),this._dropDownInitialized=!0),this._onEditEventDialogShown(this._editEventDialog,this._editEventDialog.appt),this._editEventDialog.find(".wijmo-wijev-subject").focus(),this._updateEditEventPopupCallout()},this)}))},n.prototype._updateEditEventPopupCallout=function(){if(this._editEventDialog&&this._editEventDialog._arrowTarget){var e=this._editEventDialog,n=t(e._arrowTarget),r=n.offset(),i=e.offset(),s;r.left===i.left?e.removeClass("wijmo-wijev-rightangle").removeClass("wijmo-wijev-leftangle"):r.left<i.left?e.removeClass("wijmo-wijev-rightangle").addClass("wijmo-wijev-leftangle"):e.removeClass("wijmo-wijev-leftangle").addClass("wijmo-wijev-rightangle"),s=Math.round(r.top-i.top+n.outerHeight(!0)/2),this._editEventDialog.find(".wijmo-wijev-angle").css("top",s)}},n.prototype._onColorButtonClick=function(){var e=this.self,n=this.dlg,r,i=e.options,s=i.colors,o="";if(s&&s.length>0)for(r=0;r<s.length;r+=1)o+='<span class="wijmo-wijev-listcolor wijmo-wijev-event-color-'+s[r]+'">&nbsp;</span>';n._colorMenu||(n._colorMenu=t('<div class="wijmo-wijev-color-menu '+i.wijCSS.content+" "+i.wijCSS.cornerAll+'"></div>'),n.append(n._colorMenu),n._colorMenu.wijpopup({autoHide:!0})),n._colorMenu.html(o),n._colorMenu.find(".wijmo-wijev-listcolor").click(t.proxy(function(e){this._addColorClass(n.find(".wijmo-wijev-color"),this._readColorFromClass(t(e.target),"default")),n._colorMenu.wijpopup("hide")},e)),n._colorMenu.wijpopup("show",{of:n.find(".wijmo-wijev-color-button"),my:"left top",at:"left bottom"})},n.prototype._validateAndReadCalendarDialogFields=function(e){var t=e.cal||{};t.name=e.find(".wijmo-wijev-name").val(),t.location=e.find(".wijmo-wijev-location").val(),t.description=e.find(".wijmo-wijev-description").val(),t.color=this._readColorFromClass(e.find(".wijmo-wijev-color"),t.color||"default");if(!t.name)throw"Calendar name can not be empty";return t},n.prototype._validateAndReadApptDialogFields=function(e){var t=e.appt,n,i,s,o,u;n=r(e.find(".wijmo-wijev-start").wijinputdate("option","date")),i=r(e.find(".wijmo-wijev-end").wijinputdate("option","date")),s=e.find(".wijmo-wijev-start-time").wijinputdate("option","date"),o=e.find(".wijmo-wijev-end-time").wijinputdate("option","date");if(n.getTime()===i.getTime()&&s.getTime()>o.getTime())throw this.localizeString("messageEndOccursBeforeStart","The end date you entered occurs before the start date.");return t.subject=e.find(".wijmo-wijev-subject").val(),t.location=e.find(".wijmo-wijev-location").val(),t.start=n,t.end=i,e.find(".wijmo-wijev-allday").length>0&&(t.allday=e.find(".wijmo-wijev-allday")[0].checked),t.allday?t.start.getTime()>=t.end.getTime()&&(t.end=this._addMinutes(t.start,this.options.timeInterval)):(t.start=new Date(t.start.getFullYear(),t.start.getMonth(),t.start.getDate(),s.getHours(),s.getMinutes(),s.getSeconds()),t.end=new Date(t.end.getFullYear(),t.end.getMonth(),t.end.getDate(),o.getHours(),o.getMinutes(),o.getSeconds())),t.calendar=e.find(".wijmo-wijev-calendar").val(),t.description=e.find(".wijmo-wijev-description").val(),t.color=this._readColorFromClass(e.find(".wijmo-wijev-color"),t.color),u=t.recurrencePattern,u&&t.recurrenceState==="master"&&(u.startTime=t.start,u.endTime=t.end,u.patternStartDate=t.start),t},n.prototype._bindApptToDialog=function(e){if(!e)return;var t=this._editEventDialog,n,r;t.appt=e,t.find(".wijmo-wijev-subject").val(e.subject||""),t.find(".wijmo-wijev-location").val(e.location||"");try{t.find(".wijmo-wijev-start").wijinputdate("option","date",e.start),t.find(".wijmo-wijev-start-time").wijinputdate("option","date",e.start),t.find(".wijmo-wijev-end").wijinputdate("option","date",e.end),t.find(".wijmo-wijev-end-time").wijinputdate("option","date",e.end)}catch(i){alert("[e0001a] wijinputdate/wijtextselection firefox error\n"+i)}t.find(".wijmo-wijev-allday").length>0&&(t.find(".wijmo-wijev-allday")[0].checked=e.allday),t.find(".wijmo-wijev-allday").wijcheckbox("refresh"),this._fillCalendarsSelect(t.find(".wijmo-wijev-calendar"),e.calendar),this._loadRepeatValue(e,t.find(".wijmo-wijev-repeat")),t.find(".wijmo-wijev-description").val(e.description||""),e.prevData?t.find(".wijmo-wijev-delete").show():t.find(".wijmo-wijev-delete").hide(),t.find(".wijmo-wijev-calendar").length>0&&(n=this._calendarsById[t.find(".wijmo-wijev-calendar")[0].value]),r=e.color,!r&&n&&n.color&&(r=n.color),this._addColorClass(t.find(".wijmo-wijev-color"),r),this._eventDialogEnsureTimePartState()},n.prototype._onEditEventDialogShown=function(e,t){t.recurrenceState==="exception"?e.find(".wijmo-wijev-repeat").wijdropdown("option","disabled",!0):e.find(".wijmo-wijev-repeat").wijdropdown("option","disabled",!1)},n.prototype._eventDialogEnsureTimePartState=function(){var e=this._editEventDialog;e.find(".wijmo-wijev-allday").length>0&&(e.find(".wijmo-wijev-allday")[0].checked?(e.find(".wijmo-wijev-start-time").wijinputdate("option","disabled",!0),e.find(".wijmo-wijev-end-time").wijinputdate("option","disabled",!0)):(e.find(".wijmo-wijev-start-time").wijinputdate("option","disabled",!1),e.find(".wijmo-wijev-end-time").wijinputdate("option","disabled",!1)))},n.prototype._loadRepeatValue=function(e,t){var n="none";if(e.recurrencePattern)switch(e.recurrencePattern.recurrenceType){case"daily":n="daily";break;case"workdays":n="workdays";break;case"weekly":n="weekly";break;case"monthly":n="monthly";break;case"yearly":n="yearly";break;default:n="custom"}t.val(n)},n.prototype._addColorClass=function(e,t){var n,r=new RegExp("wijmo-wijev-event-color-(\\w+)\\s*");e.length>0&&(n=e[0].className,e[0].className=n.replace(r,""),e.addClass("wijmo-wijev-event-color-"+(t||"default")))},n.prototype._readColorFromClass=function(e,t){var n=new RegExp("wijmo-wijev-event-color-(\\w+)\\s*"),r;if(e.length>0){r=n.exec(e[0].className);if(r&&r.length>1)return r[1]}return t},n.prototype._fillCalendarsSelect=function(e,t){var n="",r=this.options,i,s,o,u=r.calendars.slice(0),a=r.visibleCalendars;if(a&&a.length>0)for(i=0;i<a.length;i+=1){o=!1;for(s=0;s<u.length;s+=1)u[s].name===a[i]&&(o=!0);o||u.push({id:a[i],name:a[i]})}if(u.length===0){e.html("");return}for(i=0;i<u.length;i+=1)n+='<option value="'+u[i].id+'">'+u[i].name+"</option>";e.html(n).val(t)},n.prototype._bindCalendarToDialog=function(e){if(!e)return;var t=this._editCalendarDialog;t.cal=e,t.find(".wijmo-wijev-name").val(e.name||""),t.find(".wijmo-wijev-location").val(e.location||""),t.find(".wijmo-wijev-description").val(e.description||""),this._addColorClass(t.find(".wijmo-wijev-color"),e.color)},n.prototype._onTodayClick=function(){return this.goToday(),!1},n.prototype._bindEvents=function(){this._eventsAttached||(t(this.element).on("click."+this.wijevcalnamespacekey,".wijmo-wijev-appointment",t.proxy(this._onAppointmentClick,this)),t(this.element).on("mousedown."+this.wijevcalnamespacekey,".wijmo-wijev-dayview .wijmo-wijev-appointment",t.proxy(this._onDayViewAppointmentMouseDown,this)),t(this.element).on("mousedown."+this.wijevcalnamespacekey,".wijmo-wijev-monthview .wijmo-wijev-appointment",t.proxy(this._onMonthViewAppointmentMouseDown,this)),t(this.element).on("click."+this.wijevcalnamespacekey,".wijmo-wijev-dayview .wijmo-wijev-timeinterval",t.proxy(this._onDayViewTimeIntervalClick,this)),t(this.element).on("click."+this.wijevcalnamespacekey,".wijmo-wijev-dayview .wijmo-wijev-allday-cell",t.proxy(this._onDayViewAllDayCellClick,this)),t(this.element).on("click."+this.wijevcalnamespacekey,".wijmo-wijev-monthview .wijmo-wijev-monthcellheader",t.proxy(this._onMonthViewDayLabelClick,this)),t(this.element).on("click."+this.wijevcalnamespacekey,".wijmo-wijev-monthview .wijmo-wijev-monthcell-showmore",t.proxy(this._onMonthViewDayLabelClick,this)),t(this.element).on("click."+this.wijevcalnamespacekey,".wijmo-wijev-weekview .wijmo-wijev-daylabel",t.proxy(this._onMonthViewDayLabelClick,this)),t(this.element).on("click."+this.wijevcalnamespacekey,".wijmo-wijev-monthview .wijmo-wijev-monthcell",t.proxy(this._onMonthViewCellClick,this)),this._eventsAttached=!0)},n.prototype._unbindEvents=function(){this._eventsAttached&&(t(this.element).off("mousedown."+this.wijevcalnamespacekey),t(this.element).off("click."+this.wijevcalnamespacekey),this._eventsAttached=!1)},n.prototype.destroy=function(){var e=this.options;this.element.removeClass("wijmo-wijev wijmo-wijevcal "+e.wijCSS.widget+" ui-helper-reset"),t(window).unbind("resize."+this.wijevcalnamespacekey),this._unbindEvents(),t.wijmo.widget.prototype.destroy.apply(this,arguments)},n.prototype.deleteCalendar=function(e,n,r){var i,s=this.options.calendars,o=e.id||e,u=!1,a,f,l,h=this;for(i=0;i<s.length;i+=1)if(s[i].id===o){u=!0,e=s[i];if(!this._trigger("beforeDeleteCalendar",null,{data:e}))return!1;delete this._calendarsById[e.id],s.splice(i,1);break}if(!u)for(i=0;i<s.length;i+=1)if(s[i].name===o){u=!0,e=s[i];if(!this._trigger("beforeDeleteCalendar",null,{data:e}))return!1;delete this._calendarsById[e.id],s.splice(i,1);break}if(!u)return this.status("Calendar with id/name '"+o+"' not found."),!1;this.showLoadingLabel(this.localizeString("activityDeletingCalendar","Deleting calendar...")),a=function(t){h.status("Calendar '"+e.name+"' deleted."),h._onCalendarsChanged(),h.hideLoadingLabel(),n&&n(t)},f=function(t){h.status("Unable to delete calendar '"+e.name+"': "+t),h.hideLoadingLabel(),r&&r(t)};if(this.options.dataStorage.deleteCalendar)this.options.dataStorage.deleteCalendar(e,a,f);else if(this.options.webServiceUrl){try{l=this._jsonStringify(e)}catch(p){this.status("Unable to prepare calendar data for server. "+p,"error"),f("Unable to prepare calendar data for server. "+p);return}t.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=deleteCalendar&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+l,success:a,error:f})}else c("DELETE FROM calendars WHERE id='"+e.id+"'",[],a,f)},n.prototype.addCalendar=function(e,n,r){var i,s,o,u=this;if(!this._trigger("beforeAddCalendar",null,{data:e,prevData:e.prevData||{}})){if(e.prevData)for(s in e.prevData)e.prevData.hasOwnProperty(s)&&(e[s]=e.prevData[s]);return!1}e.id||(this._dynIdCounter||(this._dynIdCounter=0),this._dynIdCounter+=1,e.id="dynid"+this._dynIdCounter+"ts"+(new Date).getTime()),this.showLoadingLabel(this.localizeString("activityCreatingCalendar","Creating calendar...")),i=function(t){if(u._handleServerError(t)){o(t);return}u._readUpdatedServerDataIfAny(t,e),u._calendarsById[e.id]?u.status("Calendar '"+e.name+"' added."):(u.options.calendars.push(e),u._calendarsById[e.id]=e,u.status("Calendar '"+e.name+"' added.")),e.prevData=u._cloneObj(e),u._onCalendarsChanged(),u.hideLoadingLabel(),n&&n(t)},o=function(t){u.status("Unable to add calendar '"+e.name+"': "+t),u.hideLoadingLabel(),r&&r(t)};if(this.options.dataStorage.addCalendar)this.options.dataStorage.addCalendar(e,i,o);else if(this.options.webServiceUrl){try{s=this._jsonStringify(e)}catch(a){this.status("Unable prepare calendar data for server."+a,"error"),o("Unable to prepare calendar data for server."+a);return}t.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=addCalendar&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+s,success:i,error:o})}else c("INSERT OR REPLACE INTO calendars (id, name, location, description, color, tag) VALUES(?,?,?,?,?,?);",[e.id,e.name,e.location,e.description,e.color,e.tag],i,o)},n.prototype.updateCalendar=function(e,n,r){var i,s,o,u=this;if(!this._trigger("beforeUpdateCalendar",null,{data:e,prevData:e.prevData||{}})){if(e.prevData)for(s in e.prevData)e.prevData.hasOwnProperty(s)&&(e[s]=e.prevData[s]);return!1}e.id||(this._dynIdCounter||(this._dynIdCounter=0),this._dynIdCounter+=1,e.id="dynid"+this._dynIdCounter+"ts"+(new Date).getTime()),this.showLoadingLabel(this.localizeString("activityUpdatingCalendar","Updating calendar...")),i=function(t){if(u._handleServerError(t)){o(t);return}u._readUpdatedServerDataIfAny(t,e),u._calendarsById[e.id]?u.status("Calendar '"+e.name+"' updated."):(u.options.calendars.push(e),u._calendarsById[e.id]=e,u.status("Calendar '"+e.name+"' added.")),e.prevData=u._cloneObj(e),u._onCalendarsChanged(),u.hideLoadingLabel(),n&&n(t)},o=function(t){u.status("Unable to update calendar '"+e.name+"': "+t),u.hideLoadingLabel(),r&&r(t)};if(this.options.dataStorage.updateCalendar)this.options.dataStorage.updateCalendar(e,i,o);else if(this.options.webServiceUrl){try{s=this._jsonStringify(e)}catch(a){this.status("Unable prepare calendar data for server. "+a,"error"),o("Unable to prepare calendar data for server. "+a);return}t.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=updateCalendar&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+s,success:i,error:o})}else c("INSERT OR REPLACE INTO calendars (id, name, location, description, color, tag) VALUES(?,?,?,?,?,?);",[e.id,e.name,e.location,e.description,e.color,e.tag],i,o)},n.prototype.addEvent=function(e,n,r){var s,o,u,a=this;if(!this._trigger("beforeAddEvent",null,{data:e,prevData:e.prevData||{}})){if(e.prevData)for(u in e.prevData)e.prevData.hasOwnProperty(u)&&(e[u]=e.prevData[u]);return!1}e.id||(this._dynIdCounter||(this._dynIdCounter=0),this._dynIdCounter+=1,e.id=i()),e.calendar||(e.calendar="Default"),this.showLoadingLabel(this.localizeString("activityCreatingEvent","Creating event...")),o=function(t){a.hideLoadingLabel(),a.status("Unable to add event '"+e.subject+"': "+t,"error");if(e.prevData)for(u in e.prevData)e.prevData.hasOwnProperty(u)&&(e[u]=e.prevData[u]);r&&r(t)},s=function(t){if(a._handleServerError(t)){o(t);return}a._readUpdatedServerDataIfAny(t,e),!a._eventsDataById[e.id]||e.recurrenceState==="exception"?(a._storeEventWithSort(e),a.status("Event '"+e.subject+"' added.")):a.status("Event '"+e.subject+"' added."),e.prevData=a._cloneObj(e),a._onEventsDataChanged(),a.hideLoadingLabel(),n&&n(t)};if(this.options.dataStorage.addEvent)this.options.dataStorage.addEvent(e,s,o);else if(this.options.webServiceUrl){try{u=this._jsonStringify(e)}catch(f){this.status("Unable prepare event data for server. "+f,"error"),o("Unable to prepare event data for server. "+f);return}t.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=addEvent&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+u,success:s,error:o})}else c("INSERT OR REPLACE INTO events (id, calendar, subject, location, start, end, description, color, allday, properties, tag) VALUES(?,?,?,?,?,?,?,?,?,?,?);",[e.id,e.calendar,e.subject,e.location,e.start.getTime(),e.end.getTime(),e.description,e.color,e.allday,this._serializeProperties(e),e.tag],s,o)},n.prototype._storeEventWithSort=function(e){var t=this.options.eventsData,n,r;this._eventsDataById[e.id]=e;for(n=0,r=t.length;n<r;n+=1){if(t[n].start>e.start){t.splice(n,0,e);return}if(t[n].start.getTime()===e.start.getTime()&&t[n].subject>e.subject){t.splice(n,0,e);return}}t.push(e)},n.prototype._readUpdatedServerDataIfAny=function(e,t){var n=null,r;if(typeof e=="string"&&e.indexOf("update:")===0){e=e.toString().substr("update:".length);try{n=this._jsonParse(e)}catch(i){this.status("Unable to read updated server data. "+i,"warning")}if(n)for(r in n)n[r]&&(t[r]=n[r])}},n.prototype.updateEvent=function(e,n,r){var i,s,o,u=this;if(!this._trigger("beforeUpdateEvent",null,{data:e,prevData:e.prevData||{}})){if(e.prevData)for(o in e.prevData)e.prevData.hasOwnProperty(o)&&(e[o]=e.prevData[o]);return this._updateAppointmentVisual(e),!1}e.calendar||(e.calendar="Default"),this.showLoadingLabel(this.localizeString("activityUpdatingEvent","Updating event...")),s=function(t){u.hideLoadingLabel(),u.status("Unable to update event '"+e.subject+"': "+t,"error");if(e.prevData)for(o in e.prevData)e.prevData.hasOwnProperty(o)&&(e[o]=e.prevData[o]);u._updateAppointmentVisual(e),r&&r(t)};if(!e.id){s("id is empty");return}if(e.recurrenceState==="exception"||e.recurrenceState==="occurrence"){if(!this._eventsDataById[e.parentRecurrenceId]){s("Unable to find master event for event with id:"+e.id);return}if(e.recurrenceState==="occurrence")return this.log(this._formatString("[updateEvent->addEvent] recurrenceState for event {0} changed to 'exception'.",e.id)),e.recurrenceState="exception",this.addEvent(e,n,r)}i=function(t){if(u._handleServerError(t)){s(t);return}u._readUpdatedServerDataIfAny(t,e),u._eventsDataById[e.id]?u.status("Event '"+e.subject+"' updated."):(u._storeEventWithSort(e),u.status("Event '"+e.subject+"' added.")),e.prevData=u._cloneObj(e),u._onEventsDataChanged(),u.hideLoadingLabel(),n&&n(t)};if(this.options.dataStorage.updateEvent)this.options.dataStorage.updateEvent(e,i,s);else if(this.options.webServiceUrl){try{o=this._jsonStringify(e)}catch(a){this.status("Unable prepare event data for server. "+a,"error"),s("Unable to prepare event data for server. "+a);return}t.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=updateEvent&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+o,success:i,error:s})}else c("INSERT OR REPLACE INTO events (id, calendar, subject, location, start, end, description, color, allday, properties, tag) VALUES(?,?,?,?,?,?,?,?,?,?,?);",[e.id,e.calendar,e.subject,e.location,e.start.getTime(),e.end.getTime(),e.description,e.color,e.allday,this._serializeProperties(e),e.tag],i,s)},n.prototype._serializeProperties=function(e){var t="",n={};n.parentRecurrenceId=e.parentRecurrenceId,n.recurrenceState=e.recurrenceState,n.recurrencePattern=e.recurrencePattern,n.color=e.color,n.allday=e.allday;try{t=this._jsonStringify(n)}catch(r){this.status("Unable save additional event properties. "+r,"error")}return t},n.prototype._deSerializeProperties=function(e,t){var n={},r;if(e){if(typeof e=="string")try{n=this._jsonParse(e)}catch(i){this.status("Unable to load additional event properties. "+i,"error");return}else n=e;n.parentRecurrenceId&&(t.parentRecurrenceId=n.parentRecurrenceId),n.recurrenceState&&(t.recurrenceState=n.recurrenceState),n.recurrencePattern&&(t.recurrencePattern=n.recurrencePattern),n.color&&(t.color=n.color),n.allday&&(t.allday=n.allday)}t&&t.recurrencePattern&&(r=t.recurrencePattern,r.patternStartDate=r.patternStartDate?new Date(r.patternStartDate):r.patternStartDate,r.startTime=r.startTime?new Date(r.startTime):r.startTime,r.endTime=r.endTime?new Date(r.endTime):r.endTime,r.startTime.getTime()>=r.endTime.getTime()&&(r.endTime=this._addMinutes(r.startTime,this.options.timeInterval)))},n.prototype._jsonStringify=function(e){var t;if(window.__JSONC1)t=window.__JSONC1.stringify(e);else{if(!window.JSON)throw"JSON not found.";t=JSON.stringify(e)}return t},n.prototype._jsonParse=function(e){var t,n,r;if(window.__JSONC1)t=window.__JSONC1.parse(e);else{if(!window.JSON)throw"JSON variable not found.";n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/,r=/^\/Date\((d|-|.*)\)\/$/,t=window.JSON.parse(e,function(e,t){if(typeof t=="string"){var i=n.exec(t),s;if(i)return new Date(Date.UTC(+i[1],+i[2]-1,+i[3],+i[4],+i[5],+i[6]));i=r.exec(t);if(i)return s=i[1].split(/[-,.]/),new Date(+s[0])}return t})}return t},n.prototype.getOccurrences=function(e,t){var n=this.options,r=n.eventsData,i,s,o,u,a,f,l,c,h=100,p,d,v,m=[],g=[],y=[],b={};this._eventsDataById||(this._eventsDataById={});for(a=0,l=r.length;a<l;a+=1){i=r[a],this._eventsDataById[i.id]=i;if(i.recurrenceState==="master"){u=i.recurrencePattern,u.removedOccurrences&&(y=y.concat(u.removedOccurrences)),c=u.occurrences||h,p=u.patternStartDate||i.start,d=u.startTime||i.start,v=u.endTime||i.end;switch(u.recurrenceType){case"daily":for(f=0;f<c;f+=1)s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(this._addDays(p,f),d),s.end=this._setTime(s.start,v,d),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),b[s.id]=s);break;case"workdays":for(f=0;f<c;f+=1){s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(this._addDays(p,f),d);if(s.start.getDay()===0||s.start.getDay()===6)continue;s.end=this._setTime(s.start,v,d),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),b[s.id]=s)}break;case"weekly":for(f=0;f<c;f+=1)s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(this._addDays(p,f*7),d),s.end=this._setTime(s.start,v,d),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),b[s.id]=s);break;case"monthly":for(f=0;f<c;f+=1)s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(new Date(p),d),s.start.setMonth(s.start.getMonth()+f),s.end=this._setTime(s.start,v,d),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),b[s.id]=s);break;case"yearly":for(f=0;f<c;f+=1)s=this._cloneObj(i),s.parentRecurrenceId=i.id,s.recurrenceState="occurrence",s.start=this._setTime(new Date(p),d),s.start.setYear(s.start.getFullYear()+f),s.end=this._setTime(s.start,v,d),s.recurrencePattern=null,this._testIsEventInTimeInterval(s,e,t)&&(s.id=this._formatString("{0}_OCCR_{1:yyyy_MM_dd}",i.id,s.start),b[s.id]=s);break;case"monthlyNth":break;case"yearlyNth":}}else this._testIsEventInTimeInterval(i,e,t)&&(i.recurrenceState==="exception"?g.push(i):i.recurrenceState==="removed"?(y.push(i.id),this.log("[warning] Seems we found removed event inside events storage, id:"+i.id)):m.push(i))}for(a=0,l=g.length;a<l;a+=1)o=g[a],b[o.id]&&delete b[o.id],m.push(o),this._eventsDataById[o.id]=o;for(a=0,l=y.length;a<l;a+=1)b[y[a]]&&delete b[y[a]];for(a in b)s=b[a],m.push(s),this._eventsDataById[s.id]=s;return m},n.prototype._testIsEventInTimeInterval=function(e,t,n){return!t||!n?!0:e.start<n&&e.end>t?!0:!1},n.prototype.deleteEvent=function(e,n,r){e.id&&(e=e.id);var i=this._eventsDataById[e],s,o,u,a,f=this,l,h;if(!this._trigger("beforeDeleteEvent",null,{data:i}))return!1;this.showLoadingLabel(this.localizeString("activityDeletingEvent","Deleting event...")),a=function(e){f.status("Unable to delete event '"+(i?i.subject:"undefined")+"': "+e),f.hideLoadingLabel(),r&&r(e)};if(i.recurrenceState==="exception"||i.recurrenceState==="occurrence"){h=this._eventsDataById[i.parentRecurrenceId];if(h){this.log(this._formatString("[deleteEvent] removing {0} with id {1}. Updating master event with id {2}",i.recurrenceState,i.id,h.id)),h.recurrencePattern.removedOccurrences||(h.recurrencePattern.removedOccurrences=[]),h.recurrencePattern.removedOccurrences.push(i.id),this.updateEvent(h,n,r);if(i.recurrenceState==="occurrence"){this.log("No need to delete occurrence from store. Master event should be updated.");return}}else if(i.recurrenceState!=="exception")return a("Unable to find master event with id "+i.parentRecurrenceId),!1}i.recurrenceState==="master",u=function(t){if(f._handleServerError(t)){a(t);return}if(f._eventsDataById[i.id]){o=f.options.eventsData;for(s=0;s<o.length;s+=1)o[s].id===e&&o.splice(s,1);delete f._eventsDataById[i.id],f.status("Event '"+i.subject+"' deleted.")}else f.status("Event '"+i.subject+"' deleted.");i.prevData=f._cloneObj(i),f._onEventsDataChanged(),f.hideLoadingLabel(),n&&n(t)};if(this.options.dataStorage.deleteEvent)this.options.dataStorage.deleteEvent(i,u,a);else if(this.options.webServiceUrl){try{l=this._jsonStringify(i)}catch(p){this.status("Unable prepare event data for server. "+p,"error"),a("Unable prepare event data for server. "+p);return}t.ajax({url:this.options.webServiceUrl+"?clientId="+this.element[0].id+"&command=deleteEvent&timestamp="+(new Date).getTime(),dataType:"text",contentType:"application/json; charset=utf-8",type:"POST",data:"jsonData="+l,success:u,error:a})}else c("DELETE FROM events WHERE id='"+e+"'",[],u,a)},n.prototype.beginUpdate=function(){this._isUpdating=!0,this.showLoadingLabel("Updating...")},n.prototype.endUpdate=function(){this._isUpdating=!1,this._pendingRedrawActiveView&&this._redrawActiveView(),this.hideLoadingLabel()},n.prototype.goToEvent=function(e){e.id&&(e=e.id);var t=this.options,n,r=this.findEventById(e);switch(t.viewType){case"day":case"week":case"list":n=this.element.find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn ."+this._eventIdToCssClass(e)),n.length>0?this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("scrollChildIntoView",n):(this._dayViewScrollToEvent=r,this.goToDate(r.start));break;case"month":this.goToDate(r.start)}},n.prototype.isAllDayEvent=function(e){var t=e;return e.id||(t=this.findEventById(e)),t.allday?(t.end.getTime()-t.start.getTime())/864e5>=1?!0:!0:!1},n.prototype.goToDate=function(e){e=r(e);var t=this.options,n=e.getDay(),i,s,o,u,a,f=t.selectedDates;if(f&&f.length>0){if(this._isContainsDayDate(f,e))return;a=f[0],o=Date.UTC(e.getFullYear(),e.getMonth(),e.getDate()),u=Date.UTC(a.getFullYear(),a.getMonth(),a.getDate()),s=(o-u)/864e5;if(t.viewType==="week")for(i=0;i<f.length;i+=1)if(f[i].getDay()===n){s-=i;break}for(i=0;i<f.length;i+=1)f[i]=this._addDays(f[i],s);this._onSelectedDatesChanged()}else t.selectedDates=[e],this._onSelectedDatesChanged()},n.prototype.goToTime=function(e){var t=this.element.find(".wijmo-wijev-daycolumn .wijmo-wijev-timeinterval:first-child"),n=this.element.find(".wijmo-wijev-daycolumn .wijmo-wijev-timeinterval:last-child"),r=t.position().top,i=n.position().top+n.height(),s,o,u;u=86400,o=e.getHours()*60*60+e.getMinutes()*60,s=(i-r)*o/u+r,this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("vScrollTo",s)},n.prototype.goToday=function(){this.goToDate(new Date)},n.prototype.goLeft=function(){var e,t=this.options,n=t.viewType,r=t.selectedDates;n==="month"?this.goToDate(this._addMonths(r[0],-1)):(e=-7,r.length===1&&(e=-1),this.goToDate(this._addDays(r[0],e)))},n.prototype.goRight=function(){var e,t=this.options,n=t.viewType,r=t.selectedDates;n==="month"?this.goToDate(this._addMonths(r[0],1)):(e=7,r.length===1&&(e=1),this.goToDate(this._addDays(r[0],e)))},n.prototype.refresh=function(){this.invalidate()},n.prototype.invalidate=function(){var e=this.options;switch(e.viewType.toLowerCase()){case"list":case"day":case"week":this._invalidateDayView();break;case"month":this._invalidateMonthView();break;default:}},n.prototype.showEditCalendarDialog=function(e){var t=this.options,n=t.calendars,r;if(!e)e={name:"",description:"",location:"",color:""};else if(!e.name)for(r=0;r<n.length;r+=1)if(n[r].name===e){e=n[r];break}this._ensureEditCalendarDialogCreated(),this._bindCalendarToDialog(e),this._editCalendarDialog.wijdialog("open")},n.prototype.showEditEventDialog=function(e,n,r){var i=this.options,s,o,u,a=n?t(n):r?t(r.target):null;this._ensureEditEventDialogCreated(),this.element.find(".wijmo-wijev-dayview .ui-selected").removeClass("ui-selected"),a&&a.hasClass("wijmo-wijev-daylabel")&&(a=a.parent(".wijmo-wijev-allday-cell")),e?(this._editEventDialog._arrowTarget=a,e.recurrenceState==="occurrence"&&(s=this._eventsDataById[e.parentRecurrenceId],window.confirm(this._formatString(this.localizeString("promptOpenOccurrenceFormat","{2}  is recurring event. Do you want to open only this occurrence?"),e.start,e.end,e.subject,e.location))||(e=s))):(e={subject:this.localizeString("textNewEvent","New event")},e.isNewEvent=!0,a&&a.length>0?(this._editEventDialog._arrowTarget=a,a.addClass("ui-selected"),o=a.parent(".wijmo-wijev-daycolumn"),o.length<1&&(o=a.parent(".wijmo-wijev-dayheadercolumn")),o=o[0],a.hasClass("wijmo-wijev-allday-cell")?e.allday=!0:a.hasClass("wijmo-wijev-monthcellcontainer")?(o=a[0],e.allday=!0):e.allday=!1,o&&(u=this._parseDateFromClass(o.className,e.allday?null:a[0].className),e.start=u,e.allday?e.end=this._addMinutes(e.start,1440):e.end=this._addMinutes(e.start,i.timeInterval))):(e.start=new Date(i.selectedDates[0]),e.end=this._addMinutes(e.start,i.timeInterval))),this._trigger("beforeEditEventDialogShow",null,{data:e,targetCell:a})&&(this._bindApptToDialog(e),this._editEventDialog.wijpopup("show",{of:a,my:"left center",at:"right center",offset:(a&&r?Math.round(r.offsetX-a.width()):10)+" 0",collision:"fit"}))},n.prototype._renderActiveView=function(){var e=this.options,n=this.element.find(".wijmo-wijev-headerbar .wijmo-wijev-tools");this.element.find(".wijmo-wijev-view").hide(),this.element.find(".wijmo-wijev-viewdetails").hide(),this.element.find(".wijmo-wijev-"+e.viewType.toLowerCase()+"-details").show();switch(e.viewType.toLowerCase()){case"day":case"week":case"list":this.element.find(".wijmo-wijev-view.wijmo-wijev-dayview").show(),this._renderDayView();break;case"month":this.element.find(".wijmo-wijev-view.wijmo-wijev-monthview").show(),this._renderMonthView();break;default:}n.find(".wijmo-wijev-"+e.viewType.toLowerCase())[0].checked=!0,t().buttonset&&n.buttonset("refresh")},n.prototype._redrawActiveView=function(){if(this._isUpdating){this._pendingRedrawActiveView=!0;return}switch(this.options.viewType.toLowerCase()){case"day":case"week":this._clearDayViewCache(),this._templateDayColumn=null}this._renderActiveView()},n.prototype._getDayColumnDates=function(e){var t=this.options,n=t.selectedDates,r,i,s;n||(n=[new Date]);if(t.viewType==="week"){r=t.selectedDate||n[0],s=t.firstDayOfWeek-r.getDay(),Math.abs(s)>6&&(s=r.getDay()-t.firstDayOfWeek),r=this._addDays(r,s),n=[];for(s=0;s<7;s+=1)i=this._addDays(r,s),n.push(i)}return e&&(t.selectedDates=n),n},n.prototype._renderDayView=function(){var e=this.options,n=0,r=1440,i,s,o,u=this._getDayColumnDates(!0),a,f,l,c,h=new Date,p,d=!1,v=this.element.find(".wijmo-wijev-dayview"),m,g,y,b=0,w;v.length===0&&(v=t('<div class="wijmo-wijev-view wijmo-wijev-dayview '+e.wijCSS.content+'">'+'<h3 class="wijmo-wijev-header-title">title'+"</h3>"+'<div class="wijmo-wijev-dayview-inner">'+'<div class="wijmo-wijev-headercontainer">'+'<div class="wijmo-wijev-sizer">'+'<div class="wijmo-wijev-gmtlabel">'+this.localizeString("labelAllDay","all-day")+"</div>"+"</div>"+"</div>"+'<div class="wijmo-wijev-scrollpanel">'+'<div class="wijmo-wijev-scrollcontent">'+'<div class="wijmo-wijev-timeruler">'+'<div class="wijmo-wijev-currenttime-indicator">'+'<div class="wijmo-wijev-currenttime-indicator-arrow ui-state-error"></div>'+'<div class="wijmo-wijev-currenttime-indicator-line ui-state-error"></div>'+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"+"</div>"),v.appendTo(this.element.find(".wijmo-wijev-view-container")),this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel({hScroller:{scrollBarVisibility:"hidden"},animationOptions:{disabled:!0}})),v.removeClass("wijmo-wijev-weekview wijmo-wijev-listview"),v.addClass("wijmo-wijev-"+e.viewType.toLowerCase()+"view"),m=this.element.find(".wijmo-wijev-headercontainer"),g=this.element.find(".wijmo-wijev-scrollcontent"),y=g.find(".wijmo-wijev-timeruler");if(!this._templateDayColumn){y.find(".wijmo-wijev-timerulerinterval").remove(),i='<div class="wijmo-wijev-daycolumn">',w=!0;while(n<r)s="wijmo-wijev-timeinterval "+e.wijCSS.content+" wijmo-wijev-minute-"+n,w&&(s+=" wijmo-wijev-oddrow"),w=!w,o="wijmo-wijev-timerulerinterval "+e.wijCSS.content+" wijmo-wijev-minute-"+n,i+='<div class="'+s+'" style="height: '+e.timeIntervalHeight+'px"></div>',n+=e.timeInterval,b+=e.timeInterval,b>=e.timeRulerInterval&&(s+=" wijmo-wijev-timeinterval-hourstart",o+=" wijmo-wijev-timerulerinterval-hourstart",y.append(t('<div class="'+o+'" style="height:'+b/e.timeInterval*e.timeIntervalHeight+'px">'+this._formatString(e.timeRulerFormat,new Date(h.getFullYear(),h.getMonth(),h.getDate(),0,n-b))+"</div>")),b=0);i+="</div>",this._templateDayColumn=t(i),this._templateDayHeader=t('<div class="wijmo-wijev-dayheadercolumn '+e.wijCSS.content+'">'+'<div class="wijmo-wijev-allday-cell '+e.wijCSS.content+'">'+'<div class="wijmo-wijev-daylabel">3 Monday</div>'+"</div>"+"</div>")}m.find(".wijmo-wijev-dayheadercolumn").remove(),g.find(".wijmo-wijev-daycolumn").remove();for(a=0,p=u.length;a<p;a+=1)c=u[a],f=this._getCachedDayHeader(c),l=this._getCachedDayColumn(c),f?(f=t(f),f.find(".wijmo-wijev-daylabel").html(this._formatDayHeaderDate(c))):(f=this._templateDayHeader.clone(!0),l=this._templateDayColumn.clone(!0),f.addClass(this._dayDateToCssClass(c)),f.find(".wijmo-wijev-daylabel").html(this._formatDayHeaderDate(c)),l.addClass(this._dayDateToCssClass(c)),d?d=!1:(l.addClass("wijmo-wijev-leftborder"),f.addClass("wijmo-wijev-leftborder")),this._compareDayDates(c,h)===0&&(l.addClass("wijmo-wijev-today ui-state-highlight"),l.addClass("wijmo-wijev-leftborder"),l.addClass("wijmo-wijev-rightborder"),f.addClass("wijmo-wijev-today").find(".wijmo-wijev-allday-cell").addClass("ui-state-highlight"),f.addClass("wijmo-wijev-leftborder"),f.addClass("wijmo-wijev-rightborder"),d=!0),a===p-1&&(l.addClass("wijmo-wijev-rightborder"),f.addClass("wijmo-wijev-rightborder"))),m.append(f),g.append(l);this._invalidateDayView(),this._renderDayViewAppointments()},n.prototype._getCachedDayHeader=function(e){var t=null;return this._dayViewCache&&this._dayViewCache[e]&&(t=this._dayViewCache[e].h),t},n.prototype._getCachedDayColumn=function(e){var t=null;return this._dayViewCache&&this._dayViewCache[e]&&(t=this._dayViewCache[e].c),t},n.prototype._storeDayCache=function(e,t,n){this._dayViewCache||(this._dayViewCache={}),this._dayViewCache[e]={h:t,c:n}},n.prototype._clearViewsCache=function(){this._clearDayViewCache(),this._clearListViewCache()},n.prototype._clearDayViewCache=function(){this._dayViewCache={}},n.prototype._clearListViewCache=function(){var e=this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container .wijmo-wijsuperpanel-templateouterwrapper");e.data("wijevcal_agenda_initialized",!1),e.data("wijevcal_agenda_loadedeventscount",0)},n.prototype._invalidateDayView=function(e){var n=this.element.find(".wijmo-wijev-headercontainer"),r=this.element.find(".wijmo-wijev-scrollcontent"),i=r.find(".wijmo-wijev-timeruler"),s=n.find(".wijmo-wijev-dayheadercolumn"),o=r.find(".wijmo-wijev-daycolumn"),u=this.element.find(".wijmo-wijev-view .wijmo-wijev-header-title"),a,f,l,c,h,p,d,v=i.outerWidth(),m,g,y,b,w;this._updateHeaderTitleText(),a=u.is(":visible")?u.outerHeight(!0):0,this._invalidateView(),this._maxAllDayEventCount||(this._maxAllDayEventCount=0),c=n.find(".wijmo-wijev-dayheadercolumn .wijmo-wijev-appointment").outerHeight(!0),c||(c=17),h=n.find(".wijmo-wijev-daylabel").outerHeight(!0),p=0;for(m=0;m<s.length;m+=1)d=t(s[m]).find(".wijmo-wijev-allday-cell .wijmo-wijev-appointment").length,d>p&&(p=d);l=c*p+h+c,n.outerHeight(l+Math.round(c/2)),n.find(".wijmo-wijev-allday-cell").outerHeight(l),f=this.element.find(".wijmo-wijev-view").innerWidth(),g=f-v,g-=18,y=this.element.find(".wijmo-wijev-view").innerHeight()-n.outerHeight(!0)-a,b=Math.floor(g/o.length),n.outerWidth(f),r.outerWidth(f),s.outerWidth(b),o.outerWidth(b),this._invalidateCurrentTimeIndicator(),w=this.element.find(".wijmo-wijev-scrollpanel"),w.outerWidth(f),w.outerHeight(y),w.wijsuperpanel("refresh");switch(this.options.viewType.toLowerCase()){case"day":this._updateDayViewDetails();break;case"list":this._updateListViewDetails()}},n.prototype._updateDayViewDetails=function(){var e=this.options,n=e.selectedDate,r=this.element.find(".wijmo-wijev-leftpane"),i=r.find(".wijmo-wijev-agenda-container");this._dayViewDetailsInit||(this._dayViewDetailsInit=!0,this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar({culture:e.culture,titleFormat:this.localizeString("calendarTitleFormat","MMMM yyyy"),toolTipFormat:this.localizeString("calendarToolTipFormat","dddd, MMMM dd, yyyy"),showTitle:!1,showOtherMonthDays:!1,showWeekNumbers:!1,selectionMode:{day:!0,days:!1},selectedDatesChanged:t.proxy(function(t,n){n.dates&&!e.disabled&&this.goToDate(n.dates[0])},this),nextTooltip:this.localizeString("calendarNextTooltip","Next"),prevTooltip:this.localizeString("calendarPrevTooltip","Previous")}),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-agenda-container").wijsuperpanel()),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar("option","displayDate",n).wijcalendar("unSelectAll").wijcalendar("selectDate",n),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-daycalendar").wijcalendar("refresh"),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-monthday-label").html(n.getDate()),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-fulldate-label").html(this._formatString(this.localizeString("dayDetailsLabelFulldateFormat","{0:dddd, MMMM d}"),n)),this.element.find(".wijmo-wijev-day-details .wijmo-wijev-year-label").html(this._formatString(this.localizeString("dayDetailsLabelYearFormat","{0:yyyy}"),n)),this._updateAgendaList(this.element.find(".wijmo-wijev-day-details  .wijmo-wijev-agenda-container"),n,n,!1)},n.prototype._listViewAgendaScrolled=function(){var e=this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container"),n=e.wijsuperpanel("option","vScroller"),r,i=n.scrollValue,s=n.scrollMax-n.scrollLargeChange*2;i>=s&&(r=e.find(".wijmo-wijsuperpanel-templateouterwrapper"),r.data("wijevcal_agenda_loadnextpage")&&(r.data("wijevcal_agenda_loadnextpage",!1),r.find(".wijmo-wijev-agenda-more-events").show().html(this.localizeString("agendaLoadingMoreEvents","Loading more events...")),this._renderAgendaEventsTimeoutId&&(clearTimeout(this._renderAgendaEventsTimeoutId),this._renderAgendaEventsTimeoutId=null),this._renderAgendaEventsTimeoutId=setTimeout(t.proxy(function(){this._renderAgendaEventsTimeoutId=null,this._renderAgendaEvents(r,null,null,!0),r.find(".wijmo-wijev-agenda-more-events").remove()},this),100)))},n.prototype._updateListViewDetails=function(){this._listViewDetailsInit||(this._listViewDetailsInit=!0,this.element.find(".wijmo-wijev-list-details .wijmo-wijev-agenda-container").wijsuperpanel({scrolled:t.proxy(this._listViewAgendaScrolled,this)})),this._updateAgendaList(this.element.find(".wijmo-wijev-list-details  .wijmo-wijev-agenda-container"),null,null,!0)},n.prototype._updateAgendaList=function(e,t,n,r){var i=this.element.find(".wijmo-wijev-leftpane"),s=e;e.outerHeight(i.innerHeight()-e[0].offsetTop),s.find(".wijmo-wijsuperpanel-templateouterwrapper").length>0&&(s=s.find(".wijmo-wijsuperpanel-templateouterwrapper"));if(r&&s.data("wijevcal_agenda_initialized")){s.parents(".wijmo-wijsuperpanel").wijsuperpanel("refresh");return}s.data("wijevcal_agenda_initialized",!0),s.data("wijevcal_agenda_loadedeventscount",0),s.html(""),this._renderAgendaEvents(s,t,n,r)},n.prototype._renderAgendaEvents=function(e,n,i,s){var o=this._eventsView,u,a,f,l,c=0,h,p="",d="",v=null,m=null,g=this.options,y,b,w=100,E=e.data("wijevcal_agenda_loadedeventscount");n&&(v=r(n),m=this._addDays(r(i),1),l=(m.getTime()-v.getTime())/864e5);if(o){f=o.length<w+E||!s?o.length:w+E,e.data("wijevcal_agenda_loadedeventscount",f);if(!v){d="";for(a=E;a<f;a+=1){u=o[a];if(a===E||y.getDate()!==u.start.getDate())y=u.start,a!==0&&(p+='<ul class="wijmo-wijev-agenda-list">'+d+"</ul>",p+="</div>"),p+='<div class="wijmo-wijev-agenda-day-container '+this._dayDateToCssClass(y)+'">',s&&(p+=this._renderAgendaDayHeader(y)),d="";d+=this._renderAgendaAppointmentVisual(u),h+=1,a===f-1&&(p+='<ul class="wijmo-wijev-agenda-list">'+d+"</ul>",p+="</div>",f<o.length?(p+='<div class="wijmo-wijev-agenda-more-events">',p+=this._formatString(this.localizeString("agendaMoreEventsFormat","More events ({0})..."),o.length-f),p+="<div>",e.data("wijevcal_agenda_loadnextpage",!0)):e.data("wijevcal_agenda_loadnextpage",!1))}}else while(c<l){y=this._addDays(v,c),y=new Date(y.getFullYear(),y.getMonth(),y.getDate()),b=new Date(y.getFullYear(),y.getMonth(),y.getDate(),23,59,59),h=0,d="";for(a=E;a<f;a+=1)u=o[a],u.start<m&&u.end>v&&u.start<b&&u.start>=y&&(d+=this._renderAgendaAppointmentVisual(u),h+=1);d!==""&&(p+='<div class="wijmo-wijev-agenda-day-container '+this._dayDateToCssClass(y)+'">',s&&(p+=this._renderAgendaDayHeader(y)),p+='<ul class="wijmo-wijev-agenda-list">'+d+"</ul>",p+="</div>"),c+=1}t(p).appendTo(e)}e.on("click",".wijmo-wijev-agenda-event",t.proxy(this._onAgendaEventClick,this)).hover(function(){t(this).addClass(g.wijCSS.stateHover)},function(){t(this).removeClass(g.wijCSS.stateHover).removeClass(g.wijCSS.stateActive)}).mousedown(function(){t(this).addClass(g.wijCSS.stateActive)}).mouseup(function(){t(this).removeClass(g.wijCSS.stateActive)}),e.parents(".wijmo-wijsuperpanel").wijsuperpanel("refresh")},n.prototype._renderAgendaDayHeader=function(e){var t='<div class="wijmo-wijev-agenda-header ui-widget-header"><div class="wijmo-wijev-weekday">'+this._formatString("{0:dddd}",e)+"</div>"+'<div class="wijmo-wijev-date">'+this._formatString(this.localizeString("agendaHeaderFullDateFormat","{0:MMMM d, yyyy}"),e)+"</div>"+"</div>";return t},n.prototype._onAgendaEventClick=function(e){var n=t(e.target);n.hasClass("wijmo-wijev-agenda-event")||(n=n.parent(".wijmo-wijev-agenda-event")),n.length>0&&this.goToEvent(this._parseEventIdFromClass(n[0].className))},n.prototype._renderAgendaAppointmentVisual=function(e){var t='<li class="wijmo-wijev-agenda-event '+this._dayDateToCssClass(e.start)+" "+this._eventIdToCssClass(e.id)+" "+this.options.wijCSS.stateDefault+' ui-helper-clearfix">'+'<div class="wijmo-wijev-agenda-event-color '+"wijmo-wijev-event-color-"+(e.color||"default")+'">'+"<div></div>"+"</div>"+'<div class="wijmo-wijev-agenda-event-title">'+e.subject+"</div>"+'<div class="wijmo-wijev-agenda-event-time">'+(this.isAllDayEvent(e)?this.localizeString("labelAllDay","all-day"):this._formatString(this.localizeString("agendaTimeFormat","{0:hh:mm tt} to {1:hh:mm tt}"),e.start,e.end))+"</div>"+"</li>";return t},n.prototype._invalidateCurrentTimeIndicator=function(){var e=this.element.find(".wijmo-wijev-timeruler .wijmo-wijev-currenttime-indicator"),t=new Date,n=this.options;t=t.getMinutes()+t.getHours()*60,e.css("top",t/n.timeInterval*n.timeIntervalHeight)},n.prototype._onEventsDataChanged=function(){this._clearViewsCache(),this._prepareEventsForView(),this._renderActiveView(),this._trigger("eventsDataChanged",null,{eventsData:this.options.eventsData})},n.prototype._onCalendarsChanged=function(){this._trigger("calendarsChanged",null,{calendars:this.options.calendars})},n.prototype._renderDayViewAppointments=function(){var e=this._eventsView,n,r,i,s,o,u=this.element.find(".wijmo-wijev-headercontainer"),a=this.element.find(".wijmo-wijev-scrollcontent"),f=u.find(".wijmo-wijev-dayheadercolumn"),l=a.find(".wijmo-wijev-daycolumn"),c,h,p=this.options,d=this._getDayColumnDates(),v=d[0],m,g,y,b,w,E,S,x,T,N=[];m=d[d.length-1],m=new Date(m.getFullYear(),m.getMonth(),m.getDate(),23,59,59);if(e)for(i=0,o=d.length;i<o;i+=1)if(!l[i]._cached){c=d[i],c=new Date(c.getFullYear(),c.getMonth(),c.getDate()),h=new Date(c.getFullYear(),c.getMonth(),c.getDate(),23,59,59);for(r=0,s=e.length;r<s;r+=1)n=e[r],n.start<m&&n.end>v&&n.start<h&&n.end>c&&(this.isAllDayEvent(n)?(g=!0,y=t(this._getAllDayEventMarkup(n)),t(f[i]).find(".wijmo-wijev-allday-cell").append(y)):(b=n.start,w=n.end,b<c&&(b=c),w>h&&(w=h),E=(b-c)/1e3/60,S=(w-c)/1e3/60,x=Math.round(E*p.timeIntervalHeight/p.timeInterval),T=Math.round(S*p.timeIntervalHeight/p.timeInterval),y=t(this._getEventMarkup(n)),y.css("top",x),y.outerHeight(T-x),t(l[i]).append(y)));this._storeDayCache(d[i],f[i],l[i]),l[i]._cached=!0,N.push(l[i])}else N.push(l[i]);this._dayColumnsToResolve=N,this._dayColumnResolveIdx=0,this._resolveDayApptConflictsTimeout||(clearTimeout(this._resolveDayApptConflictsTimeout),this._resolveDayApptConflictsTimeout=null),this._resolveDayApptConflictsTimeout=setTimeout(t.proxy(this._resolveDayViewAppointmentConflictsCb1,this),1),g&&this._invalidateDayView(!0),this._dayViewScrollToEvent&&(y=this.element.find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn ."+this._eventIdToCssClass(this._dayViewScrollToEvent.id)),y.length>0&&this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("scrollChildIntoView",y))},n.prototype._getAllDayEventMarkup=function(e){return'<div class="wijmo-wijev-appointment '+this._eventIdToCssClass(e.id)+'">'+'<div class="'+" wijmo-wijev-colordot wijmo-wijev-event-color-"+(e.color||"default")+'"></div>'+'<div class="wijmo-wijev-event-title">'+e.subject+"</div>"+"</div>"},n.prototype._getEventMarkup=function(e){return'<div class="wijmo-wijev-appointment wijmo-wijev-event-color-'+(e.color||"default")+" "+this._eventIdToCssClass(e.id)+'">'+'<div class="wijmo-wijev-content"><div class="wijmo-wijev-title">'+this._formatString(this.options.eventTitleFormat,e.start,e.end,e.subject,e.location,"",e.description)+"</div></div>"+'<div class="wijmo-wijev-resizer">'+'<div class="ui-icon ui-icon-grip-solid-horizontal">'+"&nbsp;</div></div>"+"</div>"},n.prototype._resolveDayViewAppointmentConflictsCb1=function(){this._resolveDayApptConflictsTimeout=null;if(!this._dayColumnsToResolve||this._dayColumnResolveIdx>=this._dayColumnsToResolve.length)return;this._resolveDayViewAppointmentConflicts(this._dayColumnsToResolve[this._dayColumnResolveIdx]),this._dayColumnResolveIdx=this._dayColumnResolveIdx+1,setTimeout(t.proxy(this._resolveDayViewAppointmentConflictsCb1,this),1)},n.prototype._resolveDayViewAppointmentConflicts=function(e){var n=t(e).find(".wijmo-wijev-appointment"),r=[],i,s,o,u,a,f,l,c;for(s=0,f=n.length;s<f;s+=1){u=n[s];for(o=0;o<f;o+=1)o!==s&&(a=n[o],u.offsetTop<a.offsetTop+a.offsetHeight&&u.offsetTop+u.offsetHeight>a.offsetTop&&(r[s]||(r[s]=[u]),r[s].push(a)))}for(s=0,f=r.length;s<f;s+=1){i=r[s];if(i){u=i[0],l=i.length,u.style.width=Math.ceil(100/l)+"%",i.sort(this._sortOffsetTop);for(o=0;o<l;o+=1)u=i[o],c=Math.floor(100*o/l),u.style.marginLeft=c+"%",u.style.zIndex=c}}},n.prototype._sortOffsetTop=function(e,t){return e.offsetTop<t.offsetTop?-1:e.offsetTop>t.offsetTop?1:0},n.prototype._onDayViewTimeIntervalClick=function(e){if(this.options.readOnly)return;this.showEditEventDialog(null,e.target,e)},n.prototype._onDayViewAllDayCellClick=function(e){if(this.options.readOnly)return;var n=t(e.target);if(n.hasClass("wijmo-wijev-appointment")||n.parents(".wijmo-wijev-appointment").length>0)return;if(n.hasClass("wijmo-wijev-daylabel")||n.parents(".wijmo-wijev-daylabel").length>0)return;this.showEditEventDialog(null,e.target,e)},n.prototype._onMonthViewDayLabelClick=function(e){var n=t(e.target).parents(".wijmo-wijev-monthcellcontainer"),r=this.options,i;n.length<1&&(n=t(e.target).parents(".wijmo-wijev-dayheadercolumn")),n[0]&&(i=this._parseDateFromClass(n[0].className),r.viewType!=="day"&&(r.viewType="day",this._onViewTypeChanged()),r.selectedDates=[new Date(i)],this._onSelectedDatesChanged())},n.prototype._onMonthViewCellClick=function(e){var n=t(e.target).parent(".wijmo-wijev-monthcellcontainer");if(this.options.readOnly)return;if(n.length<1)return;this.showEditEventDialog(null,n,e)},n.prototype._onAppointmentClick=function(e){var n=t(e.target),r;if(this.options.readOnly)return;if(this._apptDragResizeFlag)return;n.hasClass("wijmo-wijev-appointment")||(n=n.parents(".wijmo-wijev-appointment")),n.length>0&&(r=this.findEventById(n[0].className),this.showEditEventDialog(r,n,e))},n.prototype.findEventById=function(e){var t;if(e){t=e.indexOf("apptid_"),t!==-1&&(e=this._parseEventIdFromClass(e));if(this._eventsDataById)return this._eventsDataById[e]}return null},n.prototype._onMonthViewAppointmentMouseDown=function(e){if(this.options.readOnly)return;var n=t(e.target),r=n.hasClass("wijmo-wijev-appointment")?n:n.parents(".wijmo-wijev-appointment");e.preventDefault(),this.__targetAppt=r,t(document).bind("mouseup.tmp_wijevcal",t.proxy(this._onMonthViewAppointmentMouseUp,this)),this.element.find(".wijmo-wijev-monthview .wijmo-wijev-monthcellcontainer").bind("mouseover.tmp_wijevcal",t.proxy(this._onMonthViewCellMouseOver,this))},n.prototype._onDayViewAppointmentMouseDown=function(e){if(this.options.readOnly)return;var n=t(e.target),r=n.hasClass("wijmo-wijev-appointment")?n:n.parents(".wijmo-wijev-appointment"),i=n.hasClass("wijmo-wijev-resizer")||n.parents(".wijmo-wijev-resizer").length>0;if(this.options.disabled)return;this._isApptResize=i,e.preventDefault(),this._isApptResize?(this.__startApptH=r[0].offsetHeight,this.__startApptY=r[0].offsetTop):this.__startApptY=r[0].offsetTop,this.__startClientY=e.clientY,this.__targetAppt=r,t(document).bind("mousemove.tmp_wijevcal",t.proxy(this._onDayViewAppointmentMouseMove,this)),t(document).bind("mouseup.tmp_wijevcal",t.proxy(this._onDayViewAppointmentMouseUp,this)),t(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn").bind("mouseover.tmp_wijevcal",t.proxy(this._onDayViewColumnMouseOver,this)),t(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-allday-cell").bind("mouseover.tmp_wijevcal",t.proxy(this._onDayViewAllDayMouseOver,this))},n.prototype._onDayViewAppointmentMouseMove=function(e){e.preventDefault();var t=e.clientY-this.__startClientY,n,r=this.options,i,s;e.ctrlKey||(t=Math.round(t/r.timeIntervalHeight)*r.timeIntervalHeight),t!==0&&!this._apptDragResizeFlag&&(this._apptDragResizeFlag=!0,this.__targetAppt.addClass("wijmo-wijev-dragging"),this.__targetAppt.css("width","100%").css("margin-left","0").css("z-index","1000")),this._apptDragResizeFlag&&(this._isApptResize?(i=this.__startApptH+t,i<0?(i=Math.abs(i),n=this.__startApptY-i,n>=0&&(this.__targetAppt.css("height",i),this.__targetAppt.css("top",n))):this.__targetAppt.css("height",i)):(n=this.__startApptY+t,n<0&&(n=0),this.__targetAppt.css("top",n),s=this.__targetAppt.offset().top,this.element.find(".wijmo-wijev-scrollpanel").wijsuperpanel("scrollChildIntoView",this.__targetAppt),this.__startApptY=this.__startApptY-(this.__targetAppt.offset().top-s)),this._onApptVisualDargOrResize(this.__targetAppt,this.findEventById(this.__targetAppt[0].className)))},n.prototype._onDayViewAppointmentMouseUp=function(e){this.__targetAppt&&this.__targetAppt.removeClass("wijmo-wijev-dragging"),t(document).unbind(".tmp_wijevcal"),t(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-daycolumn").unbind(".tmp_wijevcal"),t(this.element).find(".wijmo-wijev-dayview .wijmo-wijev-allday-cell").unbind(".tmp_wijevcal");if(this._apptDragResizeFlag||this._apptMovedFlag){var n=this.findEventById(this.__targetAppt[0].className);this._onApptVisualDargOrResize(this.__targetAppt,n),this._apptMovedFlag=!1,this._movedFromTimeInervalApptElem=null,this.updateEvent(n),window.setTimeout(t.proxy(function(){this.__targetAppt&&!this.__targetAppt.hasClass("wijmo-wijev-dragging")&&(this._apptDragResizeFlag=!1,this._resolveDayViewAppointmentConflicts(this.__targetAppt.parents(".wijmo-wijev-daycolumn")))},this),1)}},n.prototype._updateAppointmentVisual=function(e){var t=this.element.find(".wijmo-wijev-dayview ."+this._eventIdToCssClass(e.id)),n=this.options,i,s,o,u,a,f,l,c;t.length===1&&(this._addColorClass(t,e.color),t.find(".wijmo-wijev-title").html(this._formatString(n.eventTitleFormat,e.start,e.end,e.subject,e.location,"",e.description)),a=r(e.start),i=(e.start-a)/1e3/60,s=(e.end-a)/1e3/60,o=Math.round(i*n.timeIntervalHeight/n.timeInterval),u=Math.round(s*n.timeIntervalHeight/n.timeInterval),t.css("top",o),t.css("height",u-o),f=this._dayDateToCssClass(a),t.parents(".wijmo-wijev-daycolumn."+f).length!==1&&(l=t[0].parentNode,c=this.element.find(".wijmo-wijev-daycolumn."+f),l.removeChild(t[0]),t.appendTo(c)))},n.prototype._onApptVisualDargOrResize=function(e,t){var n=this.options,i=e[0].offsetTop,s=i+e[0].offsetHeight,o,u,a,f,l,c,h,p;e.parents(".wijmo-wijev-dayheadercolumn").length>0?p=e.parents(".wijmo-wijev-dayheadercolumn")[0]:p=e.parents(".wijmo-wijev-daycolumn")[0],h=this._parseDateFromClass(p.className,null),o=Math.round(i*n.timeInterval/n.timeIntervalHeight),u=Math.round(s*n.timeInterval/n.timeIntervalHeight),a=new Date(o*60*1e3+h.getTime()),f=new Date(u*60*1e3+h.getTime()),t&&(this._isApptResize?l=f:(c=t.end.getTime()-t.start.getTime(),l=new Date(a.getTime()+c)),t.allday=e.parents(".wijmo-wijev-dayheadercolumn").length>0,t.start=a,t.end=l,e.find(".wijmo-wijev-title").html(this._formatString(n.eventTitleFormat,t.start,t.end,t.subject,t.location,"",t.description)),!this._isApptResize&&l.getTime()!==f.getTime()&&e.css("height",Math.round((t.end-r(t.start))/1e3/60*n.timeIntervalHeight/n.timeInterval)-Math.round((t.start-r(t.start))/1e3/60*n.timeIntervalHeight/n.timeInterval)))},n.prototype._onDayViewColumnMouseOver=function(e){var n=t(e.target).parents(".wijmo-wijev-daycolumn"),r=this.__targetAppt.parents(".wijmo-wijev-daycolumn");if(n.length<1)return;if(r.length<1){r=this.__targetAppt.parents(".wijmo-wijev-dayheadercolumn");if(r.length<1)return;this._movedFromTimeInervalApptElem?(this.__targetAppt.replaceWith(this._movedFromTimeInervalApptElem),this.__targetAppt=t(this._movedFromTimeInervalApptElem),this._movedFromTimeInervalApptElem=null):this.__targetAppt.html(this._getEventMarkup(this.findEventById(this.__targetAppt[0].className)))}n[0].className!==r[0].className&&(this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]),this._resolveDayViewAppointmentConflicts(r),this.__targetAppt.appendTo(n),this._apptMovedFlag=!0)},n.prototype._onMonthViewCellMouseOver=function(e){var n=t(e.target),r=n.hasClass("wijmo-wijev-monthcellcontainer")?n:n.parents(".wijmo-wijev-monthcellcontainer"),i=this.__targetAppt.parents(".wijmo-wijev-monthcellcontainer");if(r.length<1||i.length<1)return;r[0].className!==i[0].className&&(this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]),this.__targetAppt.appendTo(r.find(".wijmo-wijev-monthcell")),this.__targetApptChanged=!0)},n.prototype._onMonthViewAppointmentMouseUp=function(){var e,n=this.__targetAppt.parents(".wijmo-wijev-monthcellcontainer")[0],i=this._parseDateFromClass(n.className,null),s;t(document).unbind(".tmp_wijevcal"),this.element.find(".wijmo-wijev-monthview .wijmo-wijev-monthcellcontainer").unbind(".tmp_wijevcal"),this.__targetApptChanged&&(this.__targetApptChanged=!1,e=this.findEventById(this.__targetAppt[0].className),s=(i.getTime()-r(e.start).getTime())/864e5,e.start=this._addDays(e.start,s),e.end=this._addDays(e.end,s),this.updateEvent(e))},n.prototype._onDayViewAllDayMouseOver=function(e){var n=t(e.target).parents(".wijmo-wijev-dayheadercolumn"),r=this.__targetAppt.parents(".wijmo-wijev-daycolumn"),i;if(n.length<1)return;r.length>0?(i=t(this._getAllDayEventMarkup(this.findEventById(this.__targetAppt[0].className))),this._movedFromTimeInervalApptElem=this.__targetAppt[0].cloneNode(!0),this.__targetAppt.replaceWith(i),this.__targetAppt=i):r=this.__targetAppt.parents(".wijmo-wijev-dayheadercolumn");if(r.length<1)return;n[0].className!==r[0].className&&(this.__targetAppt[0].parentNode.removeChild(this.__targetAppt[0]),this._resolveDayViewAppointmentConflicts(r),this.__targetAppt.appendTo(t(n).find(".wijmo-wijev-allday-cell")),this._apptMovedFlag=!0)},n.prototype._renderMonthView=function(){var e=this.options,n=e.selectedDate,r=e.firstDayOfWeek,i=!1,s=!1,o,u,a,f=new Date,l,c,h=!1,p,d=["","","","","","",""],v,m,g=this.element.find(".wijmo-wijev-view.wijmo-wijev-monthview"),y,b=e.dayHeaderFormat,w=e.firstRowDayHeaderFormat;n||(n=new Date),u=new Date(n.getFullYear(),n.getMonth(),1);while(u.getDay()!==r)u=this._addDays(u,-1);a=new Date(n.getFullYear(),n.getMonth(),this._daysInMonth(n.getMonth(),n.getFullYear())),o=u,l=0,c=0;while(o<a||l<7){o>a&&(a=o),v="",p="wijmo-wijev-monthcellcontainer "+e.wijCSS.content+" "+this._dayDateToCssClass(o),s=o.getMonth()!==n.getMonth(),s&&(p+=" wijmo-wijev-othermonth"),h?h=!1:(p+=" wijmo-wijev-leftborder",l===6&&(p+=" wijmo-wijev-rightborder")),i=this._compareDayDates(o,f)===0,i&&(p+=" wijmo-wijev-today",p+=" wijmo-wijev-rightborder",h=!0),v+='<div class="'+p+'">',v+='<div class="wijmo-wijev-monthcellheader',s&&(v+=" ui-priority-secondary"),i&&(v+=" ui-state-highlight"),v+='">',i&&(v+='<span class="wijmo-wijev-todaylabel">'+this.localizeString("labelToday","Today")+"</span>"),c===0?v+=this._formatString(w,o):v+=this._formatString(b,o),v+="</div>",v+='<div class="wijmo-wijev-monthcell',s&&(v+=" ui-priority-secondary"),i&&(v+=" ui-state-highlight"),v+='"></div>',v+="</div>",d[l]=d[l]+v,l+=1,o=this._addDays(o,1);if(l>6){if(o>a)break;l=0,c+=1}}g.length===0&&(g=t('<div class="wijmo-wijev-view wijmo-wijev-monthview '+e.wijCSS.content+'">'+'<h3 class="wijmo-wijev-header-title">title'+"</h3>"+'<div class="wijmo-wijev-monthview-inner">'+"</div>"+"</div>"),g.appendTo(this.element.find(".wijmo-wijev-view-container"))),y=g.find(".wijmo-wijev-monthview-inner"),y.find(".wijmo-wijev-monthcolumn").remove(),o=u;for(m=0;m<7;m+=1)y.append('<div class="wijmo-wijev-monthcolumn">'+d[m]+"</div>"),o=this._addDays(o,1);this._invalidateMonthView(),this._renderMonthViewAppointments()},n.prototype._invalidateMonthView=function(){var e=this.element.find(".wijmo-wijev-monthview"),n=e.find(".wijmo-wijev-monthview-inner"),r=e.find(".wijmo-wijev-monthcolumn"),i=e.find(".wijmo-wijev-monthcellcontainer"),s=this.element.find(".wijmo-wijev-monthview .wijmo-wijev-header-title"),o,u,a,f,l,c,h,p;this._invalidateView();if(r.length<1)return;o=e.innerWidth(),u=e.innerHeight()-s.outerHeight(!0),n.outerWidth(o),n.outerHeight(u),o-=n.outerWidth(!0)-n.innerWidth(),u-=n.outerHeight(!0)-n.innerHeight(),a=Math.floor(o/r.length),r.outerWidth(a),p=o-a*r.length,p>0&&t(r[r.length-1]).outerWidth(a+p),h=t(r[0]).find(".wijmo-wijev-weekdayname").outerHeight(!0),h||(h=0),f=Math.floor((u-h)/t(r[0]).find(".wijmo-wijev-monthcellcontainer").length),i.height(f),l=t(i[0]).find(".wijmo-wijev-monthcellheader").outerHeight(!0),c=f-l,i.find(".wijmo-wijev-monthcell").outerHeight(c)},n.prototype._renderMonthViewAppointments=function(){var e=this._eventsView,n,r,i,s,o,u=this.element.find(".wijmo-wijev-monthcellcontainer"),a,f,l,c;if(e)for(i=0,o=u.length;i<o;i+=1){a=u[i],f=this._parseDateFromClass(a.className),l=new Date(f.getFullYear(),f.getMonth(),f.getDate(),23,59,59);for(r=0,s=e.length;r<s;r+=1)n=e[r],n.start<l&&n.end>f&&(c=t('<div class="wijmo-wijev-appointment '+this._eventIdToCssClass(n.id)+'">'+'<div class="'+" wijmo-wijev-colordot wijmo-wijev-event-color-"+(n.color||"default")+'"></div>'+'<div class="wijmo-wijev-event-title">'+n.subject+"</div>"+"</div>"),t(a).find(".wijmo-wijev-monthcell").append(c))}u.find(".wijmo-wijev-monthcell").each(t.proxy(function(e,n){var r=t(n),i=r.find(".wijmo-wijev-appointment"),s=r.outerHeight(),o=i.outerHeight(),u=i.length*o,a=0;u>s&&(i.each(function(e,t){e*o+o>s&&(t.style.display="none",a+=1)}),a>0&&r.find(".wijmo-wijev-monthcell-showmore").length<1&&r.append(t('<div class="wijmo-wijev-monthcell-showmore">'+this._formatString(this.localizeString("monthCellMoreEventsFormat","{0}  more..."),a)+"</div>")))},this))},n.prototype.log=function(e,t){},n.prototype._log=function(e,n){var r;this.logPanel&&(r=new Date,this.logPanel.prepend(t('<span class="'+(n?n:"wijmo-wijev-information")+'">'+"["+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds()+"] "+e+"</span><br/>")))},n.prototype._createLogPanel=function(){if(!this.logPanel){this.logDialog=t('<div title="Log"><div class="wijmo-wijev-log"></div></div>'),this.logDialog.appendTo(this.element);var e={};e[this.localizeString("buttonClearAll","Clear All")]=function(){t(this).find(".wijmo-wijev-log").html("")},e[this.localizeString("buttonClose","Close")]=function(){t(this).wijdialog("close")},this.logPanel=this.logDialog.wijdialog({captionButtons:{},buttons:e,width:600,height:420,position:["right","top"]}).find(".wijmo-wijev-log")}this.logDialog.wijdialog("open")},n.prototype.status=function(e,t){this.element.find(".wijmo-wijev-statusbar").html("<span class='"+(t?t:"wijmo-wijev-status")+"'>"+e+"</span>"),this.log(e,t?t:"wijmo-wijev-status")},n.prototype._invalidateView=function(){var e=this.element.find(".wijmo-wijev-rightpane"),n=this.element.find(".wijmo-wijev-leftpane"),r=this.element.find(".wijmo-wijev-headerbar"),i=this.element.find(".wijmo-wijev-navigationbar"),s=this.element.find(".wijmo-wijev-statusbar"),o=this.element.find(".wijmo-wijev-view-container"),u=this.element.find(".wijmo-wijev-view"),a,f,l,c,h,p,d,v,m,g;a=this.element.innerWidth()-(o.outerWidth(!0)-o.innerWidth()),f=this.element.innerHeight()-(o.outerHeight(!0)-o.innerHeight()),l=r.is(":visible")?r.outerHeight(!0):0,c=i.is(":visible")?i.outerHeight(!0):0,h=s.is(":visible")?s.outerHeight(!0):0,o.outerWidth(a),o.outerHeight(f-l-c-h),v=0;for(g=0;g<n.length;g+=1)t(n[g]).is(":visible")&&(v+=t(n[g]).outerWidth());m=e.is(":visible")?e.outerWidth():0,p=f-l-c-h,d=a-m-v-1,u.outerHeight(p),u.outerWidth(d),r.outerWidth(d+v),i.outerWidth(this.element.innerWidth()),s.outerWidth(d+v+m),n.outerHeight(f-l-c-h),e.outerHeight(f+100),this.element.find(".wijmo-wijev-datepager").wijdatepager("refresh")},n.prototype._daysInMonth=function(e,t){var n=new Date(t,e+1,0);return n.getDate()},n.prototype._addMinutes=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes()+t)},n.prototype._addDays=function(e,t){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+t,e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds())},n.prototype._setTime=function(e,t,n){var r;return e=new Date(e),e.setHours(t.getHours()),e.setMinutes(t.getMinutes()),e.setSeconds(t.getSeconds()),e.setMilliseconds(t.getMilliseconds()),n&&(r=Math.floor((t.getTime()-n.getTime())/864e5),r>0&&(e=this._addDays(e,r))),e},n.prototype._addMonths=function(e,t){return new Date(e.getFullYear(),e.getMonth()+t,e.getDate())},n.prototype._compareDayDates=function(e,t){return e=new Date(e.getFullYear(),e.getMonth(),e.getDate()),t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),e<t?-1:e>t?1:0},n.prototype._dayDateToCssClass=function(e){return"wijmo-wijev-date_"+e.getFullYear()+"_"+e.getMonth()+"_"+e.getDate()},n.prototype._parseDateFromClass=function(e,t,n){var r,i,s,o=new RegExp("wijmo-wijev-minute-(\\d+)\\s"),u=new RegExp("wijmo-wijev-date_(\\d+_\\d+_\\d+)\\s");return e?(s=u.exec(e+" ")[1].split("_"),r=new Date(parseInt(s[0],10),parseInt(s[1],10),parseInt(s[2],10)),t&&(i=o.exec(t+" "),i&&(i=parseInt(i[1],10),r.setMinutes(i))),r):n||null},n.prototype._eventIdToCssClass=function(e){return"apptid_"+e},n.prototype._parseEventIdFromClass=function(e){var t="",n,r;return n=new RegExp("apptid_(\\S+)"),r=n.exec(e),r&&r.length>1&&(t=r[1]),t},n.prototype._isContainsDayDate=function(e,t){var n;if(!e)return!1;for(n=0;n<e.length;n+=1)if(this._compareDayDates(e[n],t)===0)return!0},n.prototype._formatString=function(e,t,n,r,i,s,o,u){var a,f=arguments,l,c,h=this;if(f.length<=1)return Globalize.format(f);typeof e=="string"&&(e==="_formatWeekTitle"?e=this._formatWeekTitle:e==="_formatMonthTitle"?e=this._formatMonthTitle:typeof window[e]=="function"&&(e=window[e]));if(typeof e=="function"){c=[];for(l=1;l<f.length;l+=1)c[l-1]=f[l];return e.apply(this,c)}return a=new RegExp("\\{(\\d+)(?:,([-+]?\\d+))?(?:\\:([^(^}]+)(?:\\(((?:\\\\\\)|[^)])+)\\)){0,1}){0,1}\\}","g"),e.replace(a,function(e,t,n,r,i){return e=f[Number(t)+1],r?Globalize.format(e,r,h._getCulture()):e})},n.prototype._formatMonthTitle=function(e){return this._formatString(this.localizeString("monthViewHeaderFormat","{0:MMMM yyyy}"),e)},n.prototype._formatWeekTitle=function(e,t){return e.getMonth()!==t.getMonth()?this._formatString(this.localizeString("weekViewHeaderFormat2Months","{0:MMMM} - {1:MMMM yyyy}"),e,t):this._formatString(this.localizeString("weekViewHeaderFormat","{0:MMMM yyyy}"),e)},n.prototype._formatDayHeaderDate=function(e){var t=this.options,n=t.viewType.toLowerCase(),r=this.options.dayViewHeaderFormat;if(r[n])r=r[n];else if(!r[n])return"";return this._formatString(r,e)},n.prototype._getCulture=function(e){return Globalize.findClosestCulture(e||this.options.culture)},n.prototype._isRTL=function(){return!!this._getCulture().isRTL},n.prototype._onAjaxError=function(e,t,n,r){t?(this.status("Ajax error "+t.status+" ("+t.statusText+")","error"),this.log("Error, requested url: "+n.url,"error"),t.responseText&&this.log("Error, response text: "+t.responseText,"error")):(this.status("Ajax error detected.","error"),this.log("Error, requested url: "+n.url,"error"))},n.prototype._onWindowResize=function(){this.invalidate()},n}(e.wijmoWidget);e.wijevcal=h,h.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,{wijMobileCSS:{header:"ui-header ui-bar-a",content:"ui-body ui-body-c",stateDefault:"ui-btn-up-c"},initSelector:":jqmData(role='wijevcal')",culture:"",localization:null,datePagerLocalization:null,readOnly:!1,webServiceUrl:"",colors:null,dataStorage:{addEvent:null,updateEvent:null,deleteEvent:null,loadEvents:null,addCalendar:null,updateCalendar:null,deleteCalendar:null,loadCalendars:null},dataSource:null,eventsData:[],appointments:[],calendars:[],disabled:!1,editCalendarTemplate:"",enableLogs:!1,eventTitleFormat:"{2}",titleFormat:{day:!1,week:"_formatWeekTitle",month:"_formatMonthTitle",list:!1},firstDayOfWeek:0,headerBarVisible:!0,navigationBarVisible:!0,rightPaneVisible:!1,selectedDate:null,selectedDates:null,statusBarVisible:!1,timeInterval:30,timeIntervalHeight:15,timeRulerInterval:60,timeRulerFormat:"{0:h tt}",dayHeaderFormat:"{0:d }",firstRowDayHeaderFormat:"{0:ddd d}",dayViewHeaderFormat:{day:"all-day events",week:"{0:d dddd}",list:"{0:d dddd}"},viewType:"day",visibleCalendars:["Default"]}),t.wijmo.registerWidget(n,h.prototype)})(wijmo||(wijmo={}));