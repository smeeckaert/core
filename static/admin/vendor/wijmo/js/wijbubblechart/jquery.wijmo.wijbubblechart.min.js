var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){var t=1e4,n=0,r=0,i=0,s=function(e){function s(){e.apply(this,arguments)}return __extends(s,e),s.prototype._setOption=function(n,r){var i=this,s=i.options;if(n==="minimumSize"||n==="minimumSize")isNaN(r)||r<0?r=0:r>t&&(r=t),s[n]=r,i.redraw();else if(n==="chartLabel")$.extend(s.chartLabel,r),i.redraw();else{if(n==="showChartLabels"||n==="chartLabelStyle")s[n]=r,i._setLabelOption();e.prototype._setOption.call(this,n,r)}n==="seriesList"&&(i.indexs=null,i.bubbleRadius=null)},s.prototype._create=function(){var t=this,n=t.options,r=t._getDefFill();this._handleChartStyles(),t._setLabelOption(),e.prototype._create.call(this),t.chartElement.addClass(n.wijCSS.bubbleChart)},s.prototype._setLabelOption=function(){var e=this.options;e.showChartLabels!==!0&&e.chartLabel.visible===!0&&(e.chartLabel.visible=!1),!$.isPlainObject(e.chartLabel.style)&&$.isPlainObject(e.chartLabelStyle)&&(e.chartLabel.style=e.chartLabelStyle)},s.prototype._clearChartElement=function(){var t=this,n=t.options,r=t.chartElement.data("fields");e.prototype._clearChartElement.call(this),r&&r.bubbleInfos&&$.each(r.bubbleInfos,function(e,t){t.bubble&&t.bubble.wijRemove(),t.dcl&&t.dcl.wijRemove(),t.symbol&&t.symbol.wijRemove()}),r&&r.bubbles&&t._destroyRaphaelArray(r.bubbles),t.element.removeData("plotInfos"),n.seriesTransition.enabled||r&&r.bubblesAnimationInfos&&(r.bubblesAnimationInfos=null)},s.prototype.destroy=function(){var t=this;t.chartElement.removeClass(t.options.wijCSS.bubbleChart+" ui-helper-reset"),t._destroyEles(),e.prototype.destroy.call(this)},s.prototype.getBubble=function(e){return this.chartElement.data("fields").bubbles[e]},s.prototype._destroyEles=function(){var e=this,t=e.element,n=t.data("fields");n.bubbleInfos&&$.each(n.bubbleInfos,function(t,n){e._removeEle(n.bubble),e._removeEle(n.dcl),e._removeEle(n.symbol),n=null}),t.removeData("fields"),e.bubbleRadius=[]},s.prototype._removeEle=function(e){e&&(e.node&&$(e.node).removeData(),e.wijRemove(),e=null)},s.prototype._paintPlotArea=function(){var e=this,t=this.chartElement,n=e.options,r=n.seriesList,i=r.length,s=[].concat(n.seriesStyles.slice(0,i)),u=[].concat(n.seriesHoverStyles.slice(0,i)),a=e.canvasBounds,f=e.axisInfo.x,l=e.axisInfo.y[0];if(i===0)return;e._prepBubbleData(),this.bubbleChartRender=new o(this.chartElement,{seriesList:r,seriesStyles:s,seriesHoverStyles:u,canvas:e.canvas,bounds:a,xAxisInfo:f,yAxisInfo:l,chartLabel:n.chartLabel,textStyle:n.textStyle,chartLabelStyle:n.chartLabelStyle,chartLabelFormatString:n.chartLabelFormatString,bubbleRadius:e.bubbleRadius,animation:n.animation,seriesTransition:n.seriesTransition,sizingMethod:n.sizingMethod,minimumSize:n.minimumSize,maximumSize:n.maximumSize,mouseDown:$.proxy(e._mouseDown,e),mouseUp:$.proxy(e._mouseUp,e),mouseOver:$.proxy(e._mouseOver,e),mouseOut:$.proxy(e._mouseOut,e),mouseMove:$.proxy(e._mouseMove,e),click:$.proxy(e._click,e),disabled:n.disabled,culture:e._getCulture(),wijCSS:n.wijCSS,widget:this}),this.bubbleChartRender.render(),e.tooltipbubbles=[],$.each(t.data("fields").bubbleInfos,function(t,n){e.tooltipbubbles.push(n.bubble),n.dcl&&e.tooltipbubbles.push(n.dcl),n.symbol&&e.tooltipbubbles.push(n.symbol)}),e.tooltip&&e.tooltip.setTargets(e.tooltipbubbles)},s.prototype._paintLegendIcon=function(e,t,n,r,i,s,o,u,a,f){var l=this,c=Math.min(n,r),h,p,d;return h=a.markerStyle,h=$.extend({fill:i.stroke,stroke:i.stroke,opacity:1},h),a.markers&&(p=a.markers.type),p||(p="circle"),d=l.canvas.paintMarker(p,e+n/2,t+r/2,c/2),$(d.node).data("legendIndex",s).data("index",o),l.legendIcons.push(d),d.attr(h),$.wijraphael.addClass($(d.node),u),d},s.prototype._getbubbleIndexs=function(e,t){var n=this,o=n.options,u=o.axis.x.max,a=o.axis.x.min,f=o.axis.y.min,l=o.axis.y.max,c=[],h=[],p=[],d=[],v=[],m=[],g=-1,y=-1,b=-1,w=-1;n.bubbleRadius=[],n._prepBubbleData(),$.each(o.seriesList,function(g,y){var b=y.data,w=y.markers||{},E=w.type||"circle";if(b.y1===undefined)return!0;$.each(b.y1,function(g,y){var w=s.transform(y,o.maximumSize,o.minimumSize,n.canvasBounds,r,i,o.sizingMethod,E),S,x;n._isDate(b.x[g])?S=$.toOADate(b.x[g]):isNaN(b.x[g])?S=g:S=b.x[g],x=b.y[g],n._isDate(x)&&(x=$.toOADate(x)),c.push(S-w*(u-a)/e),h.push(x-w*(l-f)/t),p.push(S+w*(u-a)/e),d.push(x+w*(l-f)/t),v.push(S),m.push(x),n.bubbleRadius.push(w)})}),g=n._getMinIndex(c),y=n._getMinIndex(h),b=n._getMaxIndex(p),w=n._getMaxIndex(d),n.indexs={xMin:{x:v[g],y:m[g],r:n.bubbleRadius[g]},xMax:{x:v[b],y:m[b],r:n.bubbleRadius[b]},yMin:{x:v[y],y:m[y],r:n.bubbleRadius[y]},yMax:{x:v[w],y:m[w],r:n.bubbleRadius[w]}}},s.prototype._calculateParameters=function(t,n){e.prototype._calculateParameters.call(this,t,n);var r=this;if(!n.autoMax&&!n.autoMin)return;r._adjust(n,t)},s.prototype._adjust=function(e,t){var n=e.unitMinor,r=this,i=e.autoMin,s=e.autoMax,o=r.canvasBounds,u={x:o.startX,y:o.startY},a=o.endX-u.x,f=o.endY-u.y,l=t.max,c=t.min,h=e.origin;r.indexs||r._getbubbleIndexs(a,f),t.id==="x"?(i&&(c=r._getMinTick(r.indexs.xMin.x,r.indexs.xMin.r,c,l,a,n)),s&&(l=r._getMaxTick(r.indexs.xMax.x,r.indexs.xMax.r,c,l,a,n))):(i&&(c=r._getMinTick(r.indexs.yMin.y,r.indexs.yMin.r,c,l,f,n)),s&&(l=r._getMaxTick(r.indexs.yMax.y,r.indexs.yMax.r,c,l,f,n)));if(l!==t.max||c!==t.min)h!==null&&h!==undefined&&(h<c?c=h:h>l&&(l=h)),t.min=c,t.max=l,this._calculateMajorMinor(e,t),r._adjust(e,t)},s.prototype._getMinTick=function(e,t,n,r,i,s){return(e-n)*i/(r-n)<t?n-s:n},s.prototype._getMaxTick=function(e,t,n,r,i,s){return(e-n)*i/(r-n)+t>i?r+s:r},s.prototype._getMinIndex=function(e){var t=-1,n=0;return $.each(e,function(e,t){e===0?n=t:t<n&&(n=t)}),$.each(e,function(e,r){if(r===n)return t=e,!1}),t},s.prototype._getMaxIndex=function(e){var t=-1,n=0;return $.each(e,function(e,t){e===0?n=t:t>n&&(n=t)}),$.each(e,function(e,r){if(r===n)return t=e,!1}),t},s.prototype._showSerieEles=function(e){$.each(e,function(e,t){t.bubble&&(t.bubble.show(),t.bubble.tracker&&t.bubble.tracker.show(),$(t.bubble.node).data("wijchartDataObj")&&($(t.bubble.node).data("wijchartDataObj").visible=!0)),t.dcl&&t.dcl.show(),t.symbol&&t.symbol.show()})},s.prototype._hideSerieEles=function(e){$.each(e,function(e,t){t.bubble&&(t.bubble.hide(),t.bubble.tracker&&t.bubble.tracker.hide(),$(t.bubble.node).data("wijchartDataObj")&&($(t.bubble.node).data("wijchartDataObj").visible=!1)),t.dcl&&t.dcl.hide(),t.symbol&&t.symbol.hide()})},s.prototype._indicatorLineShowing=function(t){e.prototype._indicatorLineShowing.call(this,t),$.each(t,function(e,t){t.bubble&&t.bubble.attr(t.hoverStyle)})},s.prototype._removeIndicatorStyles=function(e){$.each(e,function(e,t){t.bubble&&t.bubble.attr(t.style)})},s.prototype._parseTable=function(){if(!this.element.is("table"))return;var e=this,t=e.element,n=e.options,r=$("caption",t),i=$("thead th",t),s=[],o=$("tbody tr",t),u=null,a=null,f=[],l=[],c=[],h=function(e){var t=$.trim(e);return isNaN(e)||(t=parseFloat(e.toString())),t};r.length&&(n.header=$.extend({visible:!0,text:$.trim($(r[0]).text())},n.header),r.length>1&&(n.footer=$.extend({visibel:!0,text:$.trim($(r[1]).text())},n.footer))),n.legend=$.extend({visible:!0},n.legend),u=$.trim(i.eq(1).text()),o.each(function(e,t){var n=$("td",t);return n.length>=3&&(f.push(h(n.eq(0).text())),l.push(h(n.eq(1).text())),c.push(h(n.eq(2).text()))),this}),a={label:u,legendEntry:!0,data:{x:f,y:l,y1:c}},s.push(a),e.options.seriesList=s},s.prototype._unbindLiveEvents=function(){var e=this;$("."+e.options.wijCSS.bubbleElement,e.chartElement[0]).off(".wijbubblechart").off("wijbubblechart"),e.tooltip&&(e.tooltip.destroy(),e.tooltip=null)},s.prototype._paintTooltip=function(){var t=this,n=t.chartElement.data("fields");e.prototype._paintTooltip.call(this),t.tooltip&&n&&n.trackers&&n.trackers.length&&(t.tooltip.setTargets(n.trackers),t.tooltip.setOptions({relatedElement:n.trackers[0]}))},s.prototype._getTooltipText=function(e,t){var n=$(t.node),r,i;return n.data("owner")&&(n=n.data("owner")),r=n.data("wijchartDataObj"),i={data:r,value:r.value,label:r.label,total:r.total,target:t,fmt:e,x:r.x,y:r.y,y1:r.y1},$.proxy(e,i)()},s.prototype._prepBubbleData=function(){var e=this,t=e.options.seriesList,s=-999999999999,o=9999999999999,u;$.each(t,function(e,t){u=t.data,u&&u.y1&&$.each(u.y1,function(e,t){s=Math.max(s,t),o=Math.min(o,t)})}),n=s,r=o,i=s-o},s.transform=function(t,r,i,o,u,a,f,l){var c,h=t,p=r-i,d=o.endX-o.startX,v=o.endY-o.startY;return h<0&&(h=0),a===0?h=1:h/=n,h=s.transformByArea(h,f,l),h*=p,h+=i,c=Math.min(d,v),h*=c/200,h},s.transformByArea=function(t,n,r){var i=t;if(n==="area")switch(r){case"circle":i=Math.sqrt(i/Math.PI);break;case"tri":case"invertedTri":i=Math.sqrt(i/(3*Math.sin(Math.PI/6)*Math.cos(Math.PI/6)));break;case"box":i=Math.sqrt(i/2);break;case"diamond":case"cross":i=Math.sqrt(i/2);break;default:i=Math.sqrt(4*i/Math.PI)}return i},s}(e.WijChartCore);e.WijBubbleChart=s,s.prototype.widgetEventPrefix="wijbubblechart",s.prototype.options=$.extend(!0,{},e.WijChartCore.prototype.options,{initSelector:":jqmData(role='wijbubblechart')",wijCSS:{bubbleChart:"wijmo-wijbubblechart",bubbleElement:"wijbubblechart-bubble",bubbleTracker:"bubbletracker",bubbleLabel:"wijbubblechart-label",bubbleSymbol:"wijbubblechart-symbol"},minimumSize:5,maximumSize:20,sizingMethod:"diameter",animation:{enabled:!0,duration:1e3,easing:">"},seriesTransition:{enabled:!0,duration:400,easing:">"},seriesList:[],seriesHoverStyles:[{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5},{opacity:1,"stroke-width":5}],chartLabel:{position:"inside",compass:"north",visible:!0,style:{},chartLabelFormatString:""},mouseDown:null,mouseUp:null,mouseOver:null,mouseOut:null,mouseMove:null,click:null}),$.wijmo.registerWidget("wijbubblechart",s.prototype);var o=function(){function e(e,t){this.element=e,this.options=t,this._init()}return e.prototype._init=function(){var e=this.options,t=e.bounds;this.fields=this.element.data("fields")||{},this.canvas=e.canvas,this.seriesList=$.arrayClone(e.seriesList),this.seriesStyles=e.seriesStyles,this.seriesHoverStyles=e.seriesHoverStyles,this.startLocation={x:t.startX,y:t.startY},this.width=t.endX-this.startLocation.x,this.height=t.endY-this.startLocation.y,this.seriesEles=[],this.bubbles=[],this.bubbleInfos=[],this.trackers=this.canvas.set(),this.currentIndex=0},e.prototype.initAnimationState=function(e,t){var n=e.bubble,r=e.symbol,i;n.type==="circle"?n.attr({r:1e-4,cx:t.startX,cy:t.endY}):(n.transform("s0.01"),i=n.wijGetBBox(),n.transform("t"+(t.startX-i.x)+","+(t.endY-i.y)+"s0.001")),r&&r.hide()},e.prototype.playAnimation=function(){var e=this,t=e.options,n=t.animation,r=t.bounds,i=e.fields.bubblesAnimationInfos,s=[],o=e.fields.bubbleInfos,u=t.seriesTransition,a,f,l;n&&n.enabled?(a=n.duration||400,f=n.easing,$.each(o,function(t,n){var o=n.bubble,c,h,p=o.wijGetBBox();o.type==="circle"?c={r:o.attr("r"),cx:o.attr("cx"),cy:o.attr("cy")}:c={transform:"S1T0,0","stroke-width":o.attr("stroke-width"),width:p.width,x:p.x,y:p.y},i&&u.enabled?(h=i[t],h?(o.type==="circle"?o.attr({cx:h.cx,cy:h.cy,r:h.r}):(p=o.wijGetBBox(),l=h.width/p.width,o.transform("s"+l),p=o.wijGetBBox(),o.transform("t"+(h.x-p.x)+","+(h.y-p.y)+"")),a=u.duration,f=u.easing):e.initAnimationState(n,r)):e.initAnimationState(n,r),s.push(c),o.wijAnimate(c,a,f,function(){$(n.bubble.node).data("wijchartDataObj")&&$(n.bubble.node).data("wijchartDataObj").visible&&(n.dcl&&n.dcl.show(),n.symbol&&n.symbol.show())})}),e.fields.bubblesAnimationInfos=s):$.each(o,function(e,t){$(t.bubble.node).data("wijchartDataObj")&&$(t.bubble.node).data("wijchartDataObj").visible&&(t.dcl&&t.dcl.show(),t.symbol&&t.symbol.show())})},e.prototype.getSymbol=function(e,t){var n;return $.each(e,function(e,r){if(e===t)return n=r,!1}),n},e.prototype.getLabelVisible=function(e,t){var n=!0;return $.each(e,function(e,r){if(t===r)return n=!1,!1}),n},e.prototype.paintMarker=function(e,t,n,r){var i;return this.canvas[e]&&(i=this.canvas[e](t,n,r)),i},e.prototype.getLabelBox=function(e){var t=this.canvas.text(0,0,e),n=t.wijGetBBox(),r;return r={width:n.width,height:n.height},t.remove(),r},e.prototype.applyLabelCompass=function(e,t){var n=this.options.chartLabel.compass||"north",r=this.getLabelBox(t),i=e.r;switch(n){case"north":e.y-=i+r.height/2;break;case"south":e.y+=i+r.height/2;break;case"east":e.x+=i+r.width/2;break;case"west":e.x-=i+r.width/2}},e.prototype.paintDefaultChartLabel=function(e,t){var n=this.options,r=n.chartLabel,i=n.culture,s=$.extend(!0,{},n.textStyle,n.chartLabelStyle,r.style),o=$.round(t,2),u=r.chartLabelFormatString===""?n.chartLabelFormatString:r.chartLabelFormatString,a=this.options.widget,f;return u&&u.length&&(o=Globalize.format(o,u,i)),f=a._text.call(a,e.x,e.y,o).attr(s),f},e.prototype.paintbubble=function(e,t,n,o,u,a,f,l){var c=e.data,h=o.min,p=u.min,d=o.max,v=u.max,m=a/(d-h),g=f/(v-p),y=[],b=this.options,w=this,E=b.bounds,S=b.wijCSS,x=b.widget,T=b.chartLabel,N=b.bubbleRadius,C,k,L,A;if(c.y1===undefined)return;$.each(c.y1,function(a,f){if(c.x===undefined||c.y===undefined)return!0;var l=c.x[a],p=c.y[a],d=e.markers||{},O=d.type||"circle",M=d.symbol,_=e.invisibleMarkLabels||[],D,P,H,B,j,F,I,q,R,U;N?(R=N[w.currentIndex],w.currentIndex++):R=s.transform(f,b.maximumSize,b.minimumSize,b.bounds,r,i,b.sizingMethod,O),o.isTime?l=$.toOADate(l):isNaN(l)&&(l=a),u.isTime&&(p=$.toOADate(p)),j=E.startX+(l-h)*m,F=E.startY+(v-p)*g,M&&(I=w.getSymbol(M,a)),B=w.paintMarker(O,j,F,R),B.attr(t),I&&(k=I.width||R*2,L=I.height||R*2,q=w.canvas.image(I.url,j-R,F-R,k,L)),$.wijraphael.addClass($(B.node),S.canvasObject+" "+S.bubbleElement),I&&B.attr("opacity",.1),H=$.extend(!1,{index:a,bubble:B,style:t,y1:f,x:l,y:p,type:"bubble",hoverStyle:n,visible:!0},e),I&&(H.symbol=!0,H.hoverStyle=$.extend({},n,{opacity:.1}),$(q.node).data("wijchartDataObj",H),$.wijraphael.addClass($(q.node),S.bubbleSymbol)),$(B.node).data("wijchartDataObj",H),x.dataPoints=x.dataPoints||{},x.pointXs=x.pointXs||[],A=$.round(j,2),x.dataPoints[A.toString()]||(x.dataPoints[A.toString()]=[],x.pointXs.push(A)),x.dataPoints[A.toString()].push(H),U=B.clone(),$.browser.msie&&parseInt($.browser.version)<9?U.attr({opacity:.01,fill:"white","stroke-width":0,"fill-opacity":.01}):U.attr({opacity:.01,fill:"white","fill-opacity":.01}),$(U.node).data("owner",$(B.node)),$.wijraphael.addClass($(U.node),S.canvasObject+" "+S.bubbleElement+" "+S.bubbleTracker),B.tracker=U,w.trackers.push(U),w.bubbles.push(B),w.fields.bubbles=w.bubbles,D={x:j,y:F,r:R},T.visible&&w.getLabelVisible(_,a)&&(T.position==="outside"&&w.applyLabelCompass(D,f),C=w.paintDefaultChartLabel(D,f),C.hide(),$(C.node).data("wijchartDataObj",H),$.wijraphael.addClass($(C.node),S.bubbleLabel)),P={bubble:B,dcl:C,symbol:q},w.bubbleInfos.push(P),y.push(P),e.visible===!1&&(B.hide(),C&&C.hide(),U.hide(),q&&q.hide())}),w.fields.bubbleInfos=w.bubbleInfos,w.seriesEles.push(y)},e.prototype.paintBubbles=function(){var e=this,t=e.options,n=t.xAxisInfo,r=t.yAxisInfo;$.each(e.seriesList,function(t,i){var s=e.seriesStyles[t],o=e.seriesHoverStyles[t];e.paintbubble(i,s,o,n,r,e.width,e.height,e.startLocation)})},e.prototype.bindLiveEvents=function(e,t,n,r,i,s,o,u){var a=this.options,f=a.wijCSS,l={mousedown:function(n){if(u)return;var r=$(n.target),i;r.data("owner")&&(r=r.data("owner")),i=r.data("wijchartDataObj"),t.call(e,n,i)},mouseup:function(t){if(u)return;var r=$(t.target),i;r.data("owner")&&(r=r.data("owner")),i=r.data("wijchartDataObj"),n.call(e,t,i)},mouseover:function(t){if(u)return;var n=$(t.target),i;n.data("owner")&&(n=n.data("owner")),i=n.data("wijchartDataObj"),r.call(e,t,i)},mouseout:function(t){if(u)return;var n=$(t.target),r,s;n.data("owner")&&(n=n.data("owner")),r=n.data("wijchartDataObj"),s=r.bubble;if(r.symbol)return;r.hoverStyle?(r.hoverStyle["stroke-width"]&&!r.style["stroke-width"]&&s.attr("stroke-width",""),s.attr(r.style),r.style.opacity&&s.attr("opacity",r.style.opacity)):s&&s.attr({opacity:"1"}),i.call(e,t,r)},mousemove:function(t){if(u)return;var n=$(t.target),r,i;n.data("owner")&&(n=n.data("owner")),r=n.data("wijchartDataObj"),i=r.bubble,r.hoverStyle?i.attr(r.hoverStyle):i&&i.attr({opacity:"0.8"}),s.call(e,t,r)},click:function(t){if(u)return;var n=$(t.target),r;n.data("owner")&&(n=n.data("owner")),r=n.data("wijchartDataObj"),o.call(e,t,r)}};$.each(["click","mouseover","mouseout","mousemove","mousedown","mouseup"],function(t,n){$("."+f.bubbleTracker,e).on(n+".wijbubblechart",l[n])})},e.prototype.render=function(){var e=this.options,t=e.mouseDown,n=e.mouseUp,r=e.mouseOver,i=e.mouseOut,s=e.mouseMove,o=e.click,u=e.disabled;this.paintBubbles(),this.fields.seriesEles=this.seriesEles,this.playAnimation(),this.trackers.toFront(),this.fields.trackers=this.trackers,this.bindLiveEvents(this.element,t,n,r,i,s,o,u),this.element.data("fields",this.fields)},e}();e.BubbleChartRender=o})(wijmo||(wijmo={}));