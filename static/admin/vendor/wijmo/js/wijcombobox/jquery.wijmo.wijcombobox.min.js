var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";var t=jQuery,n="wijcombobox",r="wijmo-wijcombobox-input",i=function(e){function n(){e.apply(this,arguments)}return __extends(n,e),n.prototype._create=function(){var e=this,n;e.selectedItem=null,e.selectedItems=[],n=document.activeElement,window.wijmoApplyWijTouchUtilEvents&&(t=window.wijmoApplyWijTouchUtilEvents(t)),e._initInnerData(),e._createDOMElements(),e._bindInputEvents(),e._initDropDownList(),e.repaint(),e._checkSelectIndex(),e._usingRemoteData()&&e.options.data&&(e.originalDataSourceLoaded=e.options.data.loaded),n===e._input[0]&&e.options.isEditable&&t(function(){e._input.focus()}),e.element.is(":hidden")&&e.element.wijAddVisibilityObserver&&e.element.wijAddVisibilityObserver(function(){e.repaint(),e.element.wijRemoveVisibilityObserver&&e.element.wijRemoveVisibilityObserver()},"wijcombobox")},n.prototype._initInnerData=function(){var e=this,t=e.options,n;t.datasource!==null&&(n=e._isBind(),n?e.innerData=e._getMappingItems():e.innerData=t.data),e.listHasCreated=!1},n.prototype._checkSelectIndex=function(){var e=this,n,r=e.options,i=e.innerData;r.selectedIndex===-1&&r.selectedValue&&t.each(i,function(t,n){if(i[t].value===r.selectedValue)return e.options.selectedIndex=t,!1}),n=r.selectedIndex,!e._usingRemoteData()&&(n>=0||t.isArray(n))&&e.search(null,"checkindex"),r.selectedIndex===-1&&r.text&&(!r.forceSelectionText||r.forceSelectionText&&e._checkTextInItems(r.text)!==-1)&&e._input.val(r.text)},n.prototype.repaint=function(){var e=this.options,t=this;if(t.element.is(":visible")||t._comboDiv||t._select!==undefined&&t._input.is(":visible")){t._showTrigger();if(e.disabledState){var n=e.disabled;t.disable(),e.disabled=n}return e.disabled&&t.disable(),!0}return!1},n.prototype._bindInputEvents=function(){var e=this,n=this.options.wijCSS,r,i,s,o,u;r=e._input,i=e.options,r.bind("keydown.wijcombobox",function(n){if(i.disabledState===!0||i.disabled)return;s=n.keyCode,o=e._getKeyCodeEnum();switch(s){case o.UP:e._move("previous",n),n.preventDefault();break;case o.DOWN:e._move("next",n),n.preventDefault();break;case o.ENTER:e.menu.active&&(n.preventDefault(),i.selectionMode==="multiple"&&e.menu&&e.menu.items&&e.menu.items.length===1&&t.each(e.selectedItems,function(t,n){n!==e.menu.items[0]&&(n.selected=!1)}),e.menu.select(n)),n.preventDefault();break;case o.TAB:r.trigger("wijcomboblur");if(!e.menu.active||i.selectionMode==="multiple"&&o.TAB===s)return;e.menu.select(n);var u=r.val().length;e._selectText(u,u,r);break;case o.ESCAPE:e.close(n,undefined);break;case o.LEFT:case o.RIGHT:case o.SHIFT:case 16:case 17:case o.CONTROL:case o.HOME:case o.END:case o.DELETE:case o.PAGE_UP:case o.PAGE_DOWN:break;case 18:r.trigger("wijcomboblur");break;default:window.clearTimeout(e.searching),i.isEditable===!1&&(e._cacheKey===undefined&&(e._cacheKey=""),e._cacheKey+=String.fromCharCode(s)),e.searching=window.setTimeout(function(){var t;i.isEditable===!1?(t=e._cacheKey,e._cacheKey=undefined):t=r.val(),e.search(t,n)},i.delay)}}).bind("wijcomboblur.wijcombobox",function(t){window.clearTimeout(e.searching),e._addInputFocus(!1,n.stateFocus),e.closing=window.setTimeout(function(){e.close(t,!0)},150)}).bind("focus.wijcombobox",function(){e._addInputFocus(!0,n.stateFocus)}).bind("blur.wijcombobox",function(){e.menu.element.is(":visible")||r.trigger("wijcomboblur"),u=r.val(),i.text!==u&&e._trigger("textChanged",null,{oldText:i.text,newText:u}),e._change()})},n.prototype._addInputFocus=function(e,t){var n=this,r,i,s;r=n._input.parent(),i=e?"addClass":"removeClass",s=n._triggerArrow,r[i](t),s!==undefined&&s[i](t)},n.prototype._renderColumnsHeader=function(e){var n=this,r=t("<ul class='wijmo-wijcombobox-rowheader'></ul>");t.each(this.options.columns,function(e,i){var s=t("<li class='wijmo-wijcombobox-cell "+n.options.wijCSS.header+"'></li>");s.html(i.name),i.width!==undefined&&s.width(i.width),s.appendTo(r)}),e.append(r)},n.prototype._hasSameValueText=function(e,t){return e.label===t.label&&e.value===t.value},n.prototype._initDropDownList=function(){var e=this,n,r,i,s,o,u=this.options.wijCSS,a=parseInt(e._input.css("zIndex"),10),f;n=e.element[0].ownerDocument,isNaN(a)&&(a=0),e._comboDiv?r=e._oriList:r=t("<div class='wijmo-wijcombobox-list'></div>"),i=e.options,i.columns.length>0&&(r.addClass("wijmo-wijcombobox-multicolumn"),s=t("<div class='wijmo-wijsuperpanel-header "+u.stateDefault+"'></div>"),e._renderColumnsHeader(s),r.append(s)),o={keepHightlightOnMouseLeave:!0,selectionMode:i.selectionMode,addHoverItemClass:i.columns.length===0,focus:function(t,n){var r=n;i.selectOnItemFocus&&e.menu.select(null,{notCloseAfterSelected:!0}),i.columns.length>0&&r.element&&(r.element.prev().addClass("wijmo-wijcombobox-active-prev"),r.element.find(".wijmo-wijcombobox-row>.wijmo-wijcombobox-cell").addClass(u.stateHover))},selected:function(n,r){window.clearTimeout(e.closing);var s=i.selectionMode,o,u,a=!1,f,l,c;o=r.item;if(e._trigger("select",n,o))if(s==="single"){if(!e._usingRemoteData()){u=t.inArray(o,e.items),u===undefined&&(u=r.selectedIndex);if(u!==i.selectedIndex){l=i.selectedIndex,c=e.selectedItem,a=e._triggerSelectedIndexChanging(c,o,l,u);if(a)return;e._setInputText(o.label),c!==null&&(c.selected=!1),e.selectedItem=o,i.selectedIndex=u,i.selectedValue=e.selectedItem.value,e._select!==undefined&&(e._select[0].selectedIndex=i.selectedIndex,e._select.trigger("change")),i.inputTextInDropDownList=!0,i.text=e._input.val(),c&&c.element&&c.element.removeClass("wijmo-wijcombobox-selecteditem"),e._trigger("changed",null,{oldItem:c,selectedItem:e.selectedItem,newIndex:i.selectedIndex,oldIndex:l}),e._triggerSelectedIndexChanged(c,e.selectedItem,l,i.selectedIndex)}else e.selectedItem&&e._input.val()!==e.selectedItem.label&&(r.data===undefined||!r.data.notCloseAfterSelected)&&e._input.val(o.label)}else if(e.selectedItem===null||!e._hasSameValueText(o,e.selectedItem)){c=e.selectedItem,l=i.selectedIndex,a=e._triggerSelectedIndexChanging(c,o,l,r.selectedIndex);if(a)return;e._setInputText(o.label),i.text=e._input.val(),e.selectedItem=o,u=t.inArray(o,e.items),u===undefined&&(u=r.selectedIndex),u!==i.selectedIndex&&(i.selectedIndex=u,i.selectedValue=e.selectedItem.value),i.inputTextInDropDownList=!0,e._trigger("changed",null,{selectedItem:o}),e._triggerSelectedIndexChanged(c,o,l,i.selectedIndex)}}else if(!e._usingRemoteData()){a=e._triggerSelectedIndexChanging(null,o,l,r.selectedIndex);if(a)return;e.selectedItems=r.selectedItems,e._selectedItemsToInputVal(e.selectedItems),i.inputTextInDropDownList=!0,i.selectedIndex=r.selectedIndex,e._trigger("changed",null,{selectedItem:o,selectedItems:e.selectedItems}),e._triggerSelectedIndexChanged(null,o,null,i.selectedIndex)}(r.data===undefined||!r.data.notCloseAfterSelected)&&s==="single"&&(e.close(n),e._input.focus())},blur:function(e,t){var n=t.element;i.columns.length>0&&n&&(n.find(".wijmo-wijcombobox-row>.wijmo-wijcombobox-cell").removeClass(u.stateHover),n.prev().removeClass("wijmo-wijcombobox-active-prev"))},itemRendering:function(e,t){var n=t,r;r="",n.isSeparator&&(r+=" wijmo-wijcombobox-separator"),n.selected&&(r+=" wijmo-wijcombobox-selecteditem"),r.length>0&&n.element.addClass(r)},itemRendered:function(e,n){var r=n,s,o;if(r.cells===undefined)return;s=r.element,s.empty(),o=t("<ul class='wijmo-wijcombobox-row'></ul>"),t.each(r.cells,function(e,n){var r=t("<li class='wijmo-wijcombobox-cell "+u.stateDefault+"'></li>");i.columns&&i.columns.length>e&&typeof i.columns[e].width!="undefined"&&r.width(i.columns[e].width),r.append(n),r.attr("title",n),o.append(r)}),s.append(o)},superPanelOptions:{resized:function(t){var n=e.menu,r=n.element;i.dropdownWidth=r.outerWidth(),i.dropdownHeight=r.outerHeight(),e._positionList(),e.menu.refreshSuperPanel()}}},o=t.extend(!0,o,i.listOptions),f=i.ensureDropDownOnBody?t("body"):e._comboElement,e.menu=r.appendTo(f,n).wijlist(o).css({zIndex:a+1,top:0,left:0}).hide().data("wijmoWijlist"),e._createDropDownList(),e._menuUL=e.menu.ul},n.prototype._setInputText=function(e,t){var n=this,r=n._input.val();n._input.val(e),r!==e&&n._trigger("textChanged",null,{oldText:r,newText:e})},n.prototype._triggerSelectedIndexChanged=function(e,n,r,i){var s=this.options,o;s.selectionMode==="single"?this._trigger("selectedIndexChanged",null,{oldItem:e,selectedItem:n,newIndex:i,oldIndex:r}):(o=t.inArray(n,this.items),this._trigger("selectedIndexChanged",null,{selectedItem:n,selectedIndex:o,selectedItems:this.selectedItems}))},n.prototype._triggerSelectedIndexChanging=function(e,n,r,i){var s=this.options,o,u,a=!0;return s.selectionMode==="single"?(u={oldItem:e,selectedItem:n,newIndex:i,oldIndex:r},a=this._trigger("selectedIndexChanging",null,u)):(o=t.inArray(n,this.items),u={selectedItem:n,selectedIndex:o,selectedItems:this.selectedItems},a=this._trigger("selectedIndexChanging",null,u)),a||(n.selected=!1,n.element&&n.element.removeClass("wijmo-wijcombobox-selecteditem")),!a},n.prototype._createDropDownList=function(e){var n=this,r,i=n.options,s=e;s||(s=n.innerData),s===null?r=null:r=t.isArray(s)?s:s.items,n._comboDiv?!n.listHasCreated&&r&&r.length>0&&(n.menu.setTemplateItems(i.data),n.menu.renderList(),n.listHasCreated=!0):!n.listHasCreated&&r&&r.length>0&&(n.menu.setItems(r),n.menu.renderList(),n.listHasCreated=!0)},n.prototype._getSelectedItemsText=function(e){var n="",r,i;return r=this,i=r.options.multipleSelectionSeparator,r.selectedItems=e,t.each(e,function(e,t){t&&(n+=t.label+i)}),n.length>0&&(n=n.substr(0,n.lastIndexOf(i))),n},n.prototype._selectedItemsToInputVal=function(e){var t=this;t._setInputText(t._getSelectedItemsText(e)),t.options.text=t._input.val()},n.prototype._createDOMElements=function(){var e=this,n,i=this.options.wijCSS,s,o,u;u=t("<div class='wijmo-wijcombobox-wrapper "+i.stateDefault+" "+i.cornerAll+"'>"+"</div>"),s=e.element,s.is("select")?(n=t("<div role='combobox' class='wijmo-wijcombobox "+i.widget+" "+i.helperClearFix+"'>"+"</div>"),n.append(u),e._comboElement=n,e._select=s,s.addClass(i.widget),o=e._input=t("<input role='textbox' aria-autocomplete='list' aria-haspopup='true' />").insertAfter(s),e.options.data||(e.options.data=e._convertSelectOptions(),e._initInnerData())):s.is("div")&&t(s.children()[0]).is("input[type='text']")&&t(s.children()[1]).is("div")?(e._comboElement=e._comboDiv=n=s,e._oriList=t(s.children()[1]),o=e._input=t(s.children()[0]),u.prependTo(n).append(o),s.addClass("wijmo-wijcombobox "+i.widget+" "+i.helperClearFix),s.attr("role","combobox")):(n=t("<div role='combobox' class='wijmo-wijcombobox "+i.widget+" "+i.helperClearFix+"'>"+"</div>"),n.append(u),e._comboElement=n,o=e._input=s),e._comboDiv||(n.insertBefore(o),e.element.is(":visible")&&o.width(o.width()),n.children(".wijmo-wijcombobox-wrapper").append(o)),s.attr("title")&&e._comboElement.attr("title",s.attr("title")),o.attr({autocomplete:"off",role:"textbox","aria-wijcombobox":"list","aria-haspopup":"true"}).addClass(r),e._oldWidth=s.css("width"),e.options.isEditable===!1&&(o.attr("readonly","readonly"),u.bind("click",function(){if(e.options.disabledState===!0||e.options.disabled)return;e._triggerClick()})),(e.options.disabledState===!0||e.options.disabled===!0)&&o.attr("disabled","disabled"),n.bind("mouseenter",function(){if(e.options.disabledState===!0||e.options.disabled)return;e._addInputFocus(!0,i.stateHover)}).bind("mouseleave",function(){e._addInputFocus(!1,i.stateHover)})},n.prototype._convertSelectOptions=function(){var e=[],n,r;return n=this,r=n._select.get(0).options,t.each(r,function(t,n){e.push({label:n.text,value:n.value})}),n.options.selectedIndex===-1&&n.options.selectedValue===null&&n.options.text===null&&(n.options.selectedIndex=n._select[0].selectedIndex),e},n.prototype.getComboElement=function(){return this._comboElement},n.prototype._showTrigger=function(){var e=this,n,r,i,s,o=this.options.wijCSS,u,a=0,f,l,c,h,p,d,v="<label class='wijmo-wijcombobox-label "+o.content+"'></label>",m="<div class='wijmo-wijcombobox-trigger "+o.stateDefault+" "+o.cornerRight+"'>"+"<span class='"+o.icon+" "+o.iconArrowDown+"'></span>"+"</div>";n=e.options,r=e._input,i=r.parent(),s=e._comboElement,f=e._triggerArrow,l=e._label,e._select!==undefined&&(t.browser.msie?(u=e._select.clone(),e._select.after(u),a=u.width(),u.remove()):a=e._select.width(),r.width(a+(e.innerData.length>20?n.selectElementWidthFix:0)),e._select.hide()),r.css("margin-left",""),r.css("margin-right",""),s.width(i[0].offsetWidth),n.labelText!==null?(l=e._label=t(v),i.append(l.html(n.labelText))):l!==undefined&&(l.remove(),e._label=undefined),n.showTrigger?(r.removeClass(o.cornerAll),f===undefined&&(f=e._triggerArrow=t(m),s.append(f),f.bind("mouseover.triggerevent",e,function(e){if(n.disabledState===!0||n.disabled)return;var r=t(e.currentTarget);r.addClass(o.stateHover)}).bind("mousedown.triggerevent",e,function(e){if(n.disabledState===!0||n.disabled)return;var r=t(e.currentTarget);r.addClass(o.stateActive)}).bind("mouseup.triggerevent",e,function(e){var n=t(e.currentTarget);n.removeClass(o.stateActive)}).bind("click.triggerevent",e,function(){if(n.disabledState===!0||n.disabled)return;e._triggerClick()})),n.triggerPosition==="right"?(f.css({left:"",right:"0px"}),f.removeClass(o.cornerLeft),f.addClass(o.cornerRight)):(f.css({right:"",left:"0px"}),f.removeClass(o.cornerRight),f.addClass(o.cornerLeft)),f.setOutHeight(s.innerHeight()),c=f.find("span"),c.css("margin-left",(f.innerWidth()-c[0].offsetWidth)/2),c.css("margin-top",(f.innerHeight()-c[0].offsetHeight)/2)):(f!==undefined&&(f.unbind(".triggerevent"),f.remove(),e._triggerArrow=undefined),r.removeClass(o.cornerLeft),r.removeClass(o.cornerRight),r.addClass(o.cornerAll)),h=p=d=0,l!==undefined&&(p+=l[0].offsetWidth),f!==undefined&&(d=f[0].offsetWidth),h=p+d,r.setOutWidth(i.innerWidth()-h),h=h===0?"":h,n.triggerPosition==="right"?(r.css("margin-left",""),r.css("margin-right",h),l!==undefined&&(l.css("left",""),l.css("right",d))):(r.css("margin-right",""),r.css("margin-left",h),l!==undefined&&(l.css("right",""),l.css("left",d)))},n.prototype._triggerClick=function(e){var t=this,n="";window.clearTimeout(t.closing),t.menu.element.is(":visible")?t.close():(t._usingRemoteData()&&(n=t._input.val()),t.search(n,e))},n.prototype.destroy=function(){var e=this,n=this.options.wijCSS,i=e.element;e.options.isEditable===!1&&i.removeAttr("readonly"),e._select!==undefined?(e._select.removeClass(n.widget),e._select.show(),e._input.remove()):e._comboDiv?(e._comboDiv.removeClass("wijmo-wijcombobox "+n.widget+" "+n.helperClearFix),e._comboDiv.removeAttr("role"),e._input.insertBefore(e._comboDiv),e._comboDiv.children(".wijmo-wijcombobox-wrapper").remove()):(i.css("width",e._oldWidth),i.removeClass(r),i.removeAttr("autocomplete").removeAttr("role").removeAttr("aria-wijcombobox").removeAttr("aria-haspopup"),i.insertBefore(e._comboElement),i.css("padding","")),e._comboElement.remove(),e.menu.destroy(),e.menu.element.remove(),t.wijmo.widget.prototype.destroy.call(e)},n.prototype._setOption=function(e,n){var r=this,i,s,o,u,a,f=this.options.wijCSS,l=r._label,c,h,p,d=null,v=0,m="<label class='wijmo-wijcombobox-label "+f.content+"'></label>",g=r.options;i=r._comboElement,s=r.element,u=s.parent(),h=g.selectedIndex,r._triggerArrow&&(v=r._triggerArrow.outerWidth()),t.wijmo.widget.prototype._setOption.apply(r,arguments);if(e==="disabled")n?(i.addClass("wijmo-wijcombobox-disabled "+f.stateDisabled),r._input.attr("disabled","disabled"),r._comboDiv&&r._input.addClass("wijmo-wijcombobox-disabled "+f.stateDisabled).attr("disabled","disabled"),r._triggerArrow&&r._triggerArrow.unbind("click.triggerevent"),r.close()):(i.removeClass("wijmo-wijcombobox-disabled "+f.stateDisabled),r._input.removeAttr("disabled"),r._comboDiv&&r._input.removeClass("wijmo-wijcombobox-disabled "+f.stateDisabled).removeAttr("disabled"),r._triggerArrow&&r._triggerArrow.bind("click.triggerevent",r,function(){if(g.disabledState===!0)return;r._triggerClick()}));else if(e==="labelText")g.labelText!==null?(l=r._label=t(m),r._input.parent().append(l.html(g.labelText)),r._triggerArrow!==undefined&&(c=r._triggerArrow[0].offsetWidth),g.triggerPosition==="right"?l!==undefined&&(l.css("left",""),l.css("right",c)):l!==undefined&&(l.css("right",""),l.css("left",c)),r.repaint()):l!==undefined&&(l.remove(),r._label=undefined);else if(e==="showTrigger")r._showTrigger(),!g.showTrigger&&r.element.is("select")&&s.width(s.width()+v);else if(e==="triggerPosition")s.width(s.width()+v),r._showTrigger();else if(e==="selectionMode")r.menu._setOption("selectionMode",n);else if(e==="isEditable")n?(r._input.removeAttr("readonly"),t(".wijmo-wijcombobox-wrapper",r._comboElement[0]).bind("click",function(){r._triggerClick()})):(r._input.attr("readonly","readonly"),t(".wijmo-wijcombobox-wrapper",r._comboElement[0]).unbind("click"));else if(e==="data"||e==="dataSource"){r._initInnerData(),r._setSelectedIndex(g.selectedIndex);if(t.isArray(r.innerData))r.listHasCreated=!1,r._createDropDownList();else try{r.innerData.loaded=function(e,n){e===null?r.items=null:r.items=t.isArray(e)?e:e.items,r.listHasCreated=!1,r._createDropDownList()},r.innerData.load(null)}catch(y){}g.selectedIndex!==-1&&(d=o?o[h]:null,o=r.innerData,r._trigger("changed",null,{oldItem:d,selectedItem:r.selectedItem,newIndex:g.selectedIndex,oldIndex:h}),r._triggerSelectedIndexChanged(d,r.selectedItem,h,g.selectedIndex)),r._keypress=!1}else if(e==="selectedIndex"){if(n===h)return;r.selectedItem=null,r.innerData===null?o=null:o=t.isArray(r.innerData)?r.innerData:r.innerData.items,d=o?o[h]:null;if(n>-1){o&&o[n]!==null&&(p=o[n]),a=r._triggerSelectedIndexChanging(d,p,h,n);if(a){g.selectedIndex=h;return}h!==null&&h!==-1&&h!==undefined&&d&&(d.selected=!1,d.element&&d.element.removeClass("wijmo-wijcombobox-selecteditem")),o&&o[n]!==null&&(r.selectedItem=o[n],r.selectedItem&&(r.selectedItem.selected=!0,r._setInputText(r.selectedItem.label),g.selectedValue=r.selectedItem.value,g.inputTextInDropDownList=!0,g.text=r._input.val()))}else if(n<=-1||!n){a=r._triggerSelectedIndexChanging(d,null,h,n);if(a){g.selectedIndex=h;return}g.inputTextInDropDownList=!1,r._clearSelection()}r._trigger("changed",null,{oldItem:d,selectedItem:r.selectedItem,newIndex:g.selectedIndex,oldIndex:h}),r._triggerSelectedIndexChanged(d,r.selectedItem,h,g.selectedIndex)}else if(e==="selectedValue")n?(r.selectedItem&&r.selectedItem.selected!==undefined&&(r.selectedItem.selected=!1),o=r.items,o||(o=r.innerData),t.each(o,function(e,t){if(o[e].value===n)return r.selectedItem=o[e],r.selectedItem.selected=!0,r._setInputText(r.selectedItem.label),r.options.selectedIndex=e,g.inputTextInDropDownList=!0,g.text=r._input.val(),!1})):(g.inputTextInDropDownList=!1,r._clearSelection());else if(e==="text"){if(g.forceSelectionText&&r._checkTextInItems(n)===-1)return;r._setInputText(n)}},n.prototype._setSelectedIndex=function(e){var n=this,r=n.options;if(e===null||e===undefined)return;e===-1?(n.selectedItem=null,r.selectedIndex=-1,r.selectedValue=null,r.text?n._input.val(r.text):n._input.val("")):n.innerData&&n.innerData[e]!==null&&n.innerData[e]!==undefined?(n.innerData[e].selected=!0,n._input.val(n.innerData[e].label),n.selectedItem=n.innerData[e]):n.innerData&&t.isArray(n.innerData)&&e>n.innerData.length-1&&(r.selectedIndex=-1,n._input.val("")),r.text=n._input.val()},n.prototype.search=function(e,n){var r=this,i,s,o,u;i=r.options,s=r.innerData,window.clearTimeout(r.closing),o={value:e,e:n,self:r};if(s!==null||r._comboDiv){u=r._isBind();if(n!=="checkindex"&&r._trigger("search",n,{datasrc:s,term:o})===!1)return;if(t.isArray(s)||u||r._comboDiv)r._hideShowArrow(!1),r._onListLoaded(s,o);else{if(!u&&t.isArray(i.dataSource))return;if(r._usingRemoteData()&&n!==undefined&&e.length<i.minLength)return;r._hideShowArrow(!1),s.loaded=function(e,t){r.listHasCreated=!1,r._createDropDownList(e),r._onListLoaded(e,t),r.originalDataSourceLoaded&&r.originalDataSourceLoaded(e,t)},s.load(o)}}},n.prototype.getSelectedItems=function(){var e=this.options;return e.selectionMode==="single"?this.selectedItem:this.selectedItems},n.prototype._isBind=function(){var e=this.options,t=e.data;return t!==null&&t.label&&t.label.bind?!0:!1},n.prototype._getMappingItems=function(){var e=this.options,n=e.dataSource,r=e.data,i,s,o;return!n||!r?null:!r.label||!r.label.bind||!r.value||!r.value.bind?null:(s=r.label.bind,o=r.value.bind,n&&n.length!==0?(i=[],t.each(n,function(e,t){i.push({label:t[s],value:t[o]})}),i):null)},n.prototype._clearSelection=function(){var e=this,n=e.options;n.selectionMode==="single"?(e.selectedItem!==null&&(e.selectedItem.selected=!1),e.selectedItem=null):e.selectedItems&&(t.each(e.selectedItems,function(e,t){t.selected&&(t.selected=!1)}),e.selectedItem=null,e.selectedItems=null),n.selectedValue=null,e._setInputText(""),n.text=e._input.val()},n.prototype._usingRemoteData=function(){var e=this.options.data,n=!1;return!t.isArray(e)&&e!==null&&e.proxy&&(n=!0),n},n.prototype._hideShowArrow=function(e){var t=this,n,r;n=t.element,r=t._triggerArrow,r!==undefined&&r[e?"show":"hide"](),n[e?"removeClass":"addClass"]("wijmo-wijcombobox-loading")},n.prototype._onListLoaded=function(e,n){var r=n.self,i,s,o=this.options.wijCSS,u,a,f,l;i=r._input,s=r.options,u=n.value,e===null?a=null:a=t.isArray(e)?e:e.items,r.items=a;if(n.e==="checkindex"){f=s.selectedIndex,s.selectionMode==="multiple"&&t.isArray(f)?(t.each(f,function(e,t){var n=a[t];n.selected=!0,r.selectedItems.push(n)}),r._selectedItemsToInputVal(r.selectedItems)):(a[f].selected=!0,r.selectedItem=a[f],i.val(r.selectedItem.label)),r._hideShowArrow(!0);return}!r._usingRemoteData()&&a?l=a:(r._topHit=null,l=a),l&&l.length>0||r._comboDiv?(r._openlist(l,n,u),r._addInputFocus(!0,o.stateFocus)):r.close(null,!0),r._hideShowArrow(!0)},n.prototype.close=function(e,n){var r=this,i,s=this.options.wijCSS,o,u;i=r.menu,r._dropDownHeight=i.element.outerHeight(),r._dropDownWidth=i.element.outerWidth(),window.clearTimeout(r.closing),i.element.is(":visible")&&!i.element.is(":animated")&&!i.element.parent().is(":animated")&&(r._trigger("close",e),i.deactivate(),o=r.options.hidingAnimation,o&&(o.effect==="size"||o.animated==="size")&&(o.options=t.extend({to:{width:0,height:0}},o.options)),u=i.element.attr("style"),n!==!0&&o?i.element.hide(o.effect||o.animated,o.options,o.speed||o.duration,function(){i.element.removeAttr("style").attr("style",u).hide(),o.callback&&o.callback.apply(this,arguments)}):i.element.hide(),r._addInputFocus(!1,s.stateFocus),t(document).unbind("mouseup",r.closeOnClick))},n.prototype._getKeyCodeEnum=function(){if(t.ui&&t.ui.keyCode)return t.ui.keyCode;if(t.mobile&&t.mobile.keyCode)return t.mobile.keyCode;throw"keyCode object is not found"},n.prototype._change=function(){var e=this,t,n,r,i,s,o,u,a,f,l=-1;t=e.options,n=t.forceSelectionText,r=t.selectionMode,i=e._input,s=i.val(),o=e.selectedItem,u=e.selectedItems,a=t.selectedIndex?t.selectedIndex:-1,f=e.innerData,n?r==="single"&&(o!==null?o.label!==s&&i.val(o.label):i.val("")):r==="single"&&(!o&&s!==""||o!==null&&o.label!==s)&&(e.selectedItem!==null&&(e.selectedItem.selected=!1),l=e._checkTextInItems(s),l===-1?(e.selectedItem=null,t.selectedIndex=-1,t.selectedValue=null,t.inputTextInDropDownList=!1):f&&(e.selectedItem=f[l],t.selectedIndex=l,t.selectedValue=e.selectedItem.value,t.inputTextInDropDownList=!0),t.text=e._input.val(),e._trigger("changed",null,{oldItem:o,selectedItem:e.selectedItem,newIndex:t.selectedIndex,oldIndex:a}),a!==l&&e._triggerSelectedIndexChanged(o,e.selectedItem,a,t.selectedIndex));if(r==="multiple"){if(!e.selectedItems||e.selectedItems.length===0)u=[o];e._selectedItemsToInputVal(u)}},n.prototype._checkTextInItems=function(e){var n=this,r=-1,i=n.innerData;return e&&t.each(i,function(t,n){if(i[t]&&i[t].label&&i[t].label===e)return r=t,!1}),r},n.prototype._openlist=function(e,n,r){var i=n.self,s=n.e,o,u,a,f,l,c=2,h=0,p,d,v,m,g,y,b=t.trim(i._input.val()).length,w=i._getKeyCodeEnum(),E,S=!1;o=i._keypress=!!s,f=i.options,a=i.menu.element,t.ui?a.zIndex(i.element.zIndex()+100):(E=parseInt(i.element.css("zIndex"),10),isNaN(E)&&(E=0),a.css("zIndex",E+100)),i.listHasCreated||i._createDropDownList();if(!i._usingRemoteData()&&r!==null&&r!==undefined){S=i._keypress&&f.isEditable&&f.columns.length===0&&f.highlightMatching&&b>0,s&&s.keyCode===t.ui.keyCode.DOWN&&r.length===0&&b>0?i._topHit=i.menu.filterItems(i._input.val(),!1,S):i._topHit=i.menu.filterItems(r,f.autoFilter,S);if(i._topHit===null&&i.innerData&&t("li[wijhidden]",i.menu.element).length===i.innerData.length)return i.close(null,!0),!1}return i.menu.element.show(),f.dropdownWidth==="auto"?u=i._comboElement.outerWidth():u=f.dropdownWidth,l=a.css("padding"),a.css("padding","0px"),a.setOutWidth(u),a.css("padding",l),p=f.dropdownHeight,a.children(".wijmo-wijsuperpanel-header")&&(h=a.children(".wijmo-wijsuperpanel-header").outerHeight()||0),v=Math.min(i._menuUL.outerHeight()+c+h,p),a.setOutHeight(v),i.menu.refreshSuperPanel(),i._positionList(),!o&&i.selectedItem!==undefined&&i.menu.activate(null,i.selectedItem,!0),o&&s.keyCode!==t.ui.keyCode.BACKSPACE?f.isEditable?i._runAutoComplete():i.menu.activate(null,i._topHit,!0):(m=i.options.showingAnimation,f.showingAnimation!==null&&(s===undefined||s.keyCode!==t.ui.keyCode.BACKSPACE)&&(i.menu.element.hide(),y={from:{width:0,height:0},to:{width:i._dropDownWidth||a.outerWidth(),height:i._dropDownHeight||a.outerHeight()}},m&&(m.effect==="size"||m.animated==="size")&&(m.options=t.extend(y,m.options)),g=a.attr("style"),a.show(m.effect||m.animated,m.options,m.speed||m.duration,function(){a.removeAttr("style").attr("style",g).show(),m.callback&&m.callback.apply(this,arguments),t.browser.msie&&a.css("filter","")}))),i.hasOwnProperty("closeOnClick")||(d=i.closeOnClick,i.closeOnClick=function(e){return d(e)}),i._trigger("open"),t(document).bind("mouseup",i,i.closeOnClick),!0},n.prototype.closeOnClick=function(e){var n=e.data,r=n.options.wijCSS,i,s=e.target;!t.contains(n._comboElement[0],s)&&!t.contains(n.menu.element[0],s)&&(n._isMobile?(i=n.menu.element.offset(),(e.pageX<i.left||e.pageX>i.left+n.menu.element.width()||e.pageY<i.top||e.pageY>i.top+n.menu.element.height())&&n.close()):n.close(),t(".wijmo-wijcombobox-wrapper",n._comboElement[0]).removeClass(r.stateHover).removeClass(r.stateFocus),t(".wijmo-wijcombobox-trigger",n._comboElement[0]).removeClass(r.stateHover).removeClass(r.stateFocus))},n.prototype._positionList=function(){var e=this,n,r;n=e.options.dropDownListPosition,r={my:"left top",at:"left bottom",of:e._comboElement,collision:"none"},r=t.extend(r,n),e.menu.element.position(r)},n.prototype._runAutoComplete=function(){var e=this,t,n,r,i,s,o;t=e._input,n=e._topHit;if(!e.options.autoComplete||n===null||n===undefined)return;e.menu.activate(null,n,!0),r=t.val(),i=n.label,t.val(i),s=r.length,o=i.length,e._selectText(s,o,t)},n.prototype._selectText=function(e,t,n){var r=n.val(),i=n.get(0),s;r.length>0&&(i.setSelectionRange!==undefined?i.setSelectionRange(e,t):i.createTextRange!==undefined&&(s=i.createTextRange(),s.moveStart("character",e),s.moveEnd("character",t-r.length),s.select()))},n.prototype._move=function(e,t){if(!this.menu.element.is(":visible")){this.search("",t);return}if(this.menu.first()&&/^previous/.test(e)||this.menu.last()&&/^next/.test(e))return;this.menu[e](t)},n.prototype._escapeRegex=function(e){return e===undefined?e:e.replace(/([\^\$\(\)\[\]\{\}\*\.\+\?\|\\])/gi,"\\$1")},n.prototype._filter=function(e,n){var r=this._escapeRegex(n),i,s=null;return e?(i=new RegExp(r,"i"),t.each(e,function(e,t){if(r===undefined||r.length===0){t.match=!0;return}var n=i.exec(t.label);n===null?t.match=!1:(s===null&&n.index===0&&(s=t),t.match=n.index>=0)}),this._topHit=s,e):null},n}(e.wijmoWidget);e.wijcombobox=i,i.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,{initSelector:":jqmData(role='wijcombobox')",dataSource:null,data:null,labelText:null,minLength:4,delay:300,showingAnimation:null,hidingAnimation:null,showTrigger:!0,triggerPosition:"right",dropdownHeight:300,dropdownWidth:"auto",selectOnItemFocus:!1,autoFilter:!0,autoComplete:!0,highlightMatching:!0,dropDownListPosition:{},columns:[],selectionMode:"single",multipleSelectionSeparator:",",forceSelectionText:!1,select:null,isEditable:!0,selectedIndex:-1,selectedValue:null,inputTextInDropDownList:!1,text:null,ensureDropDownOnBody:!0,open:null,close:null,selectElementWidthFix:6,search:null,changed:null,textChanged:null,selectedIndexChanged:null,selectedIndexChanging:null,listOptions:null}),t.wijmo.registerWidget("wijcombobox",i.prototype)})(wijmo||(wijmo={}));