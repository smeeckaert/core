var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";var t=jQuery,n="wijaccordion",r=function(e){function n(){e.apply(this,arguments),this.widgetEventPrefix="wijaccordion"}return __extends(n,e),n.prototype._setOption=function(e,n){var r=this.options;if(r[e]!==n)switch(e){case"selectedIndex":this.activate(n);break;case"disabled":n?this.element.addClass(r.wijCSS.stateDisabled):this.element.removeClass(r.wijCSS.stateDisabled);break;case"event":this._unbindLiveEvents(),this.options.event=n,this._bindLiveEvents();break;case"header":this._handleHeaderChange(n,r.header);break;case"animated":break;case"expandDirection":this._onDirectionChange(n,!0,r.expandDirection);break;default:}t.wijmo.widget.prototype._setOption.apply(this,arguments)},n.prototype._handleHeaderChange=function(e,t){var n=this.element.find(t);n.removeClass("wijmo-wijaccordion-header "+this.options.wijCSS.stateActive+" "+this._triangleIconOpened).siblings(".wijmo-wijaccordion-content").removeClass("wijmo-wijaccordion-content "+this.options.wijCSS.content+" wijmo-wijaccordion-content-active"),this._initHeaders(e)},n.prototype._initHeaders=function(e){typeof e=="undefined"&&(e=null);var t=this.options,e=e?e:t.header,n=this.element.find(e);n.each(jQuery.proxy(this._initHeader,this))},n.prototype._initHeader=function(e,n){var r=this.options,i=this.element.data("rightToLeft"),s=t(n),o=t(s.next()[0]);i&&(s.remove(),s.insertAfter(o)),s.addClass("wijmo-wijaccordion-header").attr("role","tab"),o.attr("role","tabpanel"),s.find("> a").length===0&&s.wrapInner('<a href="#"></a>'),s.find("> .ui-icon").length===0&&t('<span class="ui-icon"></span>').insertBefore(t("> a",s)[0]),e===r.selectedIndex?(s.addClass(this.options.wijCSS.stateActive).addClass(this._headerCornerOpened).attr({"aria-expanded":"true",tabIndex:0}).find("> .ui-icon").addClass(this._triangleIconOpened),o.addClass("wijmo-wijaccordion-content-active").addClass(this._contentCornerOpened).wijTriggerVisibility()):(s.addClass(r.wijCSS.stateDefault+" ui-corner-all").attr({"aria-expanded":"false",tabIndex:-1}).find("> .ui-icon").addClass(this._triangleIconClosed),o.hide()),o.addClass("wijmo-wijaccordion-content "+this.options.wijCSS.content)},n.prototype._create=function(){var e=this.options;window.wijmoApplyWijTouchUtilEvents&&(t=window.wijmoApplyWijTouchUtilEvents(t)),this.element.addClass("wijmo-wijaccordion "+e.wijCSS.widget+" wijmo-wijaccordion-icons "+"ui-helper-clearfix"),e.disabled&&this.element.addClass(e.wijCSS.stateDisabled),this._onDirectionChange(e.expandDirection,!1),this._initHeaders(),this.element.attr("role","tablist"),t.wijmo.widget.prototype._create.apply(this,arguments)},n.prototype._init=function(){this._bindLiveEvents()},n.prototype.destroy=function(){var e=this.options;this._unbindLiveEvents(),this.element.removeClass("wijmo-wijaccordion "+e.wijCSS.widget+" wijmo-wijaccordion-icons").removeAttr("role"),t.wijmo.widget.prototype.destroy.apply(this,arguments)},n.prototype._getHeaders=function(){var e=this.options,n=this.element.data("rightToLeft"),r=[],i,s,o=this.element.find(e.header);if(!(o.length>0&&!t(o[0]).hasClass("wijmo-wijaccordion-header")&&t(o[0]).hasClass("wijmo-wijaccordion-content")))return o;for(i=0;i<o.length;i+=1)s=n?t(o[i]).next(".wijmo-wijaccordion-header"):t(o[i]).prev(".wijmo-wijaccordion-header"),s.length>0&&r.push(s[0]);return t(r)},n.prototype.activate=function(e){var n,r=this.options,i=this._getHeaders(),s,o=this.element.data("rightToLeft"),u,a,f,l,c,h,p,d,v,m;s=t(jQuery.grep(i,function(e){return t(e).hasClass(r.wijCSS.stateActive)})),typeof e=="number"?n=t(i[e]):typeof e=="string"?(e=parseInt(e,0),n=t(i[e])):(n=t(e),e=i.index(e));if(n.hasClass(r.wijCSS.stateDisabled))return!1;if(n.hasClass(r.wijCSS.stateActive))if(r.requireOpenedPane){if(s.length===n.length&&s.index()===n.index())return!1}else s=n,n=t(null);else r.requireOpenedPane||(s=t(null));u=i.index(n),a=i.index(s),f=o?n.prev(".wijmo-wijaccordion-content"):n.next(".wijmo-wijaccordion-content"),l=o?s.prev(".wijmo-wijaccordion-content"):s.next(".wijmo-wijaccordion-content");if(s.length===0&&n.length===0)return!1;if(!this._trigger("beforeSelectedIndexChanged",null,{newIndex:u,prevIndex:a}))return!1;s.removeClass(r.wijCSS.stateActive).removeClass(this._headerCornerOpened).addClass(r.wijCSS.stateDefault+" ui-corner-all").attr({"aria-expanded":"false",tabIndex:-1}).find("> .ui-icon").removeClass(this._triangleIconOpened).addClass(this._triangleIconClosed),n.removeClass(r.wijCSS.stateDefault+" ui-corner-all").addClass(r.wijCSS.stateActive).addClass(this._headerCornerOpened).attr({"aria-expanded":"true",tabIndex:0}).find("> .ui-icon").removeClass(this._triangleIconClosed).addClass(this._triangleIconOpened),r.animated?(c={toShow:f,toHide:l,complete:jQuery.proxy(function(){l.removeClass("wijmo-wijaccordion-content-active"),f.addClass("wijmo-wijaccordion-content-active").wijTriggerVisibility(),l.css("display",""),f.css("display",""),t.fn.wijlinechart&&(l.find(".wijmo-wijlinechart").wijlinechart("redraw"),f.find(".wijmo-wijlinechart").wijlinechart("redraw")),this._trigger("selectedIndexChanged",null,{newIndex:u,prevIndex:a})},this),horizontal:this.element.hasClass("ui-helper-horizontal"),rightToLeft:this.element.data("rightToLeft"),down:u>a,autoHeight:r.autoHeight||r.fillSpace},h=r.animated,p=r.duration,t.isFunction(h)&&(r.animated=h(c)),t.isFunction(p)&&(r.duration=p(c)),d=t.wijmo.wijaccordion.animations,v=r.duration,m=r.animated,m&&!d[m]&&!t.easing[m]&&(m="slide"),d[m]||(d[m]=function(e){this.slide(e,{easing:m,duration:v||700})}),d[m](c)):(s.length>0&&l.hide().removeClass("wijmo-wijaccordion-content-active"),n.length>0&&f.show().addClass("wijmo-wijaccordion-content-active").addClass(this._contentCornerOpened).wijTriggerVisibility(),t.fn.wijlinechart&&(l.find(".wijmo-wijlinechart").wijlinechart("redraw"),f.find(".wijmo-wijlinechart").wijlinechart("redraw")),this._trigger("selectedIndexChanged",null,{newIndex:u,prevIndex:a})),this.options.selectedIndex=u},n.prototype._bindLiveEvents=function(){var e=this;this.element.on(this.options.event+".wijaccordion",".wijmo-wijaccordion-header",jQuery.proxy(this._onHeaderClick,this)).on("keydown.wijaccordion",".wijmo-wijaccordion-header",jQuery.proxy(this._onHeaderKeyDown,this)).on("mouseenter.wijaccordion",".wijmo-wijaccordion-header",function(){t(this).addClass("ui-state-hover")}).on("mouseleave.wijaccordion",".wijmo-wijaccordion-header",function(){t(this).removeClass("ui-state-hover")}).on("focus.wijaccordion",".wijmo-wijaccordion-header",function(){t(this).addClass(e.options.wijCSS.stateFocus)}).on("blur.wijaccordion",".wijmo-wijaccordion-header",function(){t(this).removeClass(e.options.wijCSS.stateFocus)})},n.prototype._unbindLiveEvents=function(){this.element.off(".wijaccordion",".wijmo-wijaccordion-header")},n.prototype._onHeaderClick=function(e){return this.options.disabled||this.activate(e.currentTarget),!1},n.prototype._onHeaderKeyDown=function(e){if(this.options.disabled||e.altKey||e.ctrlKey)return;if(!t.ui)return;var n=t.ui.keyCode,r=this.element.find(".wijmo-wijaccordion-header."+this.options.wijCSS.stateFocus),i,s=this._getHeaders();if(r.length>0){i=t(".wijmo-wijaccordion-header",this.element).index(r);switch(e.keyCode){case n.RIGHT:case n.DOWN:if(s[i+1])return s[i+1].focus(),!1;break;case n.LEFT:case n.UP:if(s[i-1])return s[i-1].focus(),!1;break;case n.SPACE:case n.ENTER:this.activate(e.currentTarget),e.preventDefault()}}return!0},n.prototype._onDirectionChange=function(e,n,r){typeof r=="undefined"&&(r=null);var i,s,o,u,a,f,l=this.options;n&&(s=this.element.find(".wijmo-wijaccordion-header."+this._headerCornerOpened),s.removeClass(this._headerCornerOpened),o=this.element.find(".wijmo-wijaccordion-content."+this._contentCornerOpened),o.removeClass(this._contentCornerOpened),u=this.element.find("."+this._triangleIconOpened),a=this.element.find("."+this._triangleIconClosed),u.removeClass(this._triangleIconOpened),a.removeClass(this._triangleIconClosed)),r!==null&&this.element.removeClass("wijmo-wijaccordion-"+r);switch(e){case"top":this._headerCornerOpened="ui-corner-bottom",this._contentCornerOpened="ui-corner-top",this._triangleIconOpened=l.wijCSS.iconArrowUp,this._triangleIconClosed=l.wijCSS.iconArrowRight,i=!0,this.element.removeClass("ui-helper-horizontal"),this.element.addClass("wijmo-wijaccordion-top");break;case"right":this._headerCornerOpened="ui-corner-left",this._contentCornerOpened="ui-corner-right",this._triangleIconOpened=l.wijCSS.iconArrowRight,this._triangleIconClosed=l.wijCSS.iconArrowDown,i=!1,this.element.addClass("ui-helper-horizontal"),this.element.addClass("wijmo-wijaccordion-right");break;case"left":this._headerCornerOpened="ui-corner-right",this._contentCornerOpened="ui-corner-left",this._triangleIconOpened=l.wijCSS.iconArrowLeft,this._triangleIconClosed=l.wijCSS.iconArrowDown,i=!0,this.element.addClass("ui-helper-horizontal"),this.element.addClass("wijmo-wijaccordion-left");break;default:this._headerCornerOpened="ui-corner-top",this._contentCornerOpened="ui-corner-bottom",this._triangleIconOpened=l.wijCSS.iconArrowDown,this._triangleIconClosed=l.wijCSS.iconArrowRight,i=!1,this.element.removeClass("ui-helper-horizontal"),this.element.addClass("wijmo-wijaccordion-bottom")}f=this.element.data("rightToLeft"),this.element.data("rightToLeft",i),n&&(u.addClass(this._triangleIconOpened),a.addClass(this._triangleIconClosed),s.addClass(this._headerCornerOpened),o.addClass(this._contentCornerOpened)),n&&i!==f&&this.element.children(".wijmo-wijaccordion-header").each(function(e,n){var r=t(this),s;i?(s=r.next(".wijmo-wijaccordion-content"),r.remove(),r.insertAfter(s)):(s=r.prev(".wijmo-wijaccordion-content"),r.remove(),r.insertBefore(s))})},n}(e.wijmoWidget);e.wijaccordion=r,r.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,{wijMobileCSS:{header:"ui-header ui-bar-a",content:"ui-body ui-body-c"},initSelector:":jqmData(role='wijaccordion')",animated:"slide",duration:null,event:"click",disabled:!1,expandDirection:"bottom",header:"> li > :first-child,> :not(li):even",requireOpenedPane:!0,selectedIndex:0}),t.wijmo.registerWidget(n,r.prototype),t.extend(t.wijmo.wijaccordion,{animations:{slide:function(e,n){e=t.extend({easing:"swing",duration:300},e,n);var r,i;e.horizontal?(r={width:"show"},i={width:"hide"}):(r={height:"show"},i={height:"hide"});if(!e.toHide.size()){e.toShow.stop(!0,!0).animate(r,e);return}if(!e.toShow.size()){e.toHide.stop(!0,!0).animate(i,e);return}var s=e.toShow.css("overflow"),o=0,u={},a={},f,l=e.horizontal?["width","paddingLeft","paddingRight"]:["height","paddingTop","paddingBottom"],c,h=e.toShow;e.horizontal?(c=h[0].style.height,h.height(parseInt(h.parent().height(),10)-parseInt(h.css("paddingTop"),10)-parseInt(h.css("paddingBottom"),10)-(parseInt(h.css("borderTopWidth"),10)||0)-(parseInt(h.css("borderBottomWidth"),10)||0))):(c=h[0].style.width,h.width(parseInt(h.parent().width(),10)-parseInt(h.css("paddingLeft"),10)-parseInt(h.css("paddingRight"),10)-(parseInt(h.css("borderLeftWidth"),10)||0)-(parseInt(h.css("borderRightWidth"),10)||0))),t.each(l,function(n,r){a[r]="hide";var i=(""+t.css(e.toShow[0],r)).match(/^([\d+-.]+)(.*)$/);u[r]={value:i?i[1]:"0",unit:i?i[2]||"px":"px"}}),e.horizontal?f={width:0,overflow:"hidden"}:f={height:0,overflow:"hidden"},e.toShow.css(f).stop(!0,!0).show(),e.toHide.filter(":hidden").each(e.complete).end().filter(":visible").stop(!0,!0).animate(a,{step:function(t,n){var r;if(n.prop===e.horizontal?"width":"height")o=n.end-n.start===0?0:(n.now-n.start)/(n.end-n.start);r=o*u[n.prop].value,r<0&&(r=0),e.toShow[0].style[n.prop]=r+u[n.prop].unit},duration:e.duration,easing:e.easing,complete:function(){e.autoHeight||e.toShow.css(e.horizontal?"width":"height",""),e.toShow.css(e.horizontal?"height":"width",c),e.toShow.css({overflow:s}),e.complete()}})},bounceslide:function(e){this.slide(e,{easing:e.down?"easeOutBounce":"swing",duration:e.down?1e3:200})}}})})(wijmo||(wijmo={}));