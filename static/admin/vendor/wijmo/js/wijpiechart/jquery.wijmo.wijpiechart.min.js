var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){var t=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t.prototype._create=function(){this._handleChartStyles(),e.prototype._create.call(this),this.chartElement.addClass(this.options.wijCSS.pieChart)},t.prototype.destroy=function(){var t=this.options.wijCSS,n=this.chartElement,r=n.data("fields"),i=r&&r.sectors,s=r&&r.labels;n.removeClass(t.pieChart),e.prototype.destroy.call(this),i&&i.length&&$.each(i,function(e,t){t=null}),s&&s.length&&$.each(s,function(e,t){t=null}),n.data("fields",null)},t.prototype._isPieChart=function(){return!0},t.prototype.getSector=function(e){var t=this.chartElement.data("fields");return t&&t.chartElements?t.chartElements.sectors[e]:null},t.prototype._bindData=function(){var e=this.options,t=e.dataSource,n=e.data,r=[],i,s,o;t&&n&&(i=n.label,s=n.value,o=n.offset,i&&i.bind&&(i=this._getBindData(t,i.bind)),s&&s.bind&&(s=this._getBindData(t,s.bind)),o&&o.bind&&(o=this._getBindData(t,o.bind)),i&&$.isArray(i)&&i.length&&s&&$.isArray(s)&&s.length&&($.each(s,function(e,t){var n,u=0;e>=0&&e<i.length&&(n=i[e]),o&&$.isArray(s)&&o.length&&e>=0&&e<o.length&&(u=typeof o[e]=="undefined"?0:o[e]),r.push({data:t,label:n,offset:u,legendEntry:!0})}),e.seriesList=r))},t.prototype._hanldSharedXData=function(){},t.prototype._getSeriesFromTR=function(e,t,n){var r=null,i=null,s=null,o=null,u=null;t.length&&t.each(function(){i=$("th",$(this)),r=$.trim(i.text()),s=$("td",$(this)),s.length&&(o=parseFloat($.trim($(s[0]).text()))),u={label:r,legendEntry:!0,data:o},n.push(u)})},t.prototype._showSerieEles=function(e){var t=this.options.showChartLabels;e.sector&&(e.sector.show(),e.sector.shadow&&e.sector.shadow.show(),e.sector.tracker&&e.sector.tracker.show()),e.label&&t&&(e.label.show(),e.label.connector&&e.label.connector.show(),$(e.label.node).data("legendHide",!1))},t.prototype._hideSerieEles=function(e){e.sector&&(e.sector.hide(),e.sector.shadow&&e.sector.shadow.hide(),e.sector.tracker&&e.sector.tracker.hide()),e.label&&(e.label.hide(),e.label.connector&&e.label.connector.hide(),$(e.label.node).data("legendHide",!0))},t.prototype._hasAxes=function(){return!1},t.prototype._mouseMoveInsidePlotArea=function(t,n){e.prototype._mouseMoveInsidePlotArea.call(this,t,n);if(this.isTapAndHold){var r=this.previousAngle,i=0,s="",o=this.chartElement,u=this.tapTarget?this.tapTarget.data("wijchartDataObj"):{},a=u.pieID||"",f=o.data("fields").chartElements["sectors"+a],l=this.canvasBounds,c=(l.startX+l.endX)/2,h=(l.startY+l.endY)/2,p=Raphael.angle(n.left,n.top,c,h);r&&(i=Math.round(p-r),Math.abs(p-r)>180&&(p>r?i-=360:i+=360),i&&(s=Raphael.format("...r{0},{1},{2}",i,c,h),$.each(f,function(e,t){t.transform(s)}),this.tooltip&&this._setTouchTooltip(null))),this.previousAngle=p}},t.prototype._mouseMoveOutsidePlotArea=function(t,n){e.prototype._mouseMoveOutsidePlotArea.call(this,t,n),this.isTapAndHold&&this._rotateToSectorCenter(null)},t.prototype._rotateToSectorCenter=function(e){var t=this,n=this.options.animation,r=this.chartElement,i=this.tapTarget?this.tapTarget.data("wijchartDataObj"):{},s=i.pieID||"",o=r.data("fields").chartElements["sectors"+s],u=r.data("fields").chartElements["labels"+s],a=this.canvasBounds,f=(a.startX+a.endX)/2,l=(a.startY+a.endY)/2,c,h,p,d=this;this._hideSectorElements(o,u),this.tooltip&&(h=this._getTouchttSector(e)),this.touchttSector&&this.touchttSector===h&&Math.abs(this.targetCenterAngle)>=.01?(this.targetCenterAngle>180?p=this.targetCenterAngle-360:this.targetCenterAngle<-180?p=this.targetCenterAngle+360:p=this.targetCenterAngle,c=Raphael.animation({transform:Raphael.format("...r{0},{1},{2}",p,f,l)},n.duration,n.easing,function(){d._rotateCallback(this,u)}),$.each(o,function(e,t){t.animate(c)})):$.each(o,function(e,n){t._rotateCallback(n,u)}),this.previousAngle=null,this.isTapAndHold=!1,this.tapTarget=null},t.prototype._rotateCallback=function(e,t){var n=this.canvasBounds,r=(n.startX+n.endX)/2,i=(n.startY+n.endY)/2,s=e.index,o=0,u=e.attr("transform"),a;$.each(u,function(e,t){if(t[0]!=="r")return!0;t.length>=4&&(o+=t[1])}),r>0&&(o%=360,e.attr("transform",Raphael.format("r{0},{1},{2}",o,r,i))),e.tracker&&(e.tracker.attr("transform",Raphael.format("r{0},{1},{2}",o,r,i)),e.tracker.show()),e.shadow&&(e.shadow.attr("transform",Raphael.format("r{0},{1},{2}",o,r,i)),e.shadow.show());if(t&&t.length&&t.length>s){a=t[s],a.attr("transform",Raphael.format("r{0},{1},{2}r{3}",o,r,i,0-o));if($(a.node).data("legendHide"))return;a.show()}},t.prototype._getTouchttSector=function(e){var t=this,n=this.chartElement,r=this.tapTarget?this.tapTarget.data("wijchartDataObj"):{},i=r.pieID||"",s=n.data("fields").chartElements["sectors"+i],o=this.tooltip.getOptions(),u=o.compass,a=90,f;switch(u){case"east":a=0;break;case"south":a=270;break;case"west":a=180;break;case"north":default:a=90}return $.each(s,function(n,r){var i=r.attr("transform"),s=0,o=r.angles;$.each(i,function(e,t){if(t[0]!=="r")return!0;t.length>=4&&(s+=t[1])}),s%=360,s<0&&(s=360+s),s=(a+s)%360;if(e){if(r===e)return t.targetCenterAngle=(o.start+o.end)/2-s,f=e,!1}else if(o.start<=s&&o.end>=s)return t.targetCenterAngle=(o.start+o.end)/2-s,f=r,!1}),f},t.prototype._setTouchTooltip=function(e){var t=this.tooltip.getOptions(),n=t.compass,r=this._getTouchttSector(e),i=this.options.hint,s=i.title,o=i.content,u=$.isFunction(s),a=$.isFunction(o),f,l;if(!r||this.touchttSector&&this.touchttSector===r)return;f=$(r.node).data("wijchartDataObj"),l={data:f,value:f.value,label:f.label,total:f.total,y:f.value};if(u||a)u&&(t.title=function(){l.fmt=s;var e=$.proxy(l.fmt,l),t=e();return t}),a&&(t.content=function(){l.fmt=o;var e=$.proxy(l.fmt,l),t=e();return t});this._showTouchTooltip(n),this.touchttSector=r},t.prototype._showTouchTooltip=function(e){var t=this.chartElement,n=this.canvasBounds,r={x:0,y:0};switch(e){case"east":r={x:t.width(),y:(n.startY+n.endY)/2};break;case"south":r={x:(n.startX+n.endX)/2,y:t.height()};break;case"west":r={x:0,y:(n.startY+n.endY)/2};break;case"north":default:r={x:(n.startX+n.endX)/2,y:0}}this.tooltip.showAt(r)},t.prototype._mouseDown=function(t,n){var r=$(t.target),i=this.chartElement,s,o,u;e.prototype._mouseDown.call(this,t,n),$.support.isTouchEnabled&&$.support.isTouchEnabled()&&(this.isTapAndHold=!0,r.data("owner")&&(r=r.data("owner")),this.tapTarget=r,s=n.pieID||"",o=i.data("fields").chartElements["sectors"+s],u=i.data("fields").chartElements["labels"+s],this._hideSectorElements(o,u))},t.prototype._hideSectorElements=function(e,t){$.each(e,function(e,n){n.stop(),n.tracker&&n.tracker.hide(),n.shadow&&n.shadow.hide();if(t&&t.length){var r=t[e];r.hide()}})},t.prototype._mouseUp=function(t,n){e.prototype._mouseUp.call(this,t,n),$.support.isTouchEnabled&&$.support.isTouchEnabled()&&this.isTapAndHold&&this._rotateToSectorCenter(null)},t.prototype._mouseOver=function(t,n){e.prototype._mouseOver.call(this,t,n)},t.prototype._mouseOut=function(t,n){e.prototype._mouseOut.call(this,t,n)},t.prototype._mouseMove=function(t,n){e.prototype._mouseMove.call(this,t,n)},t.prototype._click=function(t,n){var r=this.chartElement,i,s,o;e.prototype._click.call(this,t,n),$.support.isTouchEnabled&&$.support.isTouchEnabled()&&this.tooltip&&(i=n.pieID||"",s=r.data("fields").chartElements["sectors"+i],s.length&&s.length>n.index&&(o=s[n.index],this._setTouchTooltip(o),this._rotateToSectorCenter(o)))},t.prototype._paintTooltip=function(){var t=this.options.wijCSS,n=this.chartElement,r=n.data("fields");e.prototype._paintTooltip.call(this),this.tooltip&&r&&($.support.isTouchEnabled&&$.support.isTouchEnabled()?(this.tooltip.setOptions({closeBehavior:"none",mouseTrailing:!1,animated:null,showAnimated:null,windowCollisionDetection:"fit"}),this._setTouchTooltip(null),this._rotateToSectorCenter(null)):r.trackers&&r.trackers.length&&(this.tooltip.setSelector($("."+t.canvasObject,n[0])),this.tooltip.setOptions({relatedElement:r.trackers[0]})))},t.prototype._paintPlotArea=function(){var e=this.options,t=this.canvasBounds,r=t.endX-t.startX,i=t.endY-t.startY,s=e.radius;s?(r<2*s&&(s=r/2),i<2*s&&(s=i/2)):s=Math.min(r,i)/2,t.startX+=r/2-s,t.endX=t.startX+2*s,t.startY+=i/2-s,t.endY=t.startY+2*s,this.chartElement.data("fields")&&(this.chartElement.data("fields").seriesEles=null),this.piechartRender=new n(this.chartElement,{canvas:this.canvas,tooltip:this.tooltip,bounds:t,wijCSS:e.wijCSS,radius:s,startAngle:e.startAngle,widgetName:this.widgetName,innerRadius:e.innerRadius,seriesList:e.seriesList,seriesStyles:e.seriesStyles,seriesHoverStyles:e.seriesHoverStyles,seriesTransition:e.seriesTransition,showChartLabels:e.showChartLabels,disabled:e.disabled,textStyle:e.textStyle,chartLabelStyle:e.chartLabelStyle,chartLabelFormatString:e.chartLabelFormatString,chartLabelFormatter:e.chartLabelFormatter,labels:e.labels,shadow:e.shadow,animation:e.animation,culture:this._getCulture(),mouseDown:$.proxy(this._mouseDown,this),mouseUp:$.proxy(this._mouseUp,this),mouseOver:$.proxy(this._mouseOver,this),mouseOut:$.proxy(this._mouseOut,this),mouseMove:$.proxy(this._mouseMove,this),click:$.proxy(this._click,this),widget:this}),this.piechartRender.render()},t.prototype._getTooltipText=function(e,t){var n=$(t.node),r,i;return n.data("owner")&&(n=n.data("owner")),r=n.data("wijchartDataObj"),i={data:r,value:r.value,label:r.label,total:r.total,target:t,y:r.value,fmt:e},$.proxy(e,i)()},t}(e.WijChartCore);e.WijPieChart=t,t.prototype.options=$.extend(!0,{},e.WijChartCore.prototype.options,{initSelector:":jqmData(role='wijpiechart')",wijCSS:{pieChart:"wijmo-wijpiechart",pieLabel:"wijpiechart-label",pieElement:"wijpiechart",pieTracker:"pietracker"},startAngle:0,radius:null,innerRadius:0,chartLabelFormatter:null,labels:{style:{},formatString:"",formatter:null,connectorStyle:{},position:"inside",offset:10},animation:{enabled:!0,duration:400,easing:"easeInCubic",offset:10},seriesTransition:{enabled:!0,duration:1e3,easing:"bounce"},seriesList:[],mouseDown:null,mouseUp:null,mouseOver:null,mouseOut:null,mouseMove:null,click:null}),$.wijmo.registerWidget("wijpiechart",t.prototype);var n=function(){function t(e,t){this.options=t,this.element=e}return t.prototype.render=function(){var t=this.element,n=this.options,r=function(t,r,i){n.shadow&&e.ChartUtil.paintShadow(t,r,i)},i=e.ChartUtil.getDiffAttrs,s=n.canvas,o=$.wijraphael.getPositionByAngle,u=n.seriesList,a=n.seriesStyles,f=n.seriesHoverStyles,l=a.length,c=n.textStyle,h=n.labels||{style:{},formatString:"",formatter:null,connectorStyle:{},position:"inside",offset:10},p=$.extend(!0,{},c,n.chartLabelStyle,h.style),d=h.formatString||n.chartLabelFormatString,v=h.formatter||n.chartLabelFormatter,m=n.culture,g=n.bounds,y=g.startX,b=g.startY,w=n.radius,E=n.showChartLabels,S=n.animation,x=n.seriesTransition,T=n.innerRadius,N=t.data("fields")||{},C=N.chartElements||{},k=N.aniSectorAttrs,L=N.aniLabelAttrs,A=0,O=n.startAngle||0,M=n.wijCSS,_,D,P,H=[],B=[],j=[],F=[],I=[],q=[],R=s.set(),U=this.options.widget;s.customAttributes.segment=function(t,n,r,i,s,o){var u=null,a=.01;return i-r>360-a?i-=a:i-r<a&&(i+=a),o?u=e.ChartUtil.donut(t,n,s,o,r,i):u=e.ChartUtil.sector(t,n,s,r,i),{path:u}},$.each(u,function(e,t){t&&typeof t.data=="number"&&(A+=t.data)}),$.each(u,function(e,t){var n=$.extend({opacity:1,stroke:"gray","stroke-width":1},a[e%l]),u=360*t.data/A,c=y+w,g=b+w,S,N,C,z,W,X,V,J,K,Q=h.position,G=h.connectorStyle,Y=h.offset,Z,et,tt,nt=!1;_=t.pieID,t=$.extend(!0,{offset:0},t),t.offset&&(S=o(c,g,t.offset,O+u/2),c=S.x,g=S.y),D=[c,g,O,O+u,w,T],k&&x.enabled?(n.segment=D,e<k.length?P=k[e]:(P=$.extend(!0,{},n),P.segment=[c,g,0,360,w,T]),N=s.path().attr(P),n=i(P,n),N.removed||N.wijAnimate(n,x.duration,x.easing,function(){r(N,1,"#cccccc"),V&&!V.removed&&!N.removed&&V.attr({path:N.attr("path")}),delete n.segment})):(N=s.path().attr({segment:D}),r(N,1,"#ccccc"),N.wijAttr(n)),N.angles={start:O,end:O+u},N.index=e,N.getOffset=function(e){var t=o(c,g,e,(N.angles.start+N.angles.end)/2);return{x:t.x-c,y:t.y-g}},N.center={x:c,y:g},N.radius=w,T&&(N.innerRadius=T),V=N.clone(),Raphael.vml?V.attr({opacity:.01,fill:"white","stroke-width":0,"fill-opacity":.01}):V.attr({opacity:.01,fill:"white","fill-opacity":.01}),$.wijraphael.addClass($(V.node),Raphael.format("{0} {1} {2} wijchart-tracker"+e,M.canvasObject,M.pieElement,M.pieTracker)),$(V.node).data("owner",$(N.node)),N.tracker=V,R.push(V),$.wijraphael.addClass($(N.node),Raphael.format("{0} {1} wijmo-wijpiechart-series-"+e,M.canvasObject,M.pieElement)),$(N.node).data("wijchartDataObj",t),E&&(Q==="outside"?(X=o(c,g,w,O+u/2),z=o(c,g,w+Y,O+u/2)):z=o(c,g,t.offset+w*2/3,O+u/2),W=$.extend(!0,{},W,p),t.textStyle&&(W=$.extend(!0,W,t.textStyle)),J=t.label,d&&d.length>0&&(J=Globalize.format(J,d,m)),v&&$.isFunction(v)&&(K={index:e,value:t.data,y:t.data,total:A,chartLabel:J,chartLabelFormatter:v},J=$.proxy(v,K)()),L&&x.enabled?e<L.length?(nt=!0,P=L[e],P.text=J,C=U._text.call(U,0,0,"").attr(P),W=i(P,W),W.x=z.x,W.y=z.y,C.wijAnimate(W,x.duration,x.easing,function(){tt&&tt.show()})):C=U._text.call(U,z.x,z.y,J).attr(W):C=U._text.call(U,z.x,z.y,J).attr(W),Q==="outside"&&(Z=(O+u/2)%360,et=C.wijGetBBox(),Z>=90&&Z<=270?C.transform(Raphael.format("T{0},{1}",-et.width/2,0)):C.transform(Raphael.format("T{0},{1}",et.width/2,0)),tt=s.path(Raphael.format("M{0} {1}L{2} {3}",X.x,X.y,z.x,z.y)).attr(G),nt&&tt.hide(),C.connector=tt),$.wijraphael.addClass($(C.node),Raphael.format("{0} {1} {2}",M.canvasObject,M.pieElement,M.pieLabel)),$(C.node).data("wijchartDataObj",t),I.push(C),F.push(C),B[e]=C.attr()),q.push({label:F[e],sector:N}),t.visible===!1&&(N.hide(),F[e]&&F[e].hide(),tt&&tt.hide(),N.shadow&&N.shadow.hide(),V.hide()),H[e]=N.attr(),j.push(N),I.push(N),t.style=n,t.hoverStyle=f[e],t.index=e,t.value=t.data,t.y=t.data,t.total=A,t.type="pie",O+=u}),F&&F.length&&$.each(F,function(e,t){t.toFront()}),C.sectors=j,_&&(C["sectors"+_]=j,C["labels"+_]=F),C.labels=F,N.chartElements||(N.chartElements={}),R.toFront(),$.extend(!0,N.chartElements,C),N.aniSectorAttrs=H,N.aniLabelAttrs=B,N.seriesEles=q,N.trackers=R,t.data("fields",N),this.unbindLiveEvents(),this.bindLiveEvents()},t.prototype.bindLiveEvents=function(){var e=this.options,t=this.element,n=e.tooltip,r={x:0,y:0},i="",s=$.isFunction,o=e.disabled,u=e.animation;$.support.isTouchEnabled&&$.support.isTouchEnabled()&&(i="wij"),n&&n.setTargets(this.tooltipTars),t.on(i+"mousedown."+e.widgetName,"."+e.wijCSS.pieElement,function(n){if(o)return;var r=e.mouseDown,i=$(n.target),u;i.data("owner")&&(i=i.data("owner")),u=i.data("wijchartDataObj");if(!u)return;s(r)&&r.call(t,n,u)}).on(i+"mouseup."+e.widgetName,"."+e.wijCSS.pieElement,function(n){if(o)return;var r=e.mouseUp,i=$(n.target),u;i.data("owner")&&(i=i.data("owner")),u=i.data("wijchartDataObj");if(!u)return;s(r)&&r.call(t,n,u)}).on(i+"mouseover."+e.widgetName,"."+e.wijCSS.pieElement,function(n){if(o)return;var i=e.mouseOver,a=$(n.target),f=u&&u.enabled,l,c,h,p,d,v,m;a.data("owner")&&(a=a.data("owner")),l=a.data("wijchartDataObj");if(!l)return;c=l.pieID||"",h=l.index,p=t.data("fields").chartElements["sectors"+c][h],d=p.showAnimationTimer,v=p.hideAnimationTimer,m=p.explodeAnimationShowing,s(i)&&i.call(t,n,l);if($.support.isTouchEnabled&&$.support.isTouchEnabled())return;if(p.removed)return;p.wijAttr(l.hoverStyle);if(f){v&&(window.clearTimeout(v),v=null,p.hideAnimationTimer=v),d&&(window.clearTimeout(d),d=null,p.showAnimationTimer=null);if(m)return;d=window.setTimeout(function(){var e=u.duration,t=u.easing;if(p.removed)return;r=p.getOffset(u.offset||10),p.offset=r,p.shadow&&!p.shadow.removed&&p.shadow.hide(),p.wijAnimate({transform:Raphael.format("t{0},{1}",r.x,r.y)},e,t),p.tracker&&!p.tracker.removed&&p.tracker.wijAnimate({transform:Raphael.format("t{0},{1}",r.x,r.y)},e,t),m=!0,p.explodeAnimationShowing=m},150),p.showAnimationTimer=d}}).on(i+"mouseout."+e.widgetName,"."+e.wijCSS.pieElement,function(n){if(o)return;var i=e.mouseOut,a=$(n.target),f=u&&u.enabled,l,c,h,p,d,v,m;a.data("owner")&&(a=a.data("owner")),l=a.data("wijchartDataObj");if(!l)return;c=l.pieID||"",h=l.index,p=t.data("fields").chartElements["sectors"+c][h],d=p.showAnimationTimer,v=p.hideAnimationTimer,m=p.explodeAnimationShowing,s(i)&&i.call(t,n,l);if($.support.isTouchEnabled&&$.support.isTouchEnabled())return;if(p.removed)return;l.style.segment&&delete l.style.segment,p.wijAttr(l.style);if(f){v&&(window.clearTimeout(v),v=null,p.hideAnimationTimer=v),d&&(window.clearTimeout(d),d=null,p.showAnimationTimer=d);if(!m)return;v=window.setTimeout(function(){var e=u.duration,t=u.easing;r=p.offset,p.shadow&&!p.shadow.removed&&p.shadow.show(),p.removed||p.wijAnimate({transform:"t0,0"},e,t),p.tracker&&!p.tracker.removed&&p.tracker.wijAnimate({transform:"t0,0"},e,t),p.shadow&&!p.shadow.removed&&p.shadow.wijAnimate({transform:"t0,0"},e,t),r={x:0,y:0},m=!1,p.explodeAnimationShowing=m},150),p.hideAnimationTimer=v}}).on(i+"mousemove."+e.widgetName,"."+e.wijCSS.pieElement,function(n){if(o)return;var r=e.mouseMove,i=$(n.target),u;i.data("owner")&&(i=i.data("owner")),u=i.data("wijchartDataObj");if(!u)return;s(r)&&r.call(t,n,u)}).on(i+"click."+e.widgetName,"."+e.wijCSS.pieElement,function(n){if(o)return;var r=e.click,i=$(n.target),u;i.data("owner")&&(i=i.data("owner")),u=i.data("wijchartDataObj");if(!u)return;s(r)&&r.call(t,n,u)})},t.prototype.unbindLiveEvents=function(){var e=this.element,t=this.options;e.off("."+t.widgetName,"."+t.wijCSS.pieElement)},t}();e.PieChartRender=n})(wijmo||(wijmo={}));