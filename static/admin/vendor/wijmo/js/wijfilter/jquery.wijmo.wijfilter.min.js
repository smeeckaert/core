var __extends=this.__extends||function(e,t){function n(){this.constructor=e}n.prototype=t.prototype,e.prototype=new n},wijmo;(function(e){"use strict";var t=jQuery,n=function(n){function r(){n.apply(this,arguments)}return __extends(r,n),r.prototype._create=function(){this._super.apply(this,arguments),this._initialized=!1,this.element.addClass(this.options.wijCSS.widget+" "+"wijmo-wijfilter")},r.prototype._init=function(){this._initialized||this._recreate()},r.prototype._setOptions=function(){this._super.apply(this,arguments);try{this._initialized=!1,this._recreate()}finally{this._initialized=!0}},r.prototype._recreate=function(){this._searchTimer=0,this._searchKey=undefined,this._ignoreEvents=!1,this._elements={},this._dialog&&(this._dialog.remove(),this._dialog=null),t.isArray(this.options.filterValue)||(this.options.filterValue=[this.options.filterValue]),this.options.filterValue=t.map(this.options.filterValue,function(e,n){return t.isArray(e)?[e]:[[e]]}),t.isArray(this.options.filterOperator)||(this.options.filterOperator=[this.options.filterOperator]),this.options.filterOperator=t.map(this.options.filterOperator,function(e,t){return typeof e=="string"?{name:e}:e}),this._originalOptions=t.extend(!0,{},{sortDirection:this.options.sortDirection,filterValue:this.options.filterValue,filterOperator:this.options.filterOperator}),this._distinctDataValues=this._getDistinctDataValues(this.options.data,this.options.dataKey),this._distinctDataValuesCI=t.map(this._distinctDataValues,function(e,t){return typeof e=="string"?e.toLowerCase():e}),this.element.append(this._dialog=this._createRoughDialog()),this._attachElements(this._distinctDataValues,this.options.availableOperators),this._fillDialog()},r.prototype._destroy=function(){this._dialog&&(this._dialog.remove(),this._dialog=null),this.element.removeClass(this.options.wijCSS.widget+" "+"wijmo-wijfilter")},r.prototype.triggerClose=function(e){this._trigger("close",null,e?{sortDirection:this.options.sortDirection,filterValue:this.options.filterValue,filterOperator:this.options.filterOperator}:null)},r.prototype._onApplyButtonClick=function(e,t){this._isSettingsChanged(this.options,this._originalOptions)?(this.options.filterOperator.length>1&&(this.options.filterOperator[1].condition=this._elements.$radioButtons.eq(0).is(":checked")?"and":"or"),this.triggerClose(!0)):this.triggerClose(!1)},r.prototype._onClearButtonClick=function(){this.options.filterValue=[[undefined]],this.options.filterOperator=[{name:"NoFilter"}],this._onApplyButtonClick()},r.prototype._onAscendingButtonClick=function(e,n){var r=t(e.target);r.is(":checked")?(this.options.sortDirection="ascending",this._elements.$descendingBtn.prop("checked",!1).button("refresh")):this.options.sortDirection="none"},r.prototype._onDescendingButtonClick=function(e,n){var r=t(e.target);r.is(":checked")?(this.options.sortDirection="descending",this._elements.$ascendingBtn.prop("checked",!1).button("refresh")):this.options.sortDirection="none"},r.prototype._onCheckboxChange=function(e,n){if(this._ignoreEvents)return;var r=t(e.target),i=r.is(":checked"),s=[],o=this;this._resetFilterArea(),r.is(".wijmo-wijfilter-selectAll")?this._elements.$checkboxes.each(function(e,n){return e&&t(n).prop("checked",i).wijcheckbox("refresh"),!0}):this._elements.$checkboxes.each(function(e,n){return e?t(n).is(":checked")&&s.push(o._distinctDataValues[e-1]):t(n).prop("checked",!1).wijcheckbox("refresh"),!0}),s.length?(this.options.filterOperator=[{name:"Equals"}],this.options.filterValue=[s]):(this.options.filterOperator=[{name:"NoFilter"}],this.options.filterValue=undefined)},r.prototype._onFilterAreaChanged=function(e,n){if(this._ignoreEvents)return;var r=this;this._resetCheckboxes(),this.options.filterOperator=[{name:this._elements.$filterOperatorsDdl.eq(0).val()},{name:this._elements.$filterOperatorsDdl.eq(1).val()}],this.options.filterValue=t.map(this._elements.$filterValuesDdl,function(e,n){var i=t(e),s=i.wijcombobox("option","selectedIndex");return s>=0?[[r._distinctDataValues[s]]]:[[i.val()]]})},r.prototype._onRadioButtonChanged=function(e,t){if(this._ignoreEvents)return;this.options.filterOperator.length>1&&(this.options.filterOperator[1].condition=this._elements.$radioButtons.eq(0).is(":checked")?"and":"or")},r.prototype._onSearchTextboxKeyUp=function(e,t){if(this._ignoreEvents)return;var n=this;this._searchTimer>0&&window.clearTimeout(this._searchTimer),this._searchTimer!==-1&&(this._searchTimer=window.setTimeout(function(){n._searchTimer=-1;try{n._doSearch(e.target.value)}finally{n._searchTimer=0}},300))},r.prototype._doSearch=function(e){if(this._searchKey!==e)if(!e&&e!==0)this._elements.$checkboxes.closest("li").show();else{var n=[],r=0,i=this;t.each(this._distinctDataValues,function(t,r){r=r||r===0?r.toString().toLowerCase():"",r.indexOf(e)>=0&&n.push(t+1)}),n.length?this._elements.$checkboxes.each(function(e,i){return e&&(e===n[r]?(r++,t(i).closest("li").show()):t(i).closest("li").hide()),!0}):this._elements.$checkboxes.closest("li").hide()}this._searchKey=e},r.prototype._resetFilters=function(){try{this._ignoreEvents=!0,this.options.filterValue=[[undefined]],this.options.filterOperator=[{name:"NoFilter"}],this._resetFilterArea(),this._elements.$searchTb.val(""),this._resetCheckboxes()}finally{this._ignoreEvents=!1}},r.prototype._resetFilterArea=function(){this._searchKey=undefined,this._elements.$filterOperatorsDdl.prop("selectedIndex",0).wijdropdown("refresh"),this._elements.$radioButtons.eq(1).prop("checked",!0).wijradio("refresh"),this._elements.$filterValuesDdl.val("").wijcombobox("option","selectedIndex",-1)},r.prototype._resetCheckboxes=function(){this._elements.$checkboxes.closest("li").show().end().prop("checked",!1).wijcheckbox("refresh"),this._elements.$searchTb.val("")},r.prototype._isSettingsChanged=function(e,t){return e.sortDirection!==t.sortDirection||this._compareArrays(e.filterValue,t.filterValue)||this._compareArrays(e.filterOperator,t.filterOperator,function(e,t){return e.name.toLowerCase()!==t.name.toLowerCase()||(e.condition||"or")!==(t.condition||"or")})},r.prototype._compareArrays=function(e,n,r){if(t.isArray(e)&&t.isArray(n)){if(e.length!==n.length)return!0;var i=!1,s,o;for(s=0,o=e.length;s<o&&!i;s++)i=this._compareArrays(e[s],n[s],r);return i}return r?r(e,n):e!==n},r.prototype._getDistinctDataValues=function(e,n){var r=[],i={};return e&&t.each(e,function(e,s){var o=s[n];t.isFunction(o)&&(o=o()),i[o]===undefined&&(i[o]=!0,r.push(o))}),r.sort(function(e,t){return e instanceof Date&&(e=e.getTime()),t instanceof Date&&(t=t.getTime()),e===t?0:e<t?-1:1})},r.prototype._createRoughDialog=function(){var e=this.options.wijCSS,n='<div class="wijmo-wijfilter-container"><div class="wijmo-wijfilter-headerContainer '+e.header+" "+e.cornerAll+" "+e.helperClearFix+'">'+'<span class="wijmo-wijfilter-headerText"></span>'+'<a class="wijmo-wijfilter-closeButton" href="#">Close</a>'+"</div>"+"<h3>Sort</h3>"+'<div class="wijmo-wijfilter-sortContainer">'+'<input type="checkbox" class="wijmo-wijfilter-ascendingButton" id="{0}" /><label for="{0}">Ascending</label>'+'<input type="checkbox" class="wijmo-wijfilter-descendingButton" id="{1}" /><label for="{1}">Descending</label>'+"</div>"+"<h3>Filter</h3>"+'<div class="wijmo-wijfilter-filterContainer">'+'<select class="wijmo-wijfilter-dropdown">'+"</select>"+'<input type="text" class="wijmo-wijfilter-combobox" />'+"</div>"+'<div class="wijmo-wijfilter-radioContainer">'+'<input type="radio" id="{2}" name="{4}" /><label for="{2}">And</label>'+'<input type="radio" id="{3}" name="{4}" checked="checked" /><label for="{3}">Or</label>'+"</div>"+'<div class="wijmo-wijfilter-filterContainer">'+'<select class="wijmo-wijfilter-dropdown">'+"</select>"+'<input type="text" class="wijmo-wijfilter-combobox" />'+"</div>"+'<div class="wijmo-wijfilter-searchContainer">'+'<input class="wijmo-wijfilter-text" type="text" /><span class="ui-icon ui-icon-search"></span>'+"</div>"+'<div class="wijmo-wijfilter-checkboxContainer ui-state-default">'+'<div><input id="{5}" type="checkbox" class="wijmo-wijfilter-selectAll" /><label for="{5}">(Select All)</label></div>'+"</div>"+'<a class="wijmo-wijfilter-clearButton" href="#">Clear Filter</a>'+'<div class="wijmo-wijfilter-actionContainer">'+'<a class="wijmo-wijfilter-applyButton" href="#">Apply</a>'+'<a class="wijmo-wijfilter-cancelButton" href="#">Cancel</a>'+"</div>"+"</div>";return n=function(e){var t=arguments;return e.replace(/{\d+}/g,function(e){return t[parseInt(e.replace(/[{}]/g,""),10)+1]})}(n,this._guid("ascBtn"),this._guid("descBtn"),this._guid("radioAnd"),this._guid("radioOr"),this._guid("radioGroup"),this._guid("selectAll")),t(n)},r.prototype._attachElements=function(e,n){var r=this._dialog,i=this.options.wijCSS,s=this,o;o=this._elements.$headerContainer=r.find(".wijmo-wijfilter-headerContainer"),this._elements.$headerText=o.find(".wijmo-wijfilter-headerText"),this._elements.$headerCloseBtn=o.find(".wijmo-wijfilter-closeButton"),o=this._elements.$sortContainer=r.find(".wijmo-wijfilter-sortContainer"),this._elements.$ascendingBtn=o.find(".wijmo-wijfilter-ascendingButton"),this._elements.$descendingBtn=o.find(".wijmo-wijfilter-descendingButton"),o=this._elements.$filterContainer=r.find(".wijmo-wijfilter-filterContainer"),this._elements.$filterOperatorsDdl=o.find(".wijmo-wijfilter-dropdown"),this._elements.$filterValuesDdl=o.find(".wijmo-wijfilter-combobox"),this._elements.$radioButtons=r.find(".wijmo-wijfilter-radioContainer input"),this._elements.$searchTb=r.find(".wijmo-wijfilter-searchContainer input"),this._elements.$checkboxContainer=r.find(".wijmo-wijfilter-checkboxContainer"),this._elements.$clearBtn=r.find(".wijmo-wijfilter-clearButton"),o=r.find(".wijmo-wijfilter-actionContainer"),this._elements.$applyBtn=o.find(".wijmo-wijfilter-applyButton"),this._elements.$cancelBtn=o.find(".wijmo-wijfilter-cancelButton"),this._elements.$headerCloseBtn.button({text:!1,icons:{primary:i.iconClose}}).click(function(){s.triggerClose(!1)}),this._elements.$ascendingBtn.button({text:!0,icons:{primary:"ui-icon-arrowthickstop-1-n"}}).click(t.proxy(s._onAscendingButtonClick,this)),this._elements.$descendingBtn.button({text:!0,icons:{primary:"ui-icon-arrowthickstop-1-s"}}).click(t.proxy(s._onDescendingButtonClick,this)),this._elements.$filterOperatorsDdl.append(t.map(n||[],function(e,n){var r=e.name.toLowerCase(),i=e.displayName||e.name;return t(new Option(i||e.name,r)).html(i)})).change(t.proxy(this._onFilterAreaChanged,this)).wijdropdown(),this._elements.$radioButtons.change(t.proxy(this._onRadioButtonChanged,this)).wijradio(),o=t.map(e,function(e,t){return{label:e+"",value:e}}),this._elements.$filterValuesDdl.change(t.proxy(this._onFilterAreaChanged,this)).wijcombobox({autoComplete:!1,data:o,changed:t.proxy(this._onFilterAreaChanged,this)}),this._elements.$searchTb.keyup(t.proxy(this._onSearchTextboxKeyUp,this)).wijtextbox(),this._elements.$checkboxContainer.append("<ul />").find("> ul").append(t.map(e,function(e,n){var r=s._guid("cb"),i=t("<li />");return i.append(t('<input type="checkbox" id="'+r+'" dataidx="'+n+'" /><label for="'+r+'">'+e+"</label>")),i[0]})),this._elements.$checkboxes=this._elements.$checkboxContainer.find("input").change(t.proxy(s._onCheckboxChange,this)).wijcheckbox(),this._elements.$clearBtn.button().click(function(){s._onClearButtonClick()}),this._elements.$applyBtn.button().click(function(){s._onApplyButtonClick()}),this._elements.$cancelBtn.button().click(function(){s.triggerClose(!1)})},r.prototype._fillDialog=function(){var e=this.options.filterOperator,n=this.options.filterValue,r=this,i;this.options.showHeader||this._elements.$headerContainer.hide(),this._elements.$headerText.html(this.options.title),this._elements.$sortContainer.find(".wijmo-wijfilter-"+this.options.sortDirection+"Button").prop("checked",!0),this._elements.$sortContainer.find("input").button("option","disabled",!this.options.enableSortButtons).button("refresh"),e.length===1&&(e[0].name||"").toLowerCase()==="equals"&&n[0].length>1?t.each(n[0],function(e,n){typeof n=="string"&&(n=n.toLowerCase()),(i=t.inArray(n,r._distinctDataValuesCI))>=0&&t(r._elements.$checkboxes[i+1]).prop("checked",!0).wijcheckbox("refresh")}):(t.each(e,function(e,t){e<2&&r._elements.$filterOperatorsDdl.eq(e).val(t.name.toLowerCase()).wijdropdown("refresh")}),t.each(n,function(e,t){if(e<2){var n=r._elements.$filterValuesDdl.eq(e);n.wijcombobox("option","selectedValue",t[0]),n.val()||n.val(t[0])}}),e.length>1&&e[1].condition==="and"&&this._elements.$radioButtons.eq(0).prop("checked",!0).wijradio("refresh"))},r.prototype._guid=function(t){return"wijfilter_"+(t||"")+e.wijfilter.prototype.guidValue++},r}(e.wijmoWidget);e.wijfilter=n,n.prototype.widgetEventPrefix="wijfilter",t.extend(n.prototype,{guidValue:0}),n.prototype.options=t.extend(!0,{},e.wijmoWidget.prototype.options,{data:undefined,dataKey:undefined,title:"",enableSortButtons:!1,availableOperators:undefined,showHeader:!0,sortDirection:undefined,filterValue:undefined,filterOperator:undefined,close:null}),t.wijmo.registerWidget("wijfilter",n.prototype)})(wijmo||(wijmo={}));